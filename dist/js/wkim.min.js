/*!
 * =====================================================
 * zanfuwu by yangbinbin - http://m.zanfuwu.com/
 *
 * =====================================================
 */
if(!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define)define([],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.WKim=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports=a("./interface/interface")},{"./interface/interface":4}],2:[function(a,b,c){"use strict";var d=a("promise"),e=a("../libs/config/config"),f=a("../libs/auth/auth"),g=(a("../libs/io/mainWS"),a("../libs/listener/authEvent")),h=a("../libs/auth/loginStatusManager"),i=a("../libs/error/error"),j=a("../libs/error/errorFactory"),k=a("../libs/storage/storage"),l=a("../libs/reg/regStatus"),m=a("../libs/reg/reg");b.exports=i({login:[["Object"],function(a){return l.isReged?a.appSecret?f.slogin(a):a.deviceId?f.dlogin(a):f.login(a):new d(function(b,c){if(!a.appKey){var d=k.session.getItem(k.KEYS.APPKEY);d?a.appKey=d:c(j.noAppKey("login"))}m(a).then(function(){return a.appSecret?f.slogin(a):a.deviceId?void b(f.dlogin(a)):void b(f.login(a))},function(a){c(a)})})}],loginWithToken:[["Object"],function(a){return l.isReged?a.accessToken?f._toSubscribe(a):f.loginWithToken(a):d.reject(j.notReg("loginWithToken"))}],logout:function(){return g.emit(g.EVENTNAME.LOGOUT),f.logout()},kickout:function(a,b){var c=this,f=msgFactory.genSysBaseMsgModel({text:b||e.loginKickout});return new d(function(b,d){OAuthI.kick(a,f,function(a){200===a.code?(b(a),h.state="NOT_LOGIN",g.emit(g.EVENTNAME.KICKOUT),c.logout()):d(a)})})},getOpenId:function(){return parseInt(k.session.getItem(k.KEYS.OPENID))},lastestAuthInfo:function(){var a={};return a.openId=parseInt(k.session.getItem(k.KEYS.OPENID)),a.appKey=k.session.getItem(k.KEYS.APPKEY),a.nick=k.session.getItem(k.KEYS.NICK),a},setNickName:function(a){e.nickName=a},coldLogin:function(a){return f.coldLogin(a)}})},{"../libs/auth/auth":8,"../libs/auth/loginStatusManager":9,"../libs/config/config":10,"../libs/error/error":16,"../libs/error/errorFactory":17,"../libs/io/mainWS":24,"../libs/listener/authEvent":26,"../libs/reg/reg":41,"../libs/reg/regStatus":42,"../libs/storage/storage":43,promise:144}],3:[function(a,b,c){"use strict";var d=a("promise"),e=a("../libs/conversation/convManager"),f=(a("../libs/auth/loginStatusManager"),a("../libs/error/error")),g=a("../libs/access/access"),h={get:[["String"],function(a){return e.get(a)}],getConvByCache:function(a){return e.getConvSync(a)},list:[["Number","Number"],function(a,b){return new d(function(c,d){e.list(a,b).then(function(a){c(a)})})}],listByTags:[["Array"],function(a){return e.listGroupByTags(a)}],listOwnGroup:[["Number"],function(a){return e.listOwnGroup(a)}],create:[["Object"],function(a,b){return new d(function(c,d){e.create(a,b).then(function(a){c(a)})})}],remove:[["String"],function(a){return e.remove(a)}],removeConversations:[["Array"],function(a){var b=a.map(function(a){return e.remove(a)});return d.all(b)}],getTotalUnreadCount:function(){return e.getTotalUnreadCount()},_deleteConv:[["String"],function(a){return e.deleteConv(a)}],_getConvListObj:function(a){return e.getConvListObj(a)},_setConvToFirst:function(a){return e.setConvToFirst(a)}};b.exports=g(f(h))},{"../libs/access/access":6,"../libs/auth/loginStatusManager":9,"../libs/conversation/convManager":13,"../libs/error/error":16,promise:144}],4:[function(a,b,c){b.exports={version:a("../libs/version"),config:a("../libs/config/config"),conversationListener:a("../libs/listener/convEvent"),authListener:a("../libs/listener/authEvent"),followListener:a("../libs/listener/followEvent"),messageListener:a("../libs/listener/msgEvent"),userListener:a("../libs/listener/userEvent"),conversation:a("./im"),auth:a("./auth"),user:a("./user"),follow:a("../libs/follow/follow"),ws:a("../libs/io/mainWS"),reg:a("../libs/reg/reg"),upload:a("../libs/upload/upload")}},{"../libs/config/config":10,"../libs/follow/follow":18,"../libs/io/mainWS":24,"../libs/listener/authEvent":26,"../libs/listener/convEvent":27,"../libs/listener/followEvent":28,"../libs/listener/msgEvent":29,"../libs/listener/userEvent":30,"../libs/reg/reg":41,"../libs/upload/upload":55,"../libs/version":61,"./auth":2,"./im":3,"./user":5}],5:[function(a,b,c){"use strict";var d=a("promise"),e=a("../libs/user/userManager"),f=a("../libs/error/error"),g=a("../libs/access/access"),c={getProfile:function(a){return e.getProfile(a)},getProfiles:[["Array"],function(a){return new d(function(b,c){e.getUsers(a).then(function(a){b(a.map(function(a){return a?a.userProfileModel:void 0}))})})}],updateProfile:[["Object"],function(a){return e.updateProfile(a)}],updateRemark:[["Object"],function(a){return e.updateRemark(a)}],remarkListAll:function(){return e.pullUserRemark()}};b.exports=g(f(c))},{"../libs/access/access":6,"../libs/error/error":16,"../libs/user/userManager":59,promise:144}],6:[function(a,b,c){var d=a("promise"),e=a("../auth/loginStatusManager"),f=a("../error/errorFactory");b.exports=function(a){var b={};for(var c in a)b[c]=function(b){return function(){return"LOGIN_SUCCESS"!==e.getStatus()?d.reject(f.noLogin(b)):a[b].apply(this,arguments)}}(c);return b}},{"../auth/loginStatusManager":9,"../error/errorFactory":17,promise:144}],7:[function(a,b,c){var d=a("promise"),e=a("../config/config"),f=a("../tools/jsonp"),g=a("../tools/log");b.exports=function(a){return new d(function(b,c){f("https://vip.laiwang.com/alfa?sdkver=3&os=web&net=wifi&appkey="+a+"&env="+e.env,{},function(a,c){c.domainList&&c.domainList[0]&&c.domainList[0].ipList&&c.domainList[0].ipList[0]?b(c.domainList[0].ipList[0]):(g.info("aladin error"),b("wss://wkweb.laiwang.com/lwp"))})})}},{"../config/config":10,"../tools/jsonp":51,"../tools/log":52,promise:144}],8:[function(a,b,c){var d,e=a("promise"),f=a("../idl/idl"),g=f["interface"].OAuthI,h=f["interface"].DAuthI,i=f["interface"].ColdBootI,j=a("../../libs/tools/deviceId"),k=a("../io/mainWS"),l=a("../sync/syncState"),m=a("../storage/storage"),n=a("./loginStatusManager"),o=(a("../listener/authEvent"),a("../reg/regStatus")),p=null,q=null;b.exports={_readyForRefreshToken:function(a){var b=this,c=a.expertIn-(new Date).getTime()-72e5;5e3>c&&(c=5e3),c>72e6&&(c=72e6),clearTimeout(d),d=setTimeout(function(){b._refreshToken({refreshToken:a.refreshToken,appKey:m.session.getItem(m.KEYS.APPKEY),deviceId:j.getDid()}).then(function(a){b._subscribe(a.body)})},c)},_subscribe:function(a){var b=this;if("isReconnect"===a)var a=q;else q=a;var c=l.getSyncInfo(),d="/subscribe",f={sync:c.pts+","+c.highPts+";"+c.seq+";"+c.timestamp};return a.deviceId?(d="/reg/init",f.dtoken=a.accessToken):f.token=a.accessToken,new e(function(c,e){k.getWS().sendMsg(d,f,null,!1,function(d){200===d.code?(p=setTimeout(function(){b._subscribe(a)},828e5),c(d)):e(d)})})},_toSubscribe:function(a){var b=this;return new e(function(c,d){m.session.setItem(m.KEYS.OPENID,a.openId),b._subscribe(a).then(function(b){c(a),n.setStatus("LOGIN_SUCCESS",a)},function(a){n.setStatus("LOGIN_FAIL",a),d(a)})})},login:function(a){if(a.accessToken)return this._toSubscribe(a);var b=this;return new e(function(c,d){m.session.setItem(m.KEYS.APPKEY,a.appKey),n.setStatus("LOGINING",a),g.alogin(a,function(e){200===e.code?(e.body.openId=a.openId,c(b._toSubscribe(e.body))):(d(e),n.setStatus("LOGIN_FAIL",e.body))})})},dlogin:function(a){if(a.accessToken)return this._toSubscribe(a);var b=this;return new e(function(c,d){m.session.setItem(m.KEYS.APPKEY,a.appKey),n.setStatus("LOGINING",a),h.login(a,function(a){200===a.code?c(b._toSubscribe(a.body)):(d(a),n.setStatus("LOGIN_FAIL",a.body))})})},slogin:function(a){if(a.accessToken)return this._toSubscribe(a);var b=this;return new e(function(c,d){m.session.setItem(m.KEYS.APPKEY,a.appKey),n.setStatus("LOGINING",a),g.login(a,function(a){200===a.code?c(b._toSubscribe(a.body)):(d(a),n.setStatus("LOGIN_FAIL",a.body))})})},loginWithToken:function(a){var b=this;return new e(function(c,d){m.session.setItem(m.KEYS.APPKEY,a.appKey),n.setStatus("LOGINING",a),g.loginWithToken({domain:a.domain,appKey:a.appKey,deviceId:a.deviceId||j.getDid(),secretToken:a.secretToken},function(a){200===a.code?c(b._toSubscribe(a.body)):(d(a),n.setStatus("LOGIN_FAIL",a.body))})})},_refreshToken:function(a,b){return new e(function(b,c){g.refreshToken(a,function(a){200===a.code?b(a):c(a)})})},coldLogin:function(a){return new e(function(b,c){i.login(a.domian,a.openId,a.conversationId,a.sign,function(){200===res.code?(b(res),n.setStatus("LOGIN_SUCCESS",res.body)):c(res)})})},logout:function(){return"NOT_LOGIN"!==n.state?(n.state="NOT_LOGIN",m.session.removeItem(m.KEYS.APPKEY),m.session.removeItem(m.KEYS.OPENID),k.getWS().forceClose(),o.isReged=!1,q=null,!0):void 0}}},{"../../libs/tools/deviceId":50,"../idl/idl":20,"../io/mainWS":24,"../listener/authEvent":26,"../reg/regStatus":42,"../storage/storage":43,"../sync/syncState":49,"./loginStatusManager":9,promise:144}],9:[function(a,b,c){"use strict";var d=a("../listener/authEvent");b.exports={state:"NOT_LOGIN",getStatus:function(){return this.state},setStatus:function(a,b){this.state!==a&&(this.state=a,d.emit(d.EVENTNAME[a],b))}}},{"../listener/authEvent":26}],10:[function(a,b,c){"use strict";b.exports={messageTpl:{createGroupText:"发起了群聊",createChatText:"",quitGroup:"已经退出群聊",inviteJoin:"邀请 $whos$ 加入群聊",convKickout:"将 $whos$ 移出了群聊",editGroupName:'把群 "$original$" 修改为 "$now$" ',editGroupIcon:"修改了群头像",loginKickout:"您的账户在其他设备登录",groupOwner:"成为群主"},nickName:"",ua:window.navigator.userAgent,env:"online"}},{}],11:[function(a,b,c){"use strict";function d(a,b){return""===a?"":a||b}function e(a){if(this.baseConversation=C.assign({memberCount:0,title:"",icon:"",isQuit:0,isDisband:0,isKicked:0,createAt:0,memberExtension:0,notificationOff:0,tag:0,sort:0,status:1,authority:0,ownerId:0,memberLimit:0,superGroup:0,unreadPoint:0},a.baseConversation),this.cid=a.baseConversation.conversationId,this.isSingleChat=!1,this.isToMySelf=!1,this.nextPullOver=!1,this.msgIds=[],this.draft=null,this.draftTime=0,this._showSize=0,this.members=null,this._realMsgIds=[],this.lastMessages=[],a.lastMessages=a.lastMessages||[],this.lastMessages=a.lastMessages.map(function(a){return a.sendStatus=1,new j(a)}),1===this.baseConversation.type){this.isSingleChat=!0;var b=this.baseConversation.conversationId.split(":");this.isToMySelf=b[0]===b[1]}else this.isSingleChat=!1;this.listener=r}var f=a("promise"),g=a("../message/msgCache"),h=a("../message/msgFactory"),i=a("../message/msgSendStatus"),j=a("../message/msg"),k=a("../message/msgType"),l=a("../idl/idl"),m=l["interface"].IDLConversation,n=l["interface"].IDLMessage,o=l["interface"].ColdBootI,p=l["interface"].Typing,q=a("./groupRole"),r=(a("../config/config"),a("../listener/convEvent")),s=a("../listener/msgEvent"),t=a("../storage/storage"),u=a("../error/error"),v=a("../error/errorFactory"),w=a("../access/access"),x=a("../config/config"),y=a("../upload/upload"),z=20,A=1500,B=2e12,C=a("../tools/method");e.prototype={_pullData:function(a,b){var c=this;return new f(function(d,e){n.listMessages(c.cid,!1,a,b||z,function(a){if(200===a.code){var b=[];if(a.body&&a.body.length>0){var f=a.body.map(function(a){return a.sendStatus=1,b.push(a.baseMessage.messageId),a});c._showSize+=c._updateMsgList(f,!0),b.reverse(),c._addToRealMsgIds(b)}d(b)}else e(a)})})},_addToRealMsgIds:function(a){var b=this;b._realMsgIds=a.concat(b._realMsgIds),b._realMsgIds=C.uniq(b._realMsgIds)},_getSectionFromRealMsgIds:function(a,b,c){var d=this._realMsgIds.indexOf(b);if(a){if(0>=d)return[];for(var e=[],f=0;d>f;f++)e.push(this._realMsgIds[f]);return e}return this._realMsgIds.slice(d+1,c+1)},_getData:function(a,b,c){var d=this,e=C.get(b,"baseMessage.messageId");if(!e)return f.reject("msg must be have messageId");var h=g.getMsg(this.cid,e);if(h){var i=h.baseMessage.createdAt,j=this._getSectionFromRealMsgIds(a,e,c);if(a){if(j.length>=c)return f.resolve(d._returnCatchMsg(j));if(d.nextPullOver)return f.resolve(d._returnCatchMsg(j));var k=j[0];return i=k&&C.get(g.getMsg(d.cid,k.messageId),"baseMessage.createdAt")||i,new f(function(b,f){d._pullData(i,c+1).then(function(f){f.length<c+1&&(d.nextPullOver=!0),j=d._getSectionFromRealMsgIds(a,e,c),b(d._returnCatchMsg(j))})})}return f.resolve(d._returnCatchMsg(j))}return f.reject("pull messageList fail beacuse need msg object")},_returnCatchMsg:function(a){var b=this;return a.map(function(a){return g.getMsg(b.cid,a)})},_calcNewMsg:function(a){return 2===a.baseMessage.creatorType?0:a.baseMessage.openIdEx&&a.getOpenId()!==String(t.session.getItem(t.KEYS.OPENID))?a.receiverMessageStatus&&2===a.receiverMessageStatus.readStatus?0:a.baseMessage&&a.baseMessage.content&&3===a.baseMessage.content.contentType&&a.audioMsgHaveSeen?0:a.baseMessage.type===k.SILENCE?0:1:0},_updateMsgList:function(a){var b=this,a=a.map(function(a){return a instanceof j?a:new j(a)}),c=0;return a.forEach(function(a){var d=a.getId();-1===b.msgIds.indexOf(d)&&(b.msgIds.push(d),c++,g.cacheMsg(b.cid,a))}),b.msgIds.sort(function(a,c){var d=g.getMsg(b.cid,a),e=g.getMsg(b.cid,c);return d&&e?d.baseMessage.createdAt-e.baseMessage.createdAt:!1}),c},_genLastMsg:function(){var a=this.msgIds[this.msgIds.length-1],b=g.getMsg(this.cid,a);this.lastMessages=[b],r.emit(r.EVENTNAME.CONV_LATEST_MESSAGE_CHANGE,this,b)},_baseConvChangeEmit:function(a,b){if(void 0!==b&&("hide"===a&&(a="status",1===b&&(b=0)),("extension"!==a||JSON.stringify(b)!==JSON.stringify(this.baseConversation[a]))&&this.baseConversation[a]!==b)){switch(this.baseConversation[a]=b,a){case"memberCount":r.emit(r.EVENTNAME.CONV_MEMBER_COUNT_CHANGE,this,b,a);break;case"title":r.emit(r.EVENTNAME.CONV_TITLE_CHANGE,this,b,a);break;case"icon":r.emit(r.EVENTNAME.CONV_ICON_CHANGE,this,b,a);break;case"sort":r.emit(r.EVENTNAME.CONV_SETTOP,this,b,a);break;case"isKicked":r.emit(r.EVENTNAME.CONV_KICKED,this,b,a);break;case"tag":r.emit(r.EVENTNAME.CONV_TAG_CHANGE,this,b,a);break;case"memberExtension":r.emit(r.EVENTNAME.CONV_MEMBER_EXTENSION_CHANGE,this,b,a);break;case"extension":r.emit(r.EVENTNAME.CONV_EXTENSION_CHANGE,this,b,a);break;case"status":console.log(b),r.emit(r.EVENTNAME.CONV_STATUS_CHANGE,this,b,a);break;case"isQuit":r.emit(r.EVENTNAME.CONV_QUIT,this,b,a);break;case"isDisband":r.emit(r.EVENTNAME.CONV_DISBAND,this,b,a);break;case"authority":r.emit(r.EVENTNAME.CONV_AUTHORITY_CHANGE,this,b,a);break;case"memberLimit":r.emit(r.EVENTNAME.CONV_MEMBER_LIMIT_CHANGE,this,b,a);break;case"notificationOff":r.emit(r.EVENTNAME.CONV_NOTIFICATION_CHANGE,this,b,a);break;case"notificationSound":r.emit(r.EVENTNAME.CONV_NOTIFICATION_SOUND_CHANGE,this,b,a);break;case"ownerId":r.emit(r.EVENTNAME.CONV_OWNER_CHANGE,this,b,a);break;case"superGroup":r.emit(r.EVENTNAME.CONV_GROUP_LEVEL_CHANGE,this,b,a);break;case"unreadPoint":r.emit(r.EVENTNAME.CONV_UNREAD_POINT_CHANGE,this,b,a)}r.emit(r.EVENTNAME.CONV_BASE_CHANGE,this,b)}},_updateBaseConv:function(a){var b=this;Object.keys(a).forEach(function(b){""===a[b]&&delete a[b]});for(var c in a)b._baseConvChangeEmit(c,a[c])},_updateMsgStatus:function(a){var b=a.messageId,c=g.getMsg(this.cid,b);c&&(c.updateStatus(a.status),s.emit(s.EVENTNAME.MSG_STATUS_CHANGE,c,a))},_receiveNewMsg:function(a){var b=this,c=h.genReceiveMsg(a);this._showSize+=b._updateMsgList([c]);var d=g.getMsg(b.cid,c.baseMessage.messageId),e=this._calcNewMsg(d);if(e>0){var f=this.baseConversation.unreadPoint+e;b._baseConvChangeEmit("unreadPoint",f)}b._genLastMsg(),s.emit(s.EVENTNAME.MSG_RECEIVE,d)}};var D={listPreviousMessages:[["All","Number"],function(a,b){return a?this._getData(!1,a,b):f.resolve([])}],listNextMessages:[["All","Number"],function(a,b){var c=this;return a?this._getData(!0,a,b):new f(function(a,d){c._pullData(B,b).then(function(d){d.length<b&&(c.nextPullOver=!0),a(c._returnCatchMsg(d))})})}],sendText:[["String"],function(a){return this.sendMsg({content:{contentType:1,textContent:{text:a}}})}],sendImg:[["All"],function(a,b){var c=this;return new f(function(d,e){y.uploadImgByFile(a,"img").then(function(e){var f=C.assign({},{content:{contentType:2,photoContent:{mediaId:e.mediaId,picSize:a.size}}},b);d(c.sendMsg(f))},function(a){e(a)})})}],sendFile:[["All"],function(a,b){var c=this;return new f(function(d,e){y.uploadByFile(a,"other").then(function(e){var f=C.assign({},{content:{contentType:4,fileContent:{mediaId:e.mediaId,fileName:a.fileName,fileType:a.type,fileSize:a.size}}},b);d(c.sendMsg(f))},function(a){e(a)})})}],sendAttachments:[["Array","Number"],function(a,b){return 100>=b?f.reject("attachments message contentType must > 100"):this.sendMsg({content:{contentType:b,attachments:a}})}],sendMsg:[["Object"],function(a){var b=this;if(this.draft=null,!a.content)return f.reject(v.noContent("sendMsg"));var c=a.uuid||h.genUUID(),d=this.lastMessage?this.lastMessage.baseMessage.createdAt:0,e=g.getMsg(b.cid,c)||h.genSendingMsg(b.cid,c,d,a);return b.send(e)}],send:[["Object"],function(a){var b=this;return this._showSize+=b._updateMsgList([a]),new f(function(c,d){var e=g.getMsg(b.cid,a.baseMessage.uuid);e.send(function(a){if(200===a.code){e.sendStatus=i.SENDED,g.cacheMsg(b.cid,e);var f=b.msgIds.indexOf(e.baseMessage.uuid);f>-1&&(b.msgIds[f]=e.getId()),r.emit(r.EVENTNAME._CONV_TO_FIRST,b.cid),s.emit(s.EVENTNAME.SEND_SUCCESS,e),c(e)}else s.emit(s.EVENTNAME.SEND_FAIL,e),d(a)})})}],preSend:function(a){this._showSize+=this._updateMsgList([a]);var a=g.getMsg(this.cid,a.baseMessage.uuid);return a.sendStatus=i.SENDING,g.getMsg(this.cid,a.baseMessage.uuid)},reSend:[["String"],function(a){var b=g.getMsg(this.cid,a);return this._sendMsg(b.baseMessage.content)}],getTitle:function(){if(!this.isSingleChat)return this.baseConversation.title;var a=this.baseConversation.conversationId.split(":"),b=t.session.getItem(t.KEYS.OPENID)===String(a[0])?String(a[1]):String(a[0]);return b},getIcon:function(){return this.baseConversation.icon},updateTitle:[["String"],function(a,b){if(a){if(this.isSingleChat)return f.reject(v.isSingleChat("updateTitle"));var c=this,e=this.baseConversation.title,g=x.messageTpl.editGroupName.replace("$original$",e).replace("$now$",a),i=h.genSysBaseMsgModel({cid:c.cid,text:d(b,g)});return new f(function(b,d){m.updateTitle(c.cid,a,i,function(e){200===e.code?(b(a),c._baseConvChangeEmit("title",a)):d(e)})})}}],updateIcon:[["String"],function(a,b){var c=this;if(this.isSingleChat)return f.reject(v.isSingleChat("updateIcon"));var e=x.messageTpl.editGroupIcon,g=h.genSysBaseMsgModel({cid:c.cid,text:d(b,e)});return new f(function(b,d){m.updateIcon(c.cid,a,g,function(e){200===e.code?(b(e),c._baseConvChangeEmit("icon",a)):d(e)})})}],getMembers:function(a,b,c){var d=this;if(this.isSingleChat)return d.members=d.cid.split(":").map(function(a){return{openIdEx:{openId:String(a),tag:-1},role:q.MEMBER}}),d.isToMySelf&&(d.members=d.members.splice(0,1)),f.resolve(this.members);if(this.members&&!c){if(void 0!==a&&b){var e=this.members.slice(a,a+b);return f.resolve(e)}return f.resolve(this.members)}return new f(function(c,e){m.listMembers(d.cid,0,A,function(g){if(200===g.code){if(d.members=g.body,void 0!==a&&b){var h=this.members.slice(a,a+b);return f.resolve(h)}c(d.members)}else e(g)})})},addMembers:[["Array"],function(a,b){var c=this;if(this.isSingleChat)return f.reject(v.isSingleChat("addMembers"));if(a=a.map(function(a){return Number(a)}),c.members&&c.members.forEach(function(b){var c=b.openIdEx.openId;-1!==a.indexOf(c)&&a.splice(a.indexOf(c),1)}),0===a.length)return f.reject(v.empty("addMembers",1));var e=x.messageTpl.inviteJoin.replace("$whos$",a.join(",")),g=h.genSysBaseMsgModel({cid:c.cid,text:d(b,e)});return new f(function(b,d){m.addMembers(c.cid,a,g,function(e){if(200===e.code){var f=a.map(function(a){return{openIdEx:{openId:a},role:q.MEMBER}});c.members&&(c.members=c.members.concat(f),c._baseConvChangeEmit("memberCount",c.members.length)),b(f)}else d(e)})})}],removeMembers:[["Array"],function(a,b,c){var e=this,g=x.messageTpl.convKickout.replace("$whos$",a.join(",")),i=h.genSysBaseMsgModel({cid:e.cid,text:d(c,g)});return b&&(i.receivers=b),new f(function(b,c){m.removeMembers(e.cid,a,!0,i,function(d){200===d.code?(e.members&&e.members[0]&&(a.forEach(function(a){var b=e.members.indexOf(a);e.members.splice(b,1)}),e._baseConvChangeEmit("memberCount",e.members.length)),b(d.body)):c(d)})})}],saveDraft:[["String"],function(a){this.draft=""==a.trim()?"":a,this.draftTime=new Date-0,r.emit(r.EVENTNAME.CONV_DRAFT_CHANGE,this,a)}],setTop:[["Boolean"],function(a){var b=this;return new f(function(c,d){m.setTop(b.cid,a,function(a){200===a.code?(c(a.body),b._baseConvChangeEmit("sort",a.body)):d(a)})})}],disband:function(){var a=this;return new f(function(b,c){m.disband(a.cid,function(d){200===d.code?(a._baseConvChangeEmit("isDisband",!0),b(!0)):c(d)})})},quitSilent:function(a){return this._quit(a,"quitSilent")},quit:function(a){return this._quit(a,"quit")},_quit:function(a,b){var c=this;if(c.isSingleChat)return f.reject(v.isSingleChat(b));var e=x.messageTpl.quitGroup,g=h.genSysBaseMsgModel({cid:c.cid,text:d(a,e)});return new f(function(a,d){m[b](c.cid,!0,g,function(b){200===b.code?(a(!0),c._baseConvChangeEmit("isQuit",!0)):d(b)})})},hide:function(){var a=this;return a._baseConvChangeEmit("status",0),new f(function(b,c){m.hide(a.cid,function(a){200===a.code?b(!0):c(a)})})},clearMsg:function(){var a=this;return new f(function(b,c){m.clear(a.cid,function(d){200===d.code?(b(!0),a.msgIds=[],a.lastMessage=null,a.baseConversation.unreadPoint=0,r.emit(r.EVENTNAME.CONV_CLEAR_MESSAGE_CHANGE,this)):c(d)})})},updateNotification:[["Number"],function(a){var b=this;return new f(function(c,d){m.updateNotificationOff(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("notificationOff",a),c(a)):d(e)})})}],updateNotificationSound:[["String"],function(a){var b=this;return new f(function(c,d){m.updateNotificationSound(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("notificationSound",a),c(a)):d(e)})})}],updateAuthority:[["Number"],function(a){var b=this;return new f(function(c,d){m.updateAuthority(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("authority",a),c(a)):d(e)})})}],updateMemberLimit:[["Number"],function(a){var b=this;return new f(function(c,d){m.updateMemberLimit(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("memberLimit",a),c(a)):d(e)})})}],updateSuperGroup:[["Number"],function(a){var b=this;return new f(function(c,d){m.updateSuperGroup(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("superGroup",a),c(a)):d(e)})})}],updateStatus:[["Number"],function(a){var b=this;return new f(function(c,d){m.updateStatus([b.cid],a,function(e){200===e.code?(b._baseConvChangeEmit("status",a),c(a)):d(e,"updateStatus fail")})})}],getCode:function(){var a=this;return new f(function(b,c){m.getCode(a.cid,function(a){200===a.code?b(a.body):c(a)})})},updateTag:[["Number"],function(a){var b=this;return new f(function(c,d){m.updateTag(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("tag",a),c(a)):d(e)})})}],updateExtension:[["Object"],function(a){var b=this;return new f(function(c,d){m.updateExtension(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("extension",a),c(a)):d(e)})})}],updateExtByKeys:[["Object"],function(a){var b=this;return new f(function(c,d){m.updateExtByKeys(b.cid,a,function(e){200===e.code?(b._baseConvChangeEmit("extension",a),c(a)):d(e)})})}],updateMemberExtension:[["Array","Object"],function(a,b){var c=this;return new f(function(d,e){m.updateMemberExtension(c.cid,a,b,function(a){200===a.code?(c._baseConvChangeEmit("memberExtension",b),d(b)):e(a)})})}],updateOwner:[["Number"],function(a,b){var c=this,e=h.genSysBaseMsgModel({cid:c.cid,text:d(b,x.messageTpl.groupOwner)});return new f(function(b,d){m.updateOwner(c.cid,a,e,function(e){200===e.code?(c._baseConvChangeEmit("ownerId",a),b(e)):d(e)})})}],updateInfo:[["Object"],function(a){var b=this,c=C.assign({tag:0,extension:{}},a,{conversationId:this.cid});return new f(function(d,e){m.updateInfo(c,function(c){200===c.code?(b._baseConvChangeEmit("info",a),d(a)):e(c)})})}],getMsgById:[["Number"],function(a){return g.getMsg(this.cid,a)}],read:[["Array"],function(a){var b=this;a.forEach(function(a){var c=g.getMsg(b.cid,a);c&&c.updateToRead()})}],clearUnreadPoint:function(){var a=this;return new f(function(b,c){m.clearUnreadPoint(a.cid,function(d){200===d.code?(a._baseConvChangeEmit("unreadPoint",0),b(0)):c(d)})})},sendTyping:[["Number"],function(a,b){var c=this;if(this.isSingleChat&&!this.isToMySelf){var d={conversationId:c.cid,type:b||0,command:a};return new f(function(b,c){p.send(d,function(d){200===d.code?b(a):c(d)})})}return f.reject(v.onlySingleChat("sendTyping"))}],_sendSysMsg:[["String"],function(a){var b=this;return new f(function(c,d){var e=b.lastMessage?b.lastMessage.baseMessage.createdAt:0,f=h.genSysMsg({cid:b.cid,lastTime:e,text:a});b._showSize+=b._updateMsgList([f]),c()})}],peerId:function(){if(this.isSingleChat){var a=this.baseConversation.conversationId.split(":"),b=String(t.session.getItem(t.KEYS.OPENID))===String(a[0])?String(a[1]):String(a[0]);return b}},sendColdBootNotice:function(a,b,c){var d=this;return new f(function(e,f){o.sendColdBootNotice(a,b,d.cid,1,c,function(a){200===a.code?e(a.body):f(a)})})}};C.assign(e.prototype,w(u(D))),b.exports=e},{"../access/access":6,"../config/config":10,"../error/error":16,"../error/errorFactory":17,"../idl/idl":20,"../listener/convEvent":27,"../listener/msgEvent":29,"../message/msg":31,"../message/msgCache":32,"../message/msgFactory":34,"../message/msgSendStatus":36,"../message/msgType":38,"../storage/storage":43,"../tools/method":53,"../upload/upload":55,"./groupRole":15,promise:144}],12:[function(a,b,c){"use strict";var d=a("../idl/idl"),e=d["interface"].IDLConversation,f=a("./conv"),g=/\d+:\d+/;b.exports={genConv:function(a,b){e.getByIdUnlimited(a,function(c){if(200===c.code)if(c.body&&c.body.baseConversation){var d=new f(c.body);b&&b(d)}else if(g.test(a)){var e={conversationId:a,type:1,memberCount:2,title:"",icon:"",createAt:new Date-0},d=new f({baseConversation:e});b(d)}else b(!1)})}}},{"../idl/idl":20,"./conv":11}],13:[function(a,b,c){"use strict";function d(a){return a.sort(function(a,b){return parseInt(a)-parseInt(b)}).join(":")}function e(a){var b=F.order.indexOf(a),c=F.pinOrder.indexOf(a);0!==b&&0!==c&&(-1!==b&&F.order.splice(b,1),-1!==c&&F.pinOrder.splice(c,1),z.get(E[a],"baseConversation.sort")>0?F.pinOrder.unshift(a):F.order.unshift(a),B.emit(B.EVENTNAME.CONV_TO_FIRST,a))}function f(a){var b=F.pinOrder.indexOf(a),c=F.order.indexOf(a);-1!==b&&F.pinOrder.splice(b,1),-1!==c&&F.order.splice(c,1)}function g(a){var b=F.pinOrder.indexOf(a),c=F.order.indexOf(a);conv.baseConversation.sort>0?-1===b&&F.pinOrder.unshift(conv):-1===c&&F.order.unshift(conv)}function h(a,b){var c=F.pinOrder.indexOf(a.cid),d=F.order.indexOf(a.cid);0===b?-1!=c&&(F.pinOrder.splice(c,1),-1==d&&F.order.unshift(a.cid)):-1!=d&&(F.order.splice(d,1),-1==c&&F.pinOrder.unshift(a.cid))}function i(a){var b=z.get(a,"lastMessages[0].baseMessage.createdAt"),c=z.get(a,"baseConversation.createAt");return b?b:c}function j(a,b){return a||(a=[0,G]),a[1]>G?t.reject({reason:"最多能拉"+G+"个会话"}):b||!F.promises?(F.promise=new t(function(b,c){y.listNewest(G,function(d){if(200===d.code){var e=d.body.filter(function(a){return a.baseConversation.sort>0}).sort(function(a,b){return b.baseConversation.sort-a.baseConversation.sort}),f=d.body.filter(function(a){return 0===a.baseConversation.sort}).sort(function(a,b){return i(b)-i(a)}),g=e.concat(f);k(F.order,f.map(function(a){return a.baseConversation.conversationId})),k(F.pinOrder,e.map(function(a){return a.baseConversation.conversationId}));var h=g.slice(a[0],a[1]);h=h.map(function(a){var b=new w(a);return E[b.cid]=b,b}),b(h)}else c(d)})}),F.promise):new t(function(b,c){F.promise.then(function(){var c=F.pinOrder.concat(F.order).map(function(a){return E[a]});b(c.slice(a[0],a[1]).map(function(a){return a instanceof w?a:new w(a)}))},function(a){c(a)})})}function k(a,b){for(;0!==a.length;)a.pop();for(;0!==b.length;)a.push(b.shift())}function l(a){return new t(function(b,c){E[a]?b(E[a]):u.genConv(a,function(d){return d?void(E[a]?b(E[a]):(E[a]=d,b(d))):void c("can not find conversation by cid:"+a)})})}function m(a){return E[a]}function n(a){B.emit(B.EVENTNAME.CONV_TO_FIRST,a)}function o(a){return new t(function(b,c){l(a).then(function(c){c.hide().then(function(){var d=F.pinOrder.indexOf(a),e=F.order.indexOf(a);0==c.baseConversation.sort?-1!=d&&F.pinOrder.splice(d,1):-1!=e&&F.order.splice(e,1),b(!0)})})})}function p(a,b){if(!a.openIds)return t.reject(D.empty("create",1));var c=a.openIds,e=C.session.getItem(C.KEYS.OPENID);c.unshift(e);var f=2;c=z.uniq(c),1===c.length&&c[0]==e&&(c=[e,e]);for(var g=0;g<c.length;g++){var h=c[g];if(!String(h).match(/^[\d]+$/))return t.reject("openId must be number")}var i=d(c);if(2===c.length)return f=1,new t(function(a,b){l(i).then(function(b){B.emit(B.EVENTNAME.CONV_ADD,b),a(b)})});if(c.length>4)var i=c.slice(0,4).join(":");var j=z.assign({openIds:c,title:a.title||"uids:"+i,icon:a.icon||"uids:"+i,type:f,tag:0},a),k=v.genCreateConvMsg(b);return new t(function(a,b){y.create(j,k,function(c){200===c.code?l(c.body).then(function(b){a(b),B.emit(B.EVENTNAME.CONV_ADD,b)}):b(c)})})}function q(a,b){return j([a,b])}function r(a){return new t(function(b,c){q(a).then(function(a){b({convList:a,order:F.order,pinOrder:F.pinOrder})},c)})}function s(){var a=this,b=0;return new t(function(c,d){a.list().then(function(a){a.forEach(function(a){b+=a.baseConversation.unreadPoint}),c(b)})})}var t=a("promise"),u=a("./convFactory"),v=a("../message/msgFactory"),w=a("./conv"),x=a("../idl/idl"),y=x["interface"].IDLConversation,z=a("../tools/method"),A=a("../tools/log"),B=a("../listener/convEvent"),C=a("../storage/storage"),D=a("../error/errorFactory"),E={},F={order:[],pinOrder:[]},G=1e3;B.on(B.EVENTNAME._CONV_TO_FIRST,function(a){a&&l(a).then(function(){e(a)})["catch"](function(a){A.log("找不到相应的会话")})}),B.on(B.EVENTNAME.CONV_SETTOP,function(a,b){a&&h(a,b)}),B.on(B.EVENTNAME.CONV_STATUS_CHANGE,function(a,b){a&&(0===b?f(a.cid):g(a.cid))}),B.on(B.EVENTNAME.CONV_DISBAND,function(a,b){f(a.cid)}),B.on(B.EVENTNAME.CONV_QUIT,function(a,b){f(a.cid)}),b.exports={remove:o,get:l,getConvSync:m,_getConvList:j,list:q,listGroupByTags:function(a){return new t(function(b,c){y.listGroupByTags(a,function(a){200===a.code?b(a.body):c(a)})})},listOwnGroup:function(a){return new t(function(b,c){y.listOwnGroup(a,function(a){200===a.code?b(a.body):c(a)})})},getConvListObj:r,create:p,getTotalUnreadCount:s,setConvToFirst:n,deleteConv:f}},{"../error/errorFactory":17,"../idl/idl":20,"../listener/convEvent":27,"../message/msgFactory":34,"../storage/storage":43,"../tools/log":52,"../tools/method":53,"./conv":11,"./convFactory":12,promise:144}],14:[function(a,b,c){"use strict";function d(){f.register([{objectType:h.IM_CONVERSATION,onSyncMsg:function(a){return e.resolve()},onNeedPullData:function(){return g._getConvList([0,1e3],!0)}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("./convManager"),h=a("../sync/syncObjectType");b.exports={init:d}},{"../sync/syncManager":47,"../sync/syncObjectType":48,"./convManager":13,promise:144}],15:[function(a,b,c){"use strict";b.exports={BOSS:1,MEMBER:3}},{}],16:[function(a,b,c){function d(a,b,c){return function(){if(arguments.length<b.length)return Promise.reject(e.paramsCount(a,b.length));for(var d=0;d<arguments.length;d++){var h=g[b[d]];if(h&&!(typeof arguments[d]===b[d].toLowerCase()||arguments[d]instanceof h))return Promise.reject(e.paramsFormat(a,d+1,b[d]))}var i=c.apply(this,arguments);return i&&i["catch"]&&i["catch"](function(b,c){var d=[];b&&d.push(b),c&&d.push(c),f.warn(a+" reject",d)}),i}}var e=a("./errorFactory"),f=a("../tools/log"),g={String:String,Number:Number,Array:Array,Object:Object,Boolean:Boolean,
All:null};b.exports=function(a){var b={};for(var c in a)a[c]instanceof Array&&a[c][1]&&"function"==typeof a[c][1]?b[c]=d(c,a[c][0],a[c][1]):b[c]=a[c];return b}},{"../tools/log":52,"./errorFactory":17}],17:[function(a,b,c){b.exports={isSingleChat:function(a){return{code:"JS1000",body:a+" fail because it is single chat"}},onlySingleChat:function(a){return{code:"JS1001",body:a+" fail because it only be used in single chat and not toMySelf"}},paramsFormat:function(a,b,c){return{code:"JS1010",body:a+" params "+b+" format error , must be "+c}},paramsCount:function(a,b){return{code:"JS1011",body:a+" params count must >= "+b}},isNotInstanceOf:function(a,b,c){return{code:"JS1020",body:a+" params "+b+" not instanceOf "+c}},notReg:function(a){return{code:"JS1030",body:a+" fail because not reg"}},noAppKey:function(a){return{code:"JS1040",body:a+" fail need appKey"}},noLogin:function(a){return{code:"JS1050",body:a+" fail because not login"}},empty:function(a,b){return{code:"JS1060",body:a+" fail because params "+b+" is empty"}},noContent:function(a){return{code:"JS1070",body:a+" fail because undefined content"}}}},{}],18:[function(a,b,c){var d=a("promise"),e=a("../idl/idl"),f=e["interface"].FollowI,g=a("../user/userManager");b.exports={followers:function(a,b){return b=b||1e3,a=a||0,new d(function(c,d){f.listFollowers(0,a,b,function(a){200===a.code?c(a.body):d(a)})})},followings:function(a,b){return b=b||1e3,a=a||0,new d(function(c,d){f.listAll(0,a,b,function(a){200===a.code?(a.body&&a.body.models&&a.body.models.forEach(function(a){g.getUsers([a.openId]).then(function(b){b[0]&&b[0].updateFollow(a)})}),c(a.body)):c({models:[]})})})},follow:function(a){return new d(function(b,c){f.follow(0,a,function(d){200===d.code?(g.getUsers([a]).then(function(a){a[0]&&a[0].updateFollow(d.body)}),b(d.body)):c(d)})})},unfollow:function(a){return new d(function(b,c){f.unfollow(0,a,function(d){200===d.code?(g.getUsers([a]).then(function(a){a[0]&&a[0].updateFollow(d.body)}),b(d.body)):c(d)})})},followStatusByOpenId:function(a){return new d(function(b,c){f.getStatus(0,a,function(a){200===a.code?b(a.body):c(a)})})}}},{"../idl/idl":20,"../user/userManager":59,promise:144}],19:[function(a,b,c){"use strict";function d(){f.register([{objectType:h.RELATION_FOLLOW,onSyncMsg:function(a){return new e(function(b,c){i.getUsers([a.openId]).then(function(c){b(c[0].updateFollow(a))})})},onNeedPullData:function(){return g.followings(0,0,1e3)}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("./follow"),h=a("../sync/syncObjectType"),i=a("../user/userManager");b.exports={init:d}},{"../sync/syncManager":47,"../sync/syncObjectType":48,"../user/userManager":59,"./follow":18,promise:144}],20:[function(a,b,c){var d=a("@ali/wkidl"),e=a("../io/mainWS");b.exports=d(e)},{"../io/mainWS":24,"@ali/wkidl":79}],21:[function(a,b,c){var d=a("./syncInit");b.exports=function(){d()}},{"./syncInit":22}],22:[function(a,b,c){"use strict";var d=a("../conversation/convSync"),e=a("../message/msgSync"),f=a("../user/remarkSync"),g=a("../follow/followSync"),h=a("../pushReceiver/pushSync"),i=a("../message/msgNoticeSync"),j=a("../message/msgDeleteSync");b.exports=function(){d.init(),e.init(),f.init(),g.init(),h.init(),j.init(),i.init()}},{"../conversation/convSync":14,"../follow/followSync":19,"../message/msgDeleteSync":33,"../message/msgNoticeSync":35,"../message/msgSync":37,"../pushReceiver/pushSync":40,"../user/remarkSync":56}],23:[function(a,b,c){"use strict";b.exports=window.WebSocket},{}],24:[function(a,b,c){"use strict";function d(a){return new i(function(b,c){m(a).then(function(a){l.customUrl=a,b(a)})})}function e(a,b,c){j=new k(a,{appKey:b.appKey,did:b.did,WSURL:c,ua:l.ua},{onReged:function(){b.onReged&&b.onReged()},onStateChange:function(a){b.onStateChange&&b.onStateChange(a)},onDownMsg:function(a,c){b.onDownMsg&&b.onDownMsg(a,c)}}),j.connect()}function f(a,b){l.customUrl?e(a,b,l.customUrl):d(b.appKey).then(function(c){e(a,b,c)})}function g(){return j}function h(a,b,c,d,e){j?j.sendMsg(a,b,c,d,e):n.log("ws为空")}var i=a("promise"),j=null,k=a("./ws"),l=a("../config/config"),m=a("../aladin/aladin"),n=a("../tools/log");b.exports={init:f,getWS:g,sendMsg:h}},{"../aladin/aladin":7,"../config/config":10,"../tools/log":52,"./ws":25,promise:144}],25:[function(a,b,c){"use strict";function d(a,b,c){this.name=a;var c=c||{};if(h.assign(this,j,c),!b||!b.appKey)return void g.warn("*请设置 appKey ");this.appKey=b.appKey,this.userForceClose=!1,this._loginStateChecker=null,this.offlineTime=0,this._timeoutTimer=0,this._pingCheckTimer=0,this._regTimeout=0,this._isReconnecting=!1,this._reconnInterval=0,this.msgCallbacks={},this.msgQueue=[],this.state="CLOSED",this.conf=b;var d=this;k&&(window.addEventListener("offline",function(a){d.forceReconnect(),g.info("network offline")}),window.addEventListener("online",function(a){d.offlineTime=0,d.forceReconnect(),g.info("network online")}))}var e=(a("promise"),a("./WebSocket")),f=a("../tools/deviceId"),g=a("../tools/log"),h=a("../tools/method"),i=0,j={onDownMsg:function(){},onReged:function(){},onStateChange:function(){}},k=!1;window.navigator.hasOwnProperty("onLine")&&(k=!0),d.prototype={_setState:function(a){this.state!==a&&(this.state=a,this.onStateChange(this.state))},_onOpen:function(){var a=this;a.offlineTime=0,clearInterval(a._reconnInterval),this._isReconnecting=!1,a._setState("OPEN"),g.info("websocket open"),this._reg(function(b){b===!0?(a.onReged(),a._setState("REGED")):a.forceReconnect()})},_onMessage:function(a){var b=this;clearTimeout(this._timeoutTimer),clearTimeout(this._pingCheckTimer),this._timeoutTimer=setTimeout(function(){b._pingCheckTimer=setTimeout(function(){b.forceReconnect(),g.info(b.name+": 20s 未收到消息，强制ping检查10s无返回，强制断线")},1e4),b._ping(function(a){clearTimeout(b._pingCheckTimer)})},2e4);try{var c=JSON.parse(a.data)}catch(d){return void g.log("parse json error :"+a.data)}g.log("receive :"+a.data);var e=c.headers.mid.split(" ")[0];if(c.lwp)this.onDownMsg(c,function(a,d){b.responseMsg(a,c.headers.mid,d)});else if(e&&this.msgCallbacks[e]){var f=this.msgCallbacks[e][0];delete this.msgCallbacks[e],f&&f(c)}},_onClose:function(){var a=this;this._setState("CLOSED"),this.offlineTime++,this.reconnect();var b={headers:{},code:408,body:{reason:"timeout"}};Object.keys(this.msgCallbacks).forEach(function(c){var d=a.msgCallbacks[c]&&a.msgCallbacks[c][0]&&a.msgCallbacks[c][0];delete a.msgCallbacks[c],d&&d(b)}),this._unbindHandle()},_reg:function(a){var b=this,c=f.getDid();clearTimeout(b._regTimeout);var d=this.sendMsg("/reg",{"cache-header":"token app-key did ua vhost wv",vhost:"WK",ua:b.conf.ua,did:b.conf.did||c,"app-key":b.appKey,wv:"im:3,au:3,sy:1"},null,!1,function(c){clearTimeout(b._regTimeout),200===c.code?(g.info("reg success"),a&&a(!0)):(g.info("reg fail"),a&&a(!1,c))}),e=d[2]||-1;this._regTimeout=setTimeout(function(){delete b.msgCallbacks[e],a&&a(!1,{body:{reason:"timeout"},code:408})},1e4)},connect:function(){this.userForceClose=!1,this._connect()},reconnect:function(){var a=!0;if(this.userForceClose)return!1;if(this._isReconnecting!==!0){this._isReconnecting=!0;var b=this,c=0;this._reconnInterval=setInterval(function(){c>3&&(b.forceReconnect(),c=0),b._connect(a)||(c+=1)},5e3)}},forceReconnect:function(){var a=this.ws;if(this.ws=null,a){var b=a.onclose;this._unbindHandle(a),b&&b(),a.close()}},_connect:function(a){return this.userForceClose?!1:this.ws&&this.ws.readyState<2?!1:(this.ws=new e(this.conf.WSURL||WSURL),a&&(this.isReconnect=!0),this._setState("CONNECTING"),this._bindHandle(),!0)},_bindHandle:function(){var a=this;this.ws?(this.ws.onopen=function(){a._onOpen.call(a)},this.ws.onmessage=function(b){a._onMessage.call(a,b)},this.ws.onclose=function(b){a._onClose.call(a,b)}):g.info("ws is null when bind handle")},_unbindHandle:function(a){var a=a||this.ws;a&&(a.onopen=function(){},a.onmessage=function(){},a.onclose=function(){})},_ping:function(a){this.sendMsg("/ping",{},null,!1,function(b){a&&a(b)})},sendMsg:function(a,b,c,d,e){var d=d||!1,f=i++,b=b||{};b.mid=f+" 0",b["x-event-id"]=h.getUUID();var g={lwp:a,headers:b,body:c};return this._send(g,d,e)},responseMsg:function(a,b,c,d){var d=d||{};d.mid=b;var c=c||200,e={code:c,headers:d,body:a};return this._send(e,!0,null)},_send:function(a,b,c){if(!this.ws||1!==this.ws.readyState)return b?(this.msgQueue.push([a,b,c]),[!1,"cached"]):[!1,"uncache"];try{if(window.debug===!0&&console.log("send: "+JSON.stringify(a)),this.ws.send(JSON.stringify(a)),c){var d=a.headers.mid.split(" ")[0];this.msgCallbacks[d]=[c]}return[!0,null,d]}catch(e){return[!1,e]}},forceClose:function(){this.userForceClose=!0,this._setState("CLOSING"),this.ws&&this.ws.close(),this.ws=null,clearTimeout(this._timeoutTimer),clearTimeout(this._pingCheckTimer),clearTimeout(this._loginStateChecker),clearTimeout(this._regTimeout)},flushMsgs:function(){for(;this.msgQueue.length>0;){var a=this.msgQueue.shift();this._send.apply(this,a)}}},b.exports=d},{"../tools/deviceId":50,"../tools/log":52,"../tools/method":53,"./WebSocket":23,promise:144}],26:[function(a,b,c){var d=a("wolfy87-eventemitter"),e=new d;e.EVENTNAME={LOGINING:"logining",LOGIN_FAIL:"loginFail",LOGIN_SUCCESS:"loginSuccess",LOGOUT:"logout",KICKOUT:"kickout",DEVSTS:"devSts",STATE_CHANGE:"stateChange"},b.exports=e},{"wolfy87-eventemitter":156}],27:[function(a,b,c){"use strict";var d=a("wolfy87-eventemitter"),e=new d;e.EVENTNAME={CONV_ADD:"convAdd",CONV_REMOVE:"convRemove",CONV_BASE_CHANGE:"convBaseChange",CONV_UNREAD_POINT_CHANGE:"convUnreadPointChange",CONV_TITLE_CHANGE:"convTitleChange",CONV_ICON_CHANGE:"convIconChange",CONV_STATUS_CHANGE:"convStatusChange",CONV_LATEST_MESSAGE_CHANGE:"convLastMessageChange",CONV_DRAFT_CHANGE:"convDraftChange",CONV_TAG_CHANGE:"convTagChange",CONV_EXTENSION_CHANGE:"convExtensionChange",CONV_AT_ME_STATUS_CHANGE:"convAtMeStatusChange",CONV_NOTIFICATION_CHANGE:"convNotificationChange",CONV_MEMBER_COUNT_CHANGE:"convMemberCountChange",CONV_NOTIFICATION_SOUND_CHANGE:"convNotificationSoundChange",CONV_AUTHORITY_CHANGE:"convAuthorityChange",CONV_OWNER_CHANGE:"convOwnerChange",CONV_TYPING_EVENT:"convTyping",CONV_MEMBER_LIMIT_CHANGE:"convMemberLimitChange",CONV_GROUP_LEVEL_CHANGE:"convGroupLevelChange",CONV_CLEAR_MESSAGE_CHANGE:"convClearMessage",CONV_QUIT:"convQuit",CONV_KICKED:"convKicked",CONV_DISBAND:"convDisband",CONV_SETTOP:"convSetTop",CONV_TO_FIRST:"convToFirst",_CONV_TO_FIRST:"_convToFirst"},b.exports=e},{"wolfy87-eventemitter":156}],28:[function(a,b,c){var d=a("wolfy87-eventemitter"),e=new d;e.EVENTNAME={FOLLOW_CHANGE:"followChange"},b.exports=e},{"wolfy87-eventemitter":156}],29:[function(a,b,c){var d=a("wolfy87-eventemitter"),e=new d;e.EVENTNAME={MSG_STATUS_CHANGE:"msgStatusChange",MSG_INFO_CHANGE:"msgInfoChange",MSG_RECEIVE:"msgReceive",MSG_REMOVE:"msgRemove",SEND_SUCCESS:"sendSuccess",SEND_FAIL:"sendFail",PUSH_RECEIVE:"pushReceive",CUSTOM:"custom"},b.exports=e},{"wolfy87-eventemitter":156}],30:[function(a,b,c){var d=a("wolfy87-eventemitter"),e=new d;e.EVENTNAME={REMARK_CHANGE:"remarkChange"},b.exports=e},{"wolfy87-eventemitter":156}],31:[function(a,b,c){function d(a){n.push(a),0===m&&(m=1,setTimeout(function(){j.updateToRead(n),m=0,n=[]},1e3))}function e(a){if(k.assign(this,a),this.isPhoto()){var b=this.baseMessage.content.photoContent.mediaId;try{var c=r.mid2Url(b),d=c.match(/[\d]+_[\d]+/)[0].split("_");this.baseMessage.content.photoContent.imageUrl=c,this.baseMessage.content.photoContent.width=d[0],this.baseMessage.content.photoContent.height=d[1]}catch(e){console.info("mediaId parse error "+b)}}if(this.isSound()){var b=this.baseMessage.content.audioContent.mediaId;try{this.baseMessage.content.audioContent.mediaIdUrl=r.mid2Url(b)}catch(e){console.info("mediaId parse error "+b)}}if(this.isFile()){var b=this.baseMessage.content.fileContent.mediaId;try{this.baseMessage.content.fileContent.mediaIdUrl=r.mid2Url(b)}catch(e){console.info("mediaId parse error "+b)}}}var f=a("promise"),g=a("../idl/idl"),h=g["interface"].IDLSend,i=g["interface"].IDLMessage,j=g["interface"].IDLMessageStatus,k=a("../tools/method"),l=a("./msgSendStatus"),m=0,n=[],o=a("../storage/storage"),p=a("../listener/msgEvent"),q=a("./msgCache"),r=a("@ali/ding-mediaid");e.prototype={getId:function(){return this.sendStatus===l.SENDING||this.sendStatus===l.SENDFAIL?Number(this.baseMessage.uuid):Number(this.baseMessage.messageId||this.baseMessage.uuid)},getOpenId:function(){return String(this.baseMessage.openIdEx.openId)},getConvId:function(){return String(this.baseMessage.conversationId)},unReadCount:function(){return k.get(this,"senderMessageStatus.unReadCount")},unreadMembers:function(){var a=this;return new f(function(b,c){i.listUnreadMembers(a.getId(),function(a){200===a.code?b(a.body):c(a)})})},send:function(a){var b=this;return new f(function(c,d){h.send(b.baseMessage,function(e){200===e.code?(k.assign(b.senderMessageStatus,e.body.model),b.baseMessage.messageId=e.body.messageId,b.baseMessage.createdAt=e.body.createdAt,b.sendStatus=1,q.cacheMsg(b.baseMessage.conversationId,b),a&&a(e),c(e)):(b.sendStatus=-1,a&&a(e),d(e))})})},updateStatus:function(a){k.get(a,"unReadCount")<k.get(this,"senderMessageStatus.unReadCount")&&(this.senderMessageStatus=a)},updateReadStatus:function(a){k.get(a,"readStatus")>k.get(this,"receiverMessageStatus.readStatus")&&(this.receiverMessageStatus=a)},updateToRead:function(){this.isMe()||this.isMeRead()||this.isSys()||this.isSound()||this._updateToRead()},updateAudioMsgToRead:function(){this._updateToRead()},_updateToRead:function(){d(this.getId());var a={readStatus:2};this.receiverMessageStatus=a},updateFromClonedMsg:function(a){this.updateStatus(a.senderMessageStatus),this.updateReadStatus(a.receiverMessageStatus)},isToMySelf:function(){var a=this.getConvId().split(":");return a[0]===a[1]},isMe:function(){return this.getOpenId()===o.session.getItem(o.KEYS.OPENID)},isSys:function(){return 2===k.get(this,"baseMessage.creatorType")},isSound:function(){return 3===k.get(this,"baseMessage.content.contentType")},isFile:function(){return 4===k.get(this,"baseMessage.content.contentType")},isPhoto:function(){return 2===k.get(this,"baseMessage.content.contentType")},isMedia:function(){return 1!==k.get(this,"baseMessage.content.contentType")},isMeRead:function(){return this.isMe()?!0:2===k.get(this,"receiverMessageStatus.readStatus")},isAllRead:function(){return 0===k.get(this,"senderMessageStatus.unReadCount")},recallMessage:function(){var a=this;return new f(function(b,c){i.recallMessage(a.getId(),function(a){200===a.code?b(a):c(a)})})},remove:function(){var a=this;return new f(function(b,c){i.remove(a.getId(),function(d){200===d.code?(b(!0),p.emit(p.EVENTNAME.MSG_REMOVE,a)):c(d)})})}},b.exports=e},{"../idl/idl":20,"../listener/msgEvent":29,"../storage/storage":43,"../tools/method":53,"./msgCache":32,"./msgSendStatus":36,"@ali/ding-mediaid":63,promise:144}],32:[function(a,b,c){var d={},e=function(a,b){var c=a+"__"+b.getId(),e="";if(1===b.sendStatus){e=b.baseMessage.uuid;var f=a+"__"+e;delete d[f]}return d[c]&&d[c].uuid&&(e=d[c].uuid),d[c]?d[c].updateFromClonedMsg(b):d[c]=b,e&&(d[c].uuid=e,d[c].baseMessage.uuid=e),b},f=function(a,b){var c=a+"__"+b;delete d[c]},g=function(a,b){var c=a+"__"+b;return d[c]};b.exports={cacheMsg:e,delMsgCache:f,getMsg:g}},{}],33:[function(a,b,c){"use strict";function d(){f.register([{objectType:g.MESSAGE_DELETE_MODEL_TYPE,onSyncMsg:function(a){return j.info(a,"删除 sync"),i.get(a.conversationId).then(function(b){var c=b.getMsgById(a.messageId);h.emit(h.EVENTNAME.MSG_REMOVE,c)}),e.resolve()},onNeedPullData:function(){return e.resolve()}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("../sync/syncObjectType"),h=(a("../tools/method"),a("../listener/msgEvent")),i=a("../conversation/convManager"),j=a("../tools/log");b.exports={init:d}},{"../conversation/convManager":13,"../listener/msgEvent":29,"../sync/syncManager":47,"../sync/syncObjectType":48,"../tools/log":52,"../tools/method":53,promise:144}],34:[function(a,b,c){var d=(a("promise"),a("./msgSendStatus")),e=a("./senderExtFactory"),f=a("../tools/method"),g=a("../config/config");b.exports={genUUID:function(){return(new Date).getTime().toString()+parseInt(1e3*Math.random())},genSysBaseMsgModel:function(a){var b=this.genUUID(),c=new Date-0,d=null;return a.text&&(d={uuid:b,conversationId:a.cid,type:1,creatorType:2,content:{contentType:1,textContent:{text:a.text}},tag:0,createdAt:c,nickName:g.nickName,memberTag:0}),d},genCreateConvMsg:function(a){var b=this.genUUID(),c=new Date-0,d={uuid:b,type:1,creatorType:2,content:{contentType:1,textContent:{text:a||g.messageTpl.createGroupText}},tag:0,createdAt:c,nickName:g.nickName,memberTag:0};return d},genSendingMsg:function(a,b,c,h){var i=new Date-0,j=i-c>0?i:c+1,k={uuid:b,conversationId:a,type:1,creatorType:1,tag:0,createdAt:j,memberTag:0,openIdEx:e.genOpenIdEx(),nickName:g.nickName};f.assign(k,h);var l={baseMessage:k,senderMessageStatus:{},sendStatus:d.SENDING};return l},genReceiveMsg:function(a){var b={};a.baseMessage?b=a:b.baseMessage=a;var c=f.assign({receiverMessageStatus:{readStatus:1}},b);return c.sendStatus=d.SENDED,c},genSendingImgMsgContent:function(a,b){var c={mediaId:null,picSize:fileSize,type:1,orientation:1},d={contentType:2,photoContent:c};$fileHelper.readFile(a,function(){d.dataURI=a.dataURI,d.fileType=fileType,d.photoContent.mediaId=a.dataURI,"jpg"!==fileType&&"jpeg"!==fileType||!a.orientation||(d.photoContent.orientation=a.orientation),b(d)})},genSysMsg:function(a){var b=this,c=new Date-0,d=c-a.lastTime>0?c:a.lastTime+1,f={baseMessage:{content:{contentType:1,textContent:{text:a.text}},nickName:g.nickName,conversationId:a.cid,createdAt:d,creatorType:2,memberTag:0,messageId:a.mid||b.genUUID(),openIdEx:e.genOpenIdEx()},senderMessageStatus:{totalCount:0,unReadCount:0},receiverMessageStatus:{readStatus:1}};return f}}},{"../config/config":10,"../tools/method":53,"./msgSendStatus":36,"./senderExtFactory":39,promise:144}],35:[function(a,b,c){"use strict";function d(){f.register([{objectType:g.MESSAGE_NOTICE_MODEL_TYPE,onSyncMsg:function(a){return i.info(a,"撤回 sync"),h.emit(h.EVENTNAME.MSG_INFO_CHANGE,a),e.resolve()},onNeedPullData:function(){return e.resolve()}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("../sync/syncObjectType"),h=(a("../tools/method"),a("../listener/msgEvent")),i=a("../tools/log");b.exports={init:d}},{"../listener/msgEvent":29,"../sync/syncManager":47,"../sync/syncObjectType":48,"../tools/log":52,"../tools/method":53,promise:144}],36:[function(a,b,c){"use strict";b.exports={SENDING:0,SENDED:1,SENDFAIL:-1,WAITING_SEND:2}},{}],37:[function(a,b,c){"use strict";function d(){f.register([{objectType:h.IM_MSG,onSyncMsg:function(a){var b=i.get(a,"baseMessage.conversationId");return b?new e(function(c,d){g.get(b).then(function(b){b._receiveNewMsg(a),c()})}):e.reject()},onNeedPullData:function(){return e.resolve()}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("../conversation/convManager"),h=a("../sync/syncObjectType"),i=a("../tools/method");b.exports={init:d}},{"../conversation/convManager":13,"../sync/syncManager":47,"../sync/syncObjectType":48,"../tools/method":53,promise:144}],38:[function(a,b,c){"use strict";b.exports={NORMAL:1,SILENCE:3}},{}],39:[function(a,b,c){"use strict";var d=a("../storage/storage");b.exports={genOpenIdEx:function(){return{openId:d.session.getItem(d.KEYS.OPENID),tag:0}}}},{"../storage/storage":43}],40:[function(a,b,c){"use strict";function d(){f.register([{objectType:h.PUSH_RECEIVE,onSyncMsg:function(a){return g.emit(g.EVENTNAME.PUSH_RECEIVE,a),e.resolve()},onNeedPullData:function(){}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("../listener/msgEvent"),h=(a("../conversation/convManager"),a("../sync/syncObjectType"));b.exports={init:d}},{"../conversation/convManager":13,"../listener/msgEvent":29,"../sync/syncManager":47,"../sync/syncObjectType":48,promise:144}],41:[function(a,b,c){var d=a("promise"),e=a("../init/initManager"),f=a("../subscribe/subscribe"),g=a("../subscribe/subscribeManage"),h=a("../listener/authEvent"),i=a("../auth/auth"),j=a("../io/mainWS"),k=a("./regStatus"),l=a("../error/error"),m=a("../error/errorFactory"),c={reg:[["Object"],function(a){return e(),a.appKey?new d(function(b,c){j.init("im",{appKey:a.appKey,did:a.deviceId,onReged:function(){return a.onReged&&a.onReged(),g(),j.getWS().isReconnect?void b(i._subscribe("isReconnect")):(b(),void(k.isReged=!0))},onDownMsg:function(b,c){a.onDownMsg&&a.onDownMsg(b,c),f.broadcast(b,c)},onStateChange:function(b){a.onStateChange&&a.onStateChange(b),"CLOSED"===b&&(k.isReged=!1),h.emit(h.EVENTNAME.STATE_CHANGE,b)}})}):d.reject(m.noAppKey("reg"))},!1]};b.exports=l(c).reg},{"../auth/auth":8,"../error/error":16,"../error/errorFactory":17,"../init/initManager":21,"../io/mainWS":24,"../listener/authEvent":26,"../subscribe/subscribe":44,"../subscribe/subscribeManage":45,"./regStatus":42,promise:144}],42:[function(a,b,c){b.exports={isReged:!1}},{}],43:[function(a,b,c){var d={TOKEN:"token_storage",APPKEY:"appkey_storage",OPENID:"openId_storage",NICK:"nick_storage"},e={getItem:function(a){return window.sessionStorage.getItem(a)},setItem:function(a,b){return window.sessionStorage.setItem(a,b)},removeItem:function(a){return window.sessionStorage.removeItem(a)}},f={getItem:function(a){return window.localStorage.getItem(a)},setItem:function(a,b){return window.localStorage.setItem(a,b)},removeItem:function(a){return window.localStorage.removeItem(a)}};b.exports={KEYS:d,session:e,local:f}},{}],44:[function(a,b,c){var d={};b.exports={broadcast:function(a,b){var c=a.lwp,e=d[c];e?e.forEach(function(c){c&&c(a,b)}):(e=d.custom,e.forEach(function(c){c&&c(a,b)}))},on:function(a,b){d[a]||(d[a]=[]);var c=d[a].push(b);return function(){d[a][c-1]=null}},off:function(a){delete d[a]}}},{}],45:[function(a,b,c){function d(){e.on("/s/msg",function(a,b){b({updateStatus:!1});var c=a.body.conversationId;f.get(c).then(function(b){b._receiveNewMsg(a.body)})}),e.on("/s/convex",function(a,b){b({});var c=a.body.conversationId;f.get(c).then(function(b){b._updateBaseConv(a.body)})}),e.on("/s/conp",function(a,b){b({});var c=a.body.conversationId;f.get(c).then(function(b){b._updateBaseConv(a.body)})}),e.on("/s/status",function(a,b){b({});var c=a.body.conversationId;f.get(c).then(function(b){b._updateMsgStatus(a.body)})}),e.on("/s/readstatus",function(a,b){b({}),a&&a.body&&Array.isArray(a.body.readStatusList)&&a.body.readStatusList.forEach(function(b){var c=b.conversationId;f.get(c).then(function(b){b._updateMsgStatus(a.body)})})}),e.on("/s/typing",function(a,b){b({}),a&&a.body&&Array.isArray(a.body.typingModels)&&a.body.typingModels.forEach(function(a){var b=a.conversationId;f.get(b).then(function(b){k.emit(k.EVENTNAME.CONV_TYPING_EVENT,b,a)})})}),e.on("/s/msgInfo",function(a,b){b({});var c=a.body.conversationId;f.get(c).then(function(b){var c=b.getMsgById(a.body.messageId);c&&j.emit(j.EVENTNAME.MSG_INFO_CHANGE,c,a.body)})}),e.on("/s/devSts",function(a,b){b({}),h.logout(),i.emit(i.EVENTNAME.DEVSTS,a.body)}),e.on("/push/kickout",function(a,b){b({}),h.logout(),i.emit(i.EVENTNAME.KICKOUT,a.body)}),e.on("custom",function(a,b){b({}),j.emit(j.EVENTNAME.CUSTOM,a)}),g.init()}var e=a("./subscribe"),f=a("../conversation/convManager"),g=a("../sync/syncManager"),h=a("../auth/auth"),i=a("../listener/authEvent"),j=a("../listener/msgEvent"),k=a("../listener/convEvent");b.exports=d},{"../auth/auth":8,"../conversation/convManager":13,"../listener/authEvent":26,"../listener/convEvent":27,"../listener/msgEvent":29,"../sync/syncManager":47,"./subscribe":44}],46:[function(a,b,c){"use strict";function d(){this.affairs={}}var e=a("@ali/msgpack"),f=a("../idl/idl"),g=f.model.user,h=f.model.relation,i=f.model.im,j=f.model.push,k=a("./syncObjectType"),l={};l[k.RELATION_ALIAS]=g.paddings.AliasModel,l[k.RELATION_FOLLOW]=h.paddings.FollowModel,l[k.IM_MSG]=i.paddings.MessageModel,l[k.PUSH_RECEIVE]=j.paddings.PayloadModel,l[k.MESSAGE_NOTICE_MODEL_TYPE]=i.paddings.MessageNoticeModel,l[k.MESSAGE_DELETE_MODEL_TYPE]=i.paddings.MessageDeleteModel,d.prototype.register=function(a){var b=this;a.forEach(function(a){a&&(b.affairs[a.objectType]={onSyncMsg:a.onSyncMsg||function(){return Promise.resolve()},onNeedPullData:a.onNeedPullData||function(){return Promise.resolve()}})})},d.prototype.unregister=function(a){var b=this;delete b.affairs[a]},d.prototype.pullData=function(){var a=this,b=[];for(var c in a.affairs)b.push(this.affairs[c].onNeedPullData());return Promise.all(b)},d.prototype.dispatchMsg=function(a){var b=this,c=a.map(function(a){var c=a.objectType;try{var d=e.decodeFromB64(a.data);l[c]&&(d=l[c](d))}catch(f){return Promise.reject("dispatchMsg fail")}return b.affairs[c]?b.affairs[c].onSyncMsg(d):Promise.resolve()});return Promise.all(c)},b.exports=d},{"../idl/idl":20,"./syncObjectType":48,"@ali/msgpack":64}],47:[function(a,b,c){"use strict";function d(){r.off("/s/sync"),r.off("/s/syncDev")}function e(){d(),r.on("/s/sync",function(a,b){u.log(a);var c=p.paddings.SyncPushModel(a.body);c.syncExtraType&&2===c.syncExtraType.type&&(b({}),g()),c.syncPushPackage&&c.syncPushPackage.data&&k(c.syncPushPackage.startSeq).then(function(){s.dispatchMsg(c.syncPushPackage.data).then(function(){b({})},function(){b({})})},function(a){b({},500),i(a)})["catch"](function(a){u.log(a)})}),r.on("/s/syncDev",function(a,b){u.log(a);var c=p.paddings.SyncPushModel(a.body);c.syncExtraType&&2===c.syncExtraType.type&&(b({}),g()),c.syncPushPackage&&c.syncPushPackage.data&&k(c.syncPushPackage.startSeq).then(function(){s.dispatchMsg(c.syncPushPackage.data).then(function(){b({})},function(){b({})})},function(a){b({},500),i(a)})["catch"](function(a){u.log(a)})})}function f(a){s.register(a)}function g(){var a=null;return new l(function(b,c){h().then(function(b){return a=b,s.pullData()}).then(function(){n.setSyncInfo(a),i(n.getSyncInfo()),b()})["catch"](function(a){u.log(a),c(a)})})}function h(){return new l(function(a,b){var c=n.getSyncInfo();t.getState(c,function(c){200===c.code?a(c.body):b("_getState fail",c)})})}function i(a){t.getDiff(a,function(b){200===b.code?(w=0,k(b.body.startSeq).then(function(){n.setSyncInfo({pts:b.body.maxPts,highPts:b.body.maxHighPts,seq:b.body.endSeq,timestamp:b.body.timestamp}),b.body.data&&Array.isArray(b.body.data)&&s.dispatchMsg(b.body.data),b.body.hasMore?i(n.getSyncInfo()):j()},function(){i(a)})):(w++,w>v?ackDiff():i(a))})}function j(){var a=n.getSyncInfo();t.ackDiff(a,function(a){u.log("sync ackDiff result: "+JSON.stringify(a))})}function k(a){return void 0!==q?x>=a-q?(q=a,l.resolve()):l.reject(n.getSyncInfo()):(q=a,l.resolve())}var l=a("promise"),m=a("./SyncModel"),n=a("./syncState"),o=(a("./syncObjectType"),a("../idl/idl")),p=o.model.sync,q=void 0,r=a("../subscribe/subscribe"),s=(a("wolfy87-eventemitter"),a("../listener/msgEvent"),new m),t=o["interface"].Sync,u=a("../tools/log"),v=5,w=0,x=1;b.exports={init:e,register:f}},{"../idl/idl":20,"../listener/msgEvent":29,"../subscribe/subscribe":44,"../tools/log":52,"./SyncModel":46,"./syncObjectType":48,"./syncState":49,promise:144,"wolfy87-eventemitter":156}],48:[function(a,b,c){"use strict";b.exports={RELATION_ALIAS:2501,RELATION_FOLLOW:2503,IM_MSG:1e3,IM_CONVERSATION:1e4,PUSH_RECEIVE:3501,MESSAGE_NOTICE_MODEL_TYPE:1001,MESSAGE_DELETE_MODEL_TYPE:1002}},{}],49:[function(a,b,c){"use strict";var d=a("../tools/method"),e={pts:0,highPts:0,seq:0,timestamp:0};c.getSyncInfo=function(){return e},c.setSyncInfo=function(a){return d.assign(e,a),e}},{"../tools/method":53}],50:[function(a,b,c){"use strict";var d=a("uuid");c.getDid=function(){var a=sessionStorage.getItem("wk_device_id");if(a)return a;var a=d.v4().replace(/\-/g,"");return sessionStorage.setItem("wk_device_id",a),a}},{uuid:155}],51:[function(a,b,c){function d(){}function e(a,b,c){function e(){h.parentNode&&h.parentNode.removeChild(h),window[k]=d,i&&clearTimeout(i)}function g(){window[k]&&e()}"function"==typeof b&&(c=b,b={}),b||(b={});var h,i,j=b.prefix||"__jp",k=b.name||j+f++,l=b.param||"callback",m=null!=b.timeout?b.timeout:6e4,n=encodeURIComponent,o=document.getElementsByTagName("script")[0]||document.head;return m&&(i=setTimeout(function(){e(),c&&c(new Error("Timeout"))},m)),window[k]=function(a){e(),c&&c(null,a)},a+=(~a.indexOf("?")?"&":"?")+l+"="+n(k),a=a.replace("?&","?"),h=document.createElement("script"),h.src=a,o.parentNode.insertBefore(h,o),g}b.exports=e;var f=0},{}],52:[function(a,b,c){"use strict";function d(a,b){if(window.debug&&console[a](b),window.aliwukongCollectLogUrl){var c="did:"+e.getDid()+" type:"+a+" log:"+b;f(window.aliwukongCollectLogUrl+"?log="+c,{})}}var e=a("./deviceId"),f=a("./jsonp");({did:e.getDid()}),b.exports={log:function(){d("log",arguments)},info:function(){var a=JSON.stringify(arguments);d("info",a)},error:function(){var a=JSON.stringify(arguments);d("error",a)},warn:function(){var a=JSON.stringify(arguments);d("warn",a)}}},{"./deviceId":50,"./jsonp":51}],53:[function(a,b,c){b.exports={get:a("lodash/object/get"),uniq:a("lodash/array/uniq"),assign:a("lodash/object/assign"),getUUID:function(a){var b,c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),d=[],a=a||16;for(b=0;a>b;b++)d[b]=c[0|Math.random()*a];return d.join("")}}},{"lodash/array/uniq":87,"lodash/object/assign":135,"lodash/object/get":136}],54:[function(a,b,c){b.exports={img:["gif","bmp","png","jpg","jpeg","ico","tiff","tif","tga"],other:["rar","json","zip","ppt","pptx","doc","docx","xls","xlsx","pdf","txt","java","js","py","pl","pm","c","cpp","xml","php","ini"]}},{}],55:[function(a,b,c){function d(a){return a.split("/")[1]}function e(a,b){var c=m[a],d=c.indexOf(b);return-1!==d}function f(){}var g=a("promise"),h=a("../tools/deviceId"),i=a("../io/ws"),j=a("@ali/ding-mediaid"),k=a("../storage/storage"),l=a("../config/config"),m=a("./allowType"),n=(a("path"),a("@ali/ding-filetypes")),o=function(a){return{pre:function(b,c){c=c||function(){},a.sendMsg("/up/pre",{did:h.getDid(),dt:"j","up-req":"-1;-1;"+b.type+";flag=mi;","net-type":"wifi"},"",!1,function(b){200==b.code?c({code:b.code,upId:b.headers["up-resp"],upUid:b.headers.uip}):(c(b),a.forceClose())})},ci:function(b,c,d){d=d||function(){},a.sendMsg("/up/ci",{did:h.getDid(),dt:"b","up-req":b.upId.split("&")[0]+";0;0;flag=mi;","net-type":"wifi",uip:b.upUid},c,!1,function(b){d(b),a.forceClose()})},trans:function(b,c){a.sendMsg("/up/trans",{},{src:b,dstType:5},!1,function(b){c(b),a.forceClose()})}}};f.prototype.uploadImgByFile=function(a,b){if(b=b||"img",!a)return g.reject("need file");if(a.size>20971520)return g.reject("文件最大限制20M");var c=d(a.type);return e(b,c)?new g(function(b,d){var e=new FileReader;e.readAsDataURL(a),e.onload=function(a){var e=this.result.replace(/[^,]*,/,""),f=new i("upload",{appKey:k.session.getItem(k.KEYS.APPKEY),WSURL:l.customUrl},{onReged:function(){var a=o(f);a.pre({type:n.getIdByType(c)},function(c){200===c.code?a.ci(c,e,function(a){200===a.code?(a.body.mediaId=a.body.uri,a.body.uri=j.mid2Url(a.body.uri),a.body.thumb=j.mid2Url(a.body.thumb),b(a.body)):d(a)}):d(c)})}});f.connect()}}):g.reject("暂不支持此类格式文件")},f.prototype.trans=function(a,b){return a?new g(function(b,c){var d=new i("upload",{appKey:k.session.getItem(k.KEYS.APPKEY),WSURL:l.customUrl},{onReged:function(){var e=o(d);e.trans(a,function(a){200===a.code?b(j.mid2Url(a.body.url)):c(a)})}});d.connect()}):promise.reject("need mediaId")},b.exports=new f},{"../config/config":10,"../io/ws":25,"../storage/storage":43,"../tools/deviceId":50,"./allowType":54,"@ali/ding-filetypes":62,"@ali/ding-mediaid":63,path:83,promise:144}],56:[function(a,b,c){"use strict";function d(){f.register([{objectType:g.RELATION_ALIAS,onSyncMsg:function(a){return new e(function(b,c){h.getUsers([a.openId]).then(function(c){c[0].updateRemark(a),b()},c)})},onNeedPullData:function(){return h.pullUserRemark()}}])}var e=a("promise"),f=a("../sync/syncManager"),g=a("../sync/syncObjectType"),h=(a("./user"),a("./userManager"));b.exports={init:d}},{"../sync/syncManager":47,"../sync/syncObjectType":48,"./user":57,"./userManager":59,promise:144}],57:[function(a,b,c){"use strict";var d=a("promise"),e=a("../idl/idl"),f=e["interface"].UserI,g=e["interface"].AliasI,h=a("../listener/userEvent"),i=a("../listener/followEvent"),j=function(a){
this._genUserData(),a&&this.update(a)};j.prototype={getId:function(){return this.userProfileModel?this.userProfileModel.openId:null},update:function(a){this.userProfileModel=a},updateRemark:function(a){return this.userRemarkModel[a.openId]&&this.userRemarkModel[a.openId]==a?d.resolve():(this.userRemarkModel[a.openId]=a,h.emit(h.EVENTNAME.REMARK_CHANGE,a),d.resolve())},updateFollow:function(a){return this.userFollowModel[a.openId]&&this.userFollowModel[a.openId]==a?d.resolve():(this.userFollowModel[a.openId]=a,i.emit(i.EVENTNAME.FOLLOW_CHANGE,a),d.resolve())},compareTag:function(a){var b=this;this.userProfileModel.ver===a||b.isUpdating||(b.isUpdating=!0,f.getUserProfilesByOpenIds([b.getId()],function(a){200===a.code&&0!==a.body.length?b.update(a.body[0]):console.log("拉取人员失败")}))},_genUserData:function(){this.isUpdating=!1,!this.userProfileModel&&(this.userProfileModel={}),!this.userRemarkModel&&(this.userRemarkModel={}),!this.userFollowModel&&(this.userFollowModel={})},getRemark:function(){return this.userRemarkModel[this.getId()]},getFollow:function(){return this.userFollowModel[this.getId()]},setRemark:function(a){var b=this,c=this.getId(),e={openId:c,alias:a};return new d(function(a,c){g.update([e],function(d){200===d.code?(b.updateRemark(d.body),a(d.body)):c("setRemark fail")})})}},b.exports=j},{"../idl/idl":20,"../listener/followEvent":28,"../listener/userEvent":30,promise:144}],58:[function(a,b,c){function d(a){return g[a]}function e(a,b){if(a&&b){var c=g[a];return c?c.update(b):(c=b instanceof f?b:new f(b),g[a]=c),c}}var f=a("./user.js"),g={};b.exports={get:d,set:e}},{"./user.js":57}],59:[function(a,b,c){function d(a){return l.put({openIds:a})}function e(a){return/^[\d]+$/.test(a)?new k(function(b,c){n.getUserProfileByOpenId(a,function(a){200==a.code?b(a.body):c(a)})}):k.reject("openId, must be number")}function f(a){var b=[];return new k(function(c,e){d(a).then(function(a){a&&(a.forEach(function(a){b.push(a.userProfileModel)}),c(b))})})}function g(a){return new k(function(b,c){n.updateUserProfile(a,function(a){200==a.code?b(a.body):c(a)})})}function h(a){return new k(function(b,c){o.updateData(1,a,function(a){200==a.code?b(a.body):c(a)})})}function i(a){return new k(function(b,c){o.getAliasModel(a,function(a){200==a.code?b(a.body):c(a)})})}function j(){return new k(function(a,b){o.queryAll(function(b){200===b.code?(b.body&&b.body.forEach(function(a){d([a.openId]).then(function(b){b[0]&&b[0].updateRemark(a)})}),a(b.body)):a(b)})})}var k=a("promise"),l=a("./userRequestPool"),m=a("../idl/idl"),n=m["interface"].UserI,o=m["interface"].AliasI;b.exports={getProfiles:f,getProfile:e,getUsers:d,updateProfile:g,updateRemark:h,getRemark:i,pullUserRemark:j}},{"../idl/idl":20,"./userRequestPool":60,promise:144}],60:[function(a,b,c){function d(){this.data=[],this._bufferOpenIds=[],this._waitOpenIds=[],this._requestInterval=30,this._rePullInterval=1e4,this._rePullTimer=null,this._isReadyToSendRequest=!0}function e(a){return j.put(a)}var f=a("promise"),g=a("../idl/idl"),h=g["interface"].UserI,i=a("./userCache");d.prototype.put=function(a){var b=this;return a.promise=new f(function(b,c){a._resolve=b,a._reject=c}),this.data.push(a),this._pushToOpenIdsArray(a.openIds),this._isReadyToSendRequest&&0!==this._bufferOpenIds.length&&(this._isReadyToSendRequest=!1,setTimeout(function(){b._sendRequest(),b._isReadyToSendRequest=!0,b._rePullTimer&&clearTimeout(b._rePullTimer),b._rePullTimer=setTimeout(function(){var a=b._diff(b._waitOpenIds,b._bufferOpenIds);b._bufferOpenIds=b._bufferOpenIds.concat(a),b._waitOpenIds=[],0!==b._bufferOpenIds.length&&b._sendRequest()},b._rePullInterval)},b._requestInterval)),a.promise},d.prototype._pushToOpenIdsArray=function(a){if(a=this._checkCache(a),0===a.length)return void this._resolveData();var b=this._diff(a,this._bufferOpenIds);b=this._diff(b,this._waitOpenIds),this._bufferOpenIds=this._bufferOpenIds.concat(b)},d.prototype._diff=function(a,b){return a.filter(function(a){return-1==b.indexOf(a)})},d.prototype._checkCache=function(a){var b=[];return a.forEach(function(a){!i.get(a)&&b.push(a)}),b},d.prototype._sendRequest=function(){var a=this,b=[];this._bufferOpenIds=this._bufferOpenIds.filter(function(a){return String(a).match(/^[\d]+$/)&&!(String(a).length>14)});for(var c=[],d=0;d<this._bufferOpenIds.length;d+=100)c.push(this._bufferOpenIds.slice(d,d+100));this._waitOpenIds=this._waitOpenIds.concat(this._bufferOpenIds),this._bufferOpenIds=[],c.forEach(function(a){b.push(new f(function(b,c){h.getUserProfilesByOpenIds(a,function(a){200===a.code?b(a.body):c(a)})}))}),b.forEach(function(b){b.then(function(b){a._saveCache(b),a._resolveData()})})},d.prototype._saveCache=function(a){var b=this;a.forEach(function(a){i.set(a.openId,a);var c=b._waitOpenIds.indexOf(a.openId);-1!==c&&b._waitOpenIds.splice(c,1)})},d.prototype._resolveData=function(){for(var a=this,b=0;b<this.data.length;b++){for(var c=[],d=this.data[b],e=0;e<d.openIds.length;e++)if(void 0===d.openIds[e]||isNaN(d.openIds[e])||0===d.openIds[e])c.push(void 0);else{var f=i.get(d.openIds[e]);if(!f)break;c.push(f)}e===d.openIds.length&&(d._resolve(c),a.data.splice(b,1),b--)}};var j=new d;b.exports={put:e}},{"../idl/idl":20,"./userCache":58,promise:144}],61:[function(a,b,c){b.exports="3.2.5"},{}],62:[function(a,b,c){var d={},e={0:"IMAGE_JPG",1:"IMAGE_GIF",2:"IMAGE_PNG",3:"IMAGE_BMP",4:"AUDIO_AMR",5:"AUDIO_MP3",6:"VIDEO_MP4",7:"AUDIO_WAV",8:"NORMAL_FILE",9:"OFFICE_DOC",10:"OFFICE_DOCX",11:"OFFICE_XLS",12:"OFFICE_XLSX",13:"OFFICE_PPT",14:"OFFICE_PPTX",15:"NORMAL_ZIP",16:"NORMAL_PDF",17:"NORMAL_RAR",18:"NORMAL_PSD",19:"NORMAL_AI",20:"NORMAL_TXT",21:"VIDEO_AVI",22:"VIDEO_RMVB",23:"VIDEO_RM",24:"VIDEO_MPG",25:"VIDEO_WMV",26:"VIDEO_MKV",27:"VIDEO_VOB",28:"NORMAL_TFSPRIVATE",29:"IMAGE_WEBP"};Object.keys(e).forEach(function(a){var b=e[a],c=b.split("_")[1].toLowerCase();d[c]=a}),d.jpeg=0;var f=["jpg","jpeg","bmp","png","gif","doc","docx","xlsx","xls","pdf","ppt","pptx","zip","rar","txt","mp4","psd","ai","avi"],g={getTypeByName:function(a){return a.split(".").pop().toLowerCase()},getIdByType:function(a){if(void 0===d[a])var a="file";return d[a]},getCateTypeById:function(a){if(void 0===e[a])var a="8";return e[a]},getTypeById:function(a){if(void 0===e[a])var a="8";return e[a].split("_")[1].toLowerCase()},getCateTypeByType:function(a){return g.getCateTypeById(g.getIdByType(a))},isValid:function(a){var b=f.indexOf(a);return-1!==b},isImg:function(a){return"IMAGE"===g.getCateTypeByType(a).split("_")[0]},getFileIconByType:function(a){var b=g.getCateTypeByType(a);switch(b){case"OFFICE_DOC":case"OFFICE_DOCX":return"word-icon";case"OFFICE_PPT":case"OFFICE_PPTX":return"ppt-icon";case"NORMAL_PDF":return"pdf-icon";case"OFFICE_XLS":case"OFFICE_XLSX":return"excl-icon";case"NORMAL_ZIP":return"zip-icon";case"NORMAL_RAR":return"rar-icon";case"NORMAL_PSD":return"psd-icon";case"NORMAL_AI":return"ai-icon";case"NORMAL_TXT":return"txt-icon";case"VIDEO_AVI":case"VIDEO_RMVB":case"VIDEO_RM":case"VIDEO_MPG":case"VIDEO_WMV":case"VIDEO_MKV":case"VIDEO_VOB":case"VIDEO_MP4":return"video-icon";case"IMAGE_JPG":case"IMAGE_GIF":case"IMAGE_PNG":case"IMAGE_BMP":return"pic-icon";default:return"default-icon"}}};b.exports=g},{}],63:[function(a,b,c){"use strict";function d(a){for(var b="",c=a.length-1;c>=0;c--)b+=a[c];return b}var e=a("@ali/msgpack"),f=a("@ali/ding-filetypes"),g=a("jsuri"),h="static.dingtalk.com",i="i01.lw.aliimg.com",j="media",k="https://"+h+"/"+j+"/",l=1===window.devicePixelRatio,m=function(a,b){var b=b||{};if("@"!==a.charAt(0))return"https:"===window.location.protocol&&(a=a.replace(/^http(?!s)/,"https")),a;a=a.replace(/-/gi,"+").replace(/_/gi,"/");var a=a.substr(1),c=e.decodeFromB64(a),d=f.getCateTypeById(c[0]).split("_");if("IMAGE"===d[0])if("origin"===b.imageSize)var g=a+"_"+c[3]+"_"+c[2]+"."+d[1].toLowerCase();else if("thumb"===b.imageSize)var h=l?"_60x60q90.jpg":"_120x120q90.jpg",g=a+"_"+c[3]+"_"+c[2]+"."+d[1].toLowerCase()+h;else if("GIF"===d[1])var g=a+"_"+c[3]+"_"+c[2]+"."+d[1].toLowerCase();else var g=a+"_"+c[3]+"_"+c[2]+"."+d[1].toLowerCase()+"_620x10000q90.jpg";else var g=a+"."+d[1].toLowerCase();return g=g.replace(/\//gi,"_").replace(/\+/gi,"-"),k+g},n=function(a){var b=new g(a);if((b.host()===h||b.host()===i)&&b.uriParts.directory==="/"+j+"/"){var c=b.uriParts.file,e=c.indexOf(".");if(-1!==e){c=c.slice(0,e),c=d(c);var f=c.indexOf("_");if(-1!==f){var k=c.indexOf("_",f+1);if(-1!==k&&(c=c.slice(k+1)))return"@"+d(c)}}}return a};c.mid2Url=m,c.url2Mid=n},{"@ali/ding-filetypes":62,"@ali/msgpack":64,jsuri:85}],64:[function(a,b,c){"use strict";function d(a){if(void 0===a)return"undefined";var b,c;if(a instanceof ArrayBuffer?(c="ArrayBuffer",b=new DataView(a)):a instanceof DataView&&(c="DataView",b=a),!b)return JSON.stringify(a);for(var d=[],e=0;e<a.byteLength;e++){if(e>20){d.push("...");break}var f=b.getUint8(e).toString(16);1===f.length&&(f="0"+f),d.push(f)}return"<"+c+" "+d.join(" ")+">"}function e(a,b,c){for(var d=(a.byteLength,0),e=c.length;e>d;d++){var f=c.charCodeAt(d);if(128>f)a.setUint8(b++,f>>>0&127|0);else if(2048>f)a.setUint8(b++,f>>>6&31|192),a.setUint8(b++,f>>>0&63|128);else if(65536>f)a.setUint8(b++,f>>>12&15|224),a.setUint8(b++,f>>>6&63|128),a.setUint8(b++,f>>>0&63|128);else{if(!(1114112>f))throw new Error("bad codepoint "+f);a.setUint8(b++,f>>>18&7|240),a.setUint8(b++,f>>>12&63|128),a.setUint8(b++,f>>>6&63|128),a.setUint8(b++,f>>>0&63|128)}}}function f(a,b,c){for(var d="",e=b,f=b+c;f>e;e++){var g=a.getUint8(e);if(0!==(128&g))if(192!==(224&g))if(224!==(240&g)){if(240!==(248&g))throw new Error("Invalid byte "+g.toString(16));var h=(7&g)<<18|(63&a.getUint8(++e))<<12|(63&a.getUint8(++e))<<6|(63&a.getUint8(++e))<<0,i=Math.floor((h-65536)/1024)+55296,j=(h-65536)%1024+56320;d+=String.fromCharCode(i,j)}else d+=String.fromCharCode((15&g)<<12|(63&a.getUint8(++e))<<6|(63&a.getUint8(++e))<<0);else d+=String.fromCharCode((15&g)<<6|63&a.getUint8(++e));else d+=String.fromCharCode(g)}return d}function g(a){for(var b=0,c=0,d=a.length;d>c;c++){var e=a.charCodeAt(c);if(128>e)b+=1;else if(2048>e)b+=2;else if(65536>e)b+=3;else{if(!(1114112>e))throw new Error("bad codepoint "+e);b+=4}}return b}function h(a,b,c){this.offset=b||0,this.view=a,this.bytes=c}function i(a){var b=a.buffer,c=new DataView(b),d=new h(c,0,a),e=d.parse();if(d.offset!==b.byteLength)throw new Error(b.byteLength-d.offset+" trailing bytes");return e}function j(a,b,c){var d=typeof a;if("string"===d){var f=g(a);if(32>f)return b.setUint8(c,160|f),e(b,c+1,a),1+f;if(65536>f)return b.setUint8(c,218),b.setUint16(c+1,f),e(b,c+3,a),3+f;if(4294967296>f)return b.setUint8(c,219),b.setUint32(c+1,f),e(b,c+5,a),5+f}if(a instanceof ArrayBuffer){var f=a.byteLength;if(65536>f)return b.setUint8(c,216),b.setUint16(c+1,f),new Uint8Array(b.buffer).set(new Uint8Array(a),c+3),3+f;if(4294967296>f)return b.setUint8(c,217),b.setUint32(c+1,f),new Uint8Array(b.buffer).set(new Uint8Array(a),c+5),5+f}if("number"===d){if(a<<0!==a)return b.setUint8(c,203),b.setFloat64(c+1,a),9;if(a>=0){if(128>a)return b.setUint8(c,a),1;if(256>a)return b.setUint8(c,204),b.setUint8(c+1,a),2;if(65536>a)return b.setUint8(c,205),b.setUint16(c+1,a),3;if(4294967296>a)return b.setUint8(c,206),b.setUint32(c+1,a),5;throw new Error("Number too big 0x"+a.toString(16))}if(a>=-32)return b.setInt8(c,a),1;if(a>=-128)return b.setUint8(c,208),b.setInt8(c+1,a),2;if(a>=-32768)return b.setUint8(c,209),b.setInt16(c+1,a),3;if(a>=-2147483648)return b.setUint8(c,210),b.setInt32(c+1,a),5;throw new Error("Number too small -0x"+(-a).toString(16).substr(1))}if("undefined"===d)return b.setUint8(c,196),1;if(null===a)return b.setUint8(c,192),1;if("boolean"===d)return b.setUint8(c,a?195:194),1;if("object"===d){var f,h=0,i=Array.isArray(a);if(i)f=a.length;else{var k=Object.keys(a);f=k.length}var h;if(16>f?(b.setUint8(c,f|(i?144:128)),h=1):65536>f?(b.setUint8(c,i?220:222),b.setUint16(c+1,f),h=3):4294967296>f&&(b.setUint8(c,i?221:223),b.setUint32(c+1,f),h=5),i)for(var l=0;f>l;l++)h+=j(a[l],b,c+h);else for(var l=0;f>l;l++){var m=k[l];h+=j(m,b,c+h),h+=j(a[m],b,c+h)}return h}throw new Error("Unknown type "+d)}function k(a){var b=typeof a;if("string"===b){var c=g(a);if(32>c)return 1+c;if(65536>c)return 3+c;if(4294967296>c)return 5+c}if(a instanceof ArrayBuffer){var c=a.byteLength;if(65536>c)return 3+c;if(4294967296>c)return 5+c}if("number"===b){if(a<<0!==a)return 9;if(a>=0){if(128>a)return 1;if(256>a)return 2;if(65536>a)return 3;if(4294967296>a)return 5;if(0x10000000000000000>a)return 9;throw new Error("Number too big 0x"+a.toString(16))}if(a>=-32)return 1;if(a>=-128)return 2;if(a>=-32768)return 3;if(a>=-2147483648)return 5;if(a>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+a.toString(16).substr(1))}if("boolean"===b||"undefined"===b||null===a)return 1;if("object"===b){var c,d=0;if(Array.isArray(a)){c=a.length;for(var e=0;c>e;e++)d+=k(a[e])}else{var f=Object.keys(a);c=f.length;for(var e=0;c>e;e++){var h=f[e];d+=k(h)+k(a[h])}}if(16>c)return 1+d;if(65536>c)return 3+d;if(4294967296>c)return 5+d;throw new Error("Array or object too long 0x"+c.toString(16))}throw new Error("Unknown type "+b)}c.inspect=d,c.utf8Write=e,c.utf8Read=f,c.utf8ByteCount=g,c.encode=function(a){var b=new ArrayBuffer(k(a)),c=new DataView(b);return j(a,c,0),b},c.decode=i,h.prototype.map=function(a){for(var b={},c=0;a>c;c++){var d=this.parse();b[d]=this.parse()}return b},h.prototype.buf=function(a){var b=new ArrayBuffer(a);return new Uint8Array(b).set(new Uint8Array(this.view.buffer,this.offset,a),0),this.offset+=a,b},h.prototype.raw=function(a){var b=f(this.view,this.offset,a);return this.offset+=a,b},h.prototype.array=function(a){for(var b=new Array(a),c=0;a>c;c++)b[c]=this.parse();return b},h.prototype.parse=function(){var a,b,c=this.view.getUint8(this.offset);if(160===(224&c))return b=31&c,this.offset++,this.raw(b);if(128===(240&c))return b=15&c,this.offset++,this.map(b);if(144===(240&c))return b=15&c,this.offset++,this.array(b);if(0===(128&c))return this.offset++,c;if(224===(224&c))return a=this.view.getInt8(this.offset),this.offset++,a;switch(c){case 218:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.raw(b);case 219:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.raw(b);case 192:return this.offset++,null;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return void this.offset++;case 204:return a=this.view.getUint8(this.offset+1),this.offset+=2,a;case 205:return a=this.view.getUint16(this.offset+1),this.offset+=3,a;case 206:return a=this.view.getUint32(this.offset+1),this.offset+=5,a;case 208:return a=this.view.getInt8(this.offset+1),this.offset+=2,a;case 209:return a=this.view.getInt16(this.offset+1),this.offset+=3,a;case 210:return a=this.view.getInt32(this.offset+1),this.offset+=5,a;case 222:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.map(b);case 223:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.map(b);case 220:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.array(b);case 221:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.array(b);case 216:return b=this.view.getUint16(this.offset+1),this.offset+=3,this.buf(b);case 217:return b=this.view.getUint32(this.offset+1),this.offset+=5,this.buf(b);case 202:return a=this.view.getFloat32(this.offset+1),this.offset+=5,a;case 203:return a=this.view.getFloat64(this.offset+1),this.offset+=9,a;case 207:var d=this.bytes;this.offset++;var e=16777216*d[this.offset++]+(d[this.offset++]<<16)+(d[this.offset++]<<8)+d[this.offset++];return 4294967296*e+16777216*d[this.offset++]+(d[this.offset++]<<16)+(d[this.offset++]<<8)+d[this.offset++]}throw new Error("Unknown type 0x"+c.toString(16))},c.decodeFromB64=function(a){for(var b=window.atob(a),d=b.length,e=new Uint8Array(d),f=0;d>f;f++){var g=b.charCodeAt(f);e[f]=g}return c.decode(e)}},{}],65:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="AliasI",f=["update","getAliasModel","updateData","queryAll"];b.exports=d},{}],66:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="BlacklistI",f=["listAll","getStatus","addToBlacklist","removeFromBlacklist"];b.exports=d},{}],67:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="ColdBootI",f=["sendColdBootNotice","login"];b.exports=d},{}],68:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="DAuthI",f=["login","refreshToken"];b.exports=d},{}],69:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="FollowI",f=["listFollowings","listBilateral","listFollowers","getStatus","listAll","follow","unfollow"];b.exports=d},{}],70:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="IDLConversation",f=["listNewest","listConversations","listGroup","listOwnGroup","getById","getByIdUnlimited","create","hide","listMembers","addMembers","addChildGroupMembers","removeMembers","updateTitle","updateIcon","updateTag","updateExtension","updateExtByKeys","updateMemberExtension","quit","quitSilent","updateNotificationOff","hides","updateInfo","setTop","updateStatus","getByIds","quits","disband","listRoles","listGroupByTags","getCode","verifyCode","hideAndClear","getCommonByIds","updateOwner","updateNotificationSound","updateAuthority","updateMemberLimit","updateSuperGroup","clear","clearUnreadPoint","getChildren"];b.exports=d},{}],71:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="IDLMessage",f=["listMessages","listUnreadMembers","remove","getMessageById","updateMemberTag","updateMemberExtension","listMemberStatusByMessageId","removes","updateMemberTagAndExt","listTopUsers","updateExtension","recallMessage"];b.exports=d},{}],72:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="IDLMessageStatus",f=["updateToRead"];b.exports=d},{}],73:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="IDLSend",f=["send","forward"];b.exports=d},{}],74:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="Notification",f=["bindAnd","bindiOS","unbind","setBadge"];b.exports=d},{}],75:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="OAuthI",f=["login","loginWithToken","refreshToken","sendLoginSms","loginBySms","kick","alogin"];b.exports=d},{}],76:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="Sync",f=["getDiff","getState","ackDiff"];b.exports=d},{}],77:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="Typing",f=["send"];b.exports=d},{}],78:[function(a,b,c){"use strict";function d(a){var b={};return f.forEach(function(c){b[c]=function(){var b,d=Array.prototype.slice.apply(arguments,[]);d.length>0?(b=d[d.length-1],"function"!=typeof b?b=function(){}:d.pop()):(d=[],b=function(){}),a.sendMsg("/r/"+e+"/"+c,{},d,!1,b)}}),b}var e="UserI",f=["getUserProfileByOpenId","getUserProfileByMobile","getUserProfilesByOpenIds","getUserProfilesByMobiles","updateUserProfile"];b.exports=d},{}],79:[function(a,b,c){"use strict";var d=a("./keyPaddingGen");b.exports=function(b){var c={};return c["interface"]={},c.model={},c["interface"].ColdBootI=a("./dist/ColdBootI")(b),c["interface"].IDLConversation=a("./dist/IDLConversation")(b),c["interface"].IDLMessage=a("./dist/IDLMessage")(b),c["interface"].IDLMessageStatus=a("./dist/IDLMessageStatus")(b),c["interface"].IDLSend=a("./dist/IDLSend")(b),c["interface"].Sync=a("./dist/Sync")(b),c["interface"].UserI=a("./dist/UserI")(b),c["interface"].Typing=a("./dist/Typing")(b),c["interface"].Notification=a("./dist/Notification")(b),c["interface"].OAuthI=a("./dist/OAuthI")(b),c["interface"].DAuthI=a("./dist/DAuthI")(b),c["interface"].AliasI=a("./dist/AliasI")(b),c["interface"].FollowI=a("./dist/FollowI")(b),c["interface"].BlacklistI=a("./dist/BlacklistI")(b),c.model.coldBoot=d({ColdBootTokenModel:{def:{domain:["1","string","domain","// * 域名称"],appKey:["2","string","appKey","// * 应用key"],openId:["3","string","openId","// * 用户ID"],signature:["4","string","signature","// * 签名"],timestamp:["5","int","timestamp","// * 时间戳"],nonce:["6","string","nonce","// * 随机数"]}}}),c.model.sync=d({SyncInfoModel:{def:{pts:["1","int","pts","// * 低优先级数据同步点"],seq:["2","int","seq","// * 同步序列号"],timestamp:["3","int","timestamp","// * 同步时间戳"],highPts:["4","int","highPts","// * 高优先级数据同步点， 当前为IM业务"]},COMMENT:"// 同步三元组, 客户端reg的时候带上 seq和pts, timestamp"},SyncPushModel:{def:{syncPushPackage:["1","SyncPushPackageModel","syncPushPackage","// * push的数据"],syncExtraType:["2","SyncExtraTypeModel","syncExtraType","// * tooLong tooLong2"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"},SyncPushPackageModel:{def:{startSeq:["1","int","startSeq","// * 起始seq"],endSeq:["2","int","endSeq","// * 结束seq"],timestamp:["3","int","timestamp","// * 上一次同步时间点"],maxPts:["4","int","maxPts","// * 该数据包中包含的最大低优先级pts"],hasMore:["5","boolean","hasMore","// * hasMore=true表示还有数据，客户端后续需要继续拉取数据"],data:["6",["Array","SyncDataModel"],"data"],maxHighPts:["7","int","maxHighPts","// * 该数据包中包含的最大高优先级pts"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"},SyncDataModel:{def:{objectType:["1","int","objectType","// * 数据包model类型，用于解码"],data:["2","byte[]","data","// * 同步数据"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"},SyncExtraTypeModel:{def:{type:["1","int","type","// * type=1 TooLong、 type=2 TooLong2"]},COMMENT:"//服务端下行接口, push topic:  /s/sync  推下行数据包"}}),c.model.im=d({SendMessageModel:{def:{uuid:["1","string","uuid","// * 客户端生成的id，绑定一个独立会话"],conversationId:["2","string","conversationId","// * 会话id"],type:["3","int","type","// * 默认为1-普通消息, 2-阅后即焚（暂时不启用）, 3-静默消息（该类消息不修改会话lastModify）"],creatorType:["4","int","creatorType","// * 消息创建者类型 1-SELF：表示用户自身产生消息 2-SYSTEM：表示系统自动生成消息 固定1"],content:["5","ContentModel","content","// * 附件(文本、图片，语音，文件或者组合类型等)"],tag:["6","int","tag","// * 业务自定义"],extension:["7",["Object","string","string"],"extension","// * msg扩展信息，业务自定义"],nickName:["8","string","nickName","// * 用户昵称"],receivers:["9",["Array","int"],"receivers","// * 接收者openId列表"],xpnModel:["10","XpnPushModel","xpnModel","// 服务端model。客户端请忽略"]},COMMENT:"// 消息发送对象"},ForwardMessageModel:{def:{uuid:["1","string","uuid","// * 客户端生成的id，绑定一个独立会话"],messageId:["2","int","messageId","// * 转发的消息id"],toConversationId:["3","string","toConversationId","// * 转发的目标会话id"],nickName:["4","string","nickName","// * 用户昵称"],xpnModel:["5","XpnPushModel","xpnModel","// * xpn推送控制模型"]},COMMENT:"// 消息转发对象"},BaseMessageModel:{def:{messageId:["1","int","messageId","// * 消息id"],conversationId:["2","string","conversationId","// * 会话id"],openIdEx:["3","OpenIdExModel","openIdEx","// * openId和tag"],type:["4","int","type","// * 默认为1-普通消息, 2-阅后即焚"],creatorType:["5","int","creatorType","// * 消息创建者类型 1-SELF：表示用户自身产生消息 2-SYSTEM：表示系统自动生成消息"],createdAt:["6","int","createdAt","// * 消息的创建时间，单位：毫秒"],content:["7","ContentModel","content","// * 附件(文本、图片，语音等)"],tag:["8","int","tag","// * 业务自定义"],extension:["9",["Object","string","string"],"extension","// * msg扩展信息，业务自定义"],memberTag:["10","int","memberTag","// * 业务扩展，只影响当前用户的属性"],memberExtension:["11",["Object","string","string"],"memberExtension","// * msgInbox扩展信息，业务自定义，只影响当前用户的属性"],recallStatus:["12","int","recallStatus","// * 是否为撤回消息"]},COMMENT:"// 基础的消息对象， 对应下行push topic：/s/msg"},MessageModel:{def:{baseMessage:["1","BaseMessageModel","baseMessage","// * 基础消息对象"],receiverMessageStatus:["2","ReceiverMessageStatusModel","receiverMessageStatus","// * 针对接收者的消息状态，已读和未读"],senderMessageStatus:["3","SenderMessageStatusModel","senderMessageStatus","// * 针对发送者的消息状态，未读人数和总人数"]},COMMENT:"// 带状态的消息对象, 对应同步协议type=1000"},ReceiverMessageStatusModel:{def:{readStatus:["1","int","readStatus","// * 接收者 是否已读这个消息 2-已读，其他-未读"]},COMMENT:"// 针对接收者的消息状态"},SenderMessageStatusModel:{def:{unReadCount:["1","int","unReadCount","// * 这条消息还有多少人未读"],totalCount:["2","int","totalCount","// * 消息发送到的总人数"]},COMMENT:"// 针对发送者的消息状态"},ContentModel:{def:{contentType:["1","int","contentType","// 其余组合类型使用attachments字段，contentType限制使用100以上"],textContent:["2","TextContentModel","textContent","// * 文本对象"],photoContent:["3","PhotoContentModel","photoContent","// * 图片对象"],audioContent:["4","AudioContentModel","audioContent","// * 语音对象"],fileContent:["5","FileContentModel","fileContent","// * 普通文件对象"],extension:["6",["Object","string","string"],"extension","// * @Deprecated"],attachments:["7",["Array","AttachmentModel"],"attachments","// * 组合类型字段"],atOpenIds:["8",["Object","string","string"],"atOpenIds","// * @功能的openId列表，key是openId（服务端不支持long类型），value是nick,"]},COMMENT:"// 发送的消息内容"},TextContentModel:{def:{text:["1","string","text","// * 文本内容"],templateId:["2","string","templateId","// * 系统消息模板ID"],templateData:["3",["Array","string"],"templateData","// * 系统消息模板数据列表"]},COMMENT:"// 文本消息"},PhotoContentModel:{def:{mediaId:["1","string","mediaId","// * mediaId"],picSize:["2","int","picSize","// * 原始图片大小"],type:["3","int","type","// * 图片类型，自定义"],picBytes:["4","byte[]","picBytes","// * 缩略图数据，需要控制数据大小, 只是下行使用"],fileType:["5","int","fileType","// * 图片类型 1-webp, 2-png, 3-jpg, 4-gif, 目前只有webp，只是下行使用"],orientation:["6","int","orientation","// * 图片方向，1-normal, 2-flip_horizontal, 3-rotate_180, 4-flip_vertical, 5-transpose, 6-rotate_90, 7-transverse, 8-rotate_270"]},COMMENT:"// 文本消息"},AudioContentModel:{def:{mediaId:["1","string","mediaId","// * mediaId"],duration:["2","int","duration","// * 语音时常"],audioVolumns:["3",["Array","int"],"audioVolumns","// * 语音波形"],audioBytes:["4","byte[]","audioBytes","// * 语音数据，需要控制数据大小, 只是下行使用"]},COMMENT:"// 文本消息"},FileContentModel:{def:{mediaId:["1","string","mediaId","// * mediaId"],fileName:["2","string","fileName","// * 文件名"],fileType:["3","string","fileType","// * 文件类型，取文件后缀"],fileSize:["4","int","fileSize","// * 文件大小"]},COMMENT:"// 文本消息"},OpenIdExModel:{def:{openId:["1","int","openId","// * 信息发送者id"],tag:["2","int","tag","// * 信息发送者的更新相关"]},COMMENT:"// openID扩展对象"},MemberRoleModel:{def:{openIdEx:["1","OpenIdExModel","openIdEx"],role:["2","int","role","// *1 群主，2管理员(现不用)，3普通用户"]},COMMENT:"// openID扩展对象"},UnReadMemberModel:{def:{openIdEx:["1","OpenIdExModel","openIdEx","// * openId和tag"],status:["2","int","status","// 0-未送达，1-已送达，未读，2-已送达，已读"]},COMMENT:"// 未读成员对象"},MemberMessageStatusModel:{def:{openIdEx:["1","OpenIdExModel","openIdEx","// * openId和tag"],status:["2","int","status","// 消息是否已读状态，2-已读，其他 未读"],reachStatus:["3","int","reachStatus","// 消息是否已送达，0和1、未达，2、已达"]},COMMENT:"//成员消息对象--暂时与 UnReadMemberModel有重复"},SendResultModel:{def:{messageId:["1","int","messageId","// * 消息id"],createdAt:["2","int","createdAt","// * 消息创建时间，服务端时间"],model:["3","SenderMessageStatusModel","model","// 未读人数"]},COMMENT:"// 消息发送结果对象（包括转发）"},CreateConversationModel:{def:{openIds:["1",["Array","int"],"openIds","// * 会话成员列表"],title:["2","string","title","// * 会话的标题"],icon:["3","string","icon","// * 会话显示的图片地址信息"],extension:["4",["Object","string","string"],"extension","// * 扩展字段"],tag:["5","int","tag","// * 业务tag"],type:["6","int","type","// * 会话类型：1单聊，2群聊"],memberLimit:["7","int","memberLimit","// * 会话支持的最大人数"],superGroup:["8","int","superGroup","// * 是否开启已读未读功能 0非大群，1大群，其他数字可做大群等级扩展使用"],parentId:["9","string","parentId","// * 父会话id，默认空。"],nodeType:["10","int","nodeType","// * 是否 父会话，0-否，默认；1-是父会话，只作为入口使用"]},COMMENT:"// 创建会话对象"},CommonConversationModel:{def:{conversationId:["1","string","conversationId","// * 会话ID"],type:["2","int","type","// * 会话类型：1单聊，2群聊"],memberCount:["3","int","memberCount","// * 群聊人数"],title:["4","string","title","// * 会话的标题"],icon:["5","string","icon","// * 会话显示的图片地址信息"],tag:["6","int","tag","// * 业务tag"],extension:["7",["Object","string","string"],"extension","// 扩展字段"],authority:["8","int","authority","// * 群加人权限，0-默认，群成员都可以加人，1-只有群主可以加人"],ownerId:["9","int","ownerId","// * 群主openId"]},COMMENT:"// 会话公共属性对象，不包含用户私有的属性"},BaseConversationModel:{def:{conversationId:["1","string","conversationId","// * 会话ID"],type:["2","int","type","// * 会话类型：1单聊，2群聊"],memberCount:["3","int","memberCount","// * 群聊人数"],title:["4","string","title","// * 会话的标题"],icon:["5","string","icon","// * 会话显示的图片地址信息"],extension:["6",["Object","string","string"],"extension","// 扩展字段"],createAt:["7","int","createAt","// 创建时间"],memberExtension:["8",["Object","string","string"],"memberExtension","// * 扩展字段"],notificationOff:["9","int","notificationOff","// * 会话是否接受通知消息 0-接收通知，1-表示关闭通知，不接收消息"],tag:["10","int","tag","// * 业务tag"],sort:["11","int","sort","// * 会话排序字段sort，数值越大排序越靠前，针对设置的用户有效"],status:["12","int","status","// * 0-隐藏，1-可见"],notificationSound:["13","string","notificationSound","// * 通知提醒音，notificationOff为0时有效"],authority:["14","int","authority","// * 群加人权限，0-默认，群成员都可以加人，1-只有群主可以加人"],ownerId:["15","int","ownerId","// * 群主openId"],memberLimit:["16","int","memberLimit","// * 会话支持的最大人数"],superGroup:["17","int","superGroup","// * 0非大群，1大群，其他数字可做大群等级扩展使用"],unreadPoint:["18","int","unreadPoint","// * 红点数量标识"],parentId:["19","string","parentId",'// * 父会话id，默认"0"'],nodeType:["20","int","nodeType","// * 是否 父会话，0-否，默认；1-是父会话，只作为入口使用"]},COMMENT:"// 基础会话对象"},ConversationModel:{def:{baseConversation:["1","BaseConversationModel","baseConversation","// * 基础会话对象"],lastMessages:["2",["Array","MessageModel"],"lastMessages","// * 最后N条消息"]},COMMENT:"// 基础会话对象"},ReconnectMessageModel:{def:{messageList:["1",["Array","MessageModel"],"messageList","// 消息列表"],readList:["2",["Array","DeliveryMessageStatusModel"],"readList","// 消息状态，针对消息发送者"],
conversationList:["3",["Array","ConversationNotificationModel"],"conversationList","// 会话变更列表"],messageTagList:["4",["Array","MessageTagNoticeModel"],"messageTagList","// 消息tag变更列表"],readStatusList:["5",["Array","MessageReadStatusListModel"],"readStatusList","// * @Deprecated"],conversationPrivateList:["6",["Array","ConversationPrivateModel"],"conversationPrivateList","// 会话排序"],msgNoticeList:["8",["Array","MessageNoticeModel"],"msgNoticeList","// 消息变更通知"]},COMMENT:"// 客户端断线重连的推送消息，对应下行push topic：/s/reconn"},DeliveryMessageStatusModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],messageId:["2","int","messageId","// * 消息id"],status:["3","SenderMessageStatusModel","status","// * 未读人数"],uuid:["4","string","uuid","// * 发送消息的uuid"]},COMMENT:"// 推送消息状态对象，对应下行push topic：/s/status"},ConversationNotificationModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],memberCount:["2","int","memberCount","// * 群成员数"],title:["3","string","title","// * 群标题"],icon:["4","string","icon","// * 群icon"],isKicked:["5","boolean","isKicked","// * true 表示被踢"],tag:["6","int","tag","// * 业务tag"],extension:["7",["Object","string","string"],"extension","// * 扩展字段"],isQuit:["8","boolean","isQuit","// * true 主动退群"],isDisband:["9","boolean","isDisband","// * 是否解散群"],authority:["10","int","authority","// * 群加人权限，0-默认，群成员都可以加人，1-只有群主可以加人"],memberLimit:["11","int","memberLimit","// * 会话支持的最大人数"],superGroup:["12","int","superGroup","// * 是否开启已读未读功能 0非大群，1大群，其他数字可做大群等级扩展使用"]},COMMENT:"// 群聊成员、title和icon 变更推送，该消息只有推送通道，对应下行push topic：/s/convex"},MessageTagNoticeModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],messageId:["2","int","messageId","// * 消息id"],memberTag:["3","int","memberTag","// * 业务tag"],memberExtension:["4",["Object","string","string"],"memberExtension","// * 每个人自己的extension"]},COMMENT:"// 业务推送的privateTag or privateExtension变更对象，对应下行push topic：/s/msgTag"},MessageNoticeModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],messageId:["2","int","messageId","// * 消息id"],extension:["3",["Object","string","string"],"extension","// * extension"],recallStatus:["4","int","recallStatus","// * 是否为撤回消息"]},COMMENT:"// 业务推送的 extension变更对象, 对应下行push topic：/s/msgInfo, 对应同步协议type=1001"},MessageDeleteModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],messageId:["2","int","messageId","// * 消息id"]},COMMENT:"// 消息删除Model, 对应同步协议type=1002"},AttachmentModel:{def:{type:["1","int","type","// * 类型"],url:["2","string","url","// * 链接"],size:["3","int","size","// * 大小（文件大小, byte）"],data:["4","byte[]","data","// * 字节数据"],isPreload:["5","boolean","isPreload","// * 是否预加载url"],extension:["6",["Object","string","string"],"extension","// * 扩展字段"]},COMMENT:"// 附件，contentType > 100 解析该字段"},DeliveryMessageReadStatusModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],messageId:["2","int","messageId","// * 消息id"],status:["3","ReceiverMessageStatusModel","status","// * 针对接收者的消息状态，已读和未读"]},COMMENT:"// 消息已读状态对象，针对消息接受者，是为了同步web和客户端的read状态"},MessageReadStatusListModel:{def:{readStatusList:["1",["Array","DeliveryMessageReadStatusModel"],"readStatusList","// * 消息接受者的消息已读状态列表"]},COMMENT:"// 对应下行push topic：/s/readstatus"},XpnPushModel:{def:{sound:["1","string","sound","// * xpn声音字段"],action:["2","XpnActionModel","action","// * xpn统一跳转"],timeTolive:["3","int","timeTolive","// * xpn消息有效周期（ms）"],incrbadge:["4","int","incrbadge","// * xpn提示消息增量"],params:["5",["Object","string","string"],"params","// * xpn自定义参数"],alertContent:["6","string","alertContent","// * xpn推送消息内容"],isXpnOff:["7","int","isXpnOff","// * 是否关闭xpn"],templateId:["8","int","templateId","// * 模板ID"]},COMMENT:"// 服务端model。客户端请忽略"},XpnActionModel:{def:{templateKey:["1","string","templateKey","// * Action指定模板主键"],templateValue:["2","string","templateValue","// * Action指定模板替换值"]},COMMENT:"// 服务端model。客户端请忽略"},ConversationInfoModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],tag:["2","int","tag","// * 业务tag"],extension:["3",["Object","string","string"],"extension","// * 扩展字段"]},COMMENT:"// 会话信息更新model"},ConversationPrivateModel:{def:{conversationId:["1","string","conversationId","// * 会话id"],sort:["2","int","sort","// * 会话排序字段sort，数值越大排序越靠前，针对设置的用户有效"],hide:["3","boolean","hide","// * 会话隐藏"],notificationOff:["4","int","notificationOff","// * 会话是否接受通知消息 0-接收通知，1-表示关闭通知，不接收消息"]},COMMENT:"// 会话排序model，对应下行push topic: /s/conp"}}),c.model.auth=d({OAuthModel:{def:{accessToken:["1","string","accessToken"],refreshToken:["2","string","refreshToken"],expertIn:["3","int","expertIn"],cmd:["4","string","cmd"],openId:["5","int","openId"]}},LoginModel:{def:{org:["1","string","org"],domain:["2","string","domain"],appKey:["3","string","appKey"],appSecret:["4","string","appSecret"],openId:["5","int","openId"],openSecret:["6","string","openSecret"],deviceId:["7","string","deviceId"],withRegister:["8","boolean","withRegister"]}},RefreshTokenModel:{def:{refreshToken:["1","string","refreshToken"],appKey:["2","string","appKey"],deviceId:["3","string","deviceId"]}},TokenLoginModel:{def:{domain:["1","string","domain"],appKey:["2","string","appKey"],deviceId:["3","string","deviceId"],secretToken:["4","string","secretToken"]}},SmsRequestModel:{def:{org:["1","string","org"],domain:["2","string","domain"],appKey:["3","string","appKey"],appSecret:["4","string","appSecret"],mobile:["5","string","mobile"],code:["6","string","code"],deviceId:["7","string","deviceId"]}},AdvancedLoginModel:{def:{domain:["1","string","domain"],appKey:["2","string","appKey"],openId:["3","int","openId"],nonce:["4","string","nonce"],timestamp:["5","int","timestamp","// 随机数"],signature:["6","string","signature"],deviceId:["7","string","deviceId","//签名，规则  SHA1(appToken,appSecret,openId,timestamp,nonce)"]}}}),c.model.oauth=d({DAuthModel:{def:{accessToken:["1","string","accessToken"],refreshToken:["2","string","refreshToken"],expireIn:["3","int","expireIn"],deviceId:["4","string","deviceId"]}},DeviceLoginModel:{def:{domain:["1","string","domain"],appKey:["2","string","appKey"],nonce:["3","string","nonce"],timestamp:["4","int","timestamp"],signature:["5","string","signature"],deviceId:["6","string","deviceId"],accessTokenPeriod:["7","int","accessTokenPeriod","/**自定义的accessToken有效期，单位毫秒。auth系统默认是1天。\n     *目前最长不得超过15天，最短不得低于1天.可以为null,则认为是1天\n     **/"]}}}),c.model.user=d({ProfileModel:{def:{openId:["1","int","openId"],nick:["2","string","nick"],nickPinyin:["3","string","nickPinyin"],gender:["4","int","gender"],avatar:["5","string","avatar"],remark:["6","string","remark"],dob:["7","int","dob"],city:["8","string","city"],stateCode:["9","string","stateCode"],mobile:["10","string","mobile"],isActive:["11","boolean","isActive"],ver:["12","int","ver"],extension:["13","string","extension"]}},AliasModel:{def:{openId:["1","int","openId"],alias:["2","string","alias"],pinyin:["3","string","pinyin","//别名内容"],audio:["4","string","audio","//备注名拼音"],extension:["5",["Object","string","string"],"extension","// 备注音"]}}}),c.model.relation=d({FollowModel:{def:{openId:["1","int","openId"],status:["2","int","status","// 对应的openid信息"],tag:["3","int","tag","// 对应的状态信息,0:following，1：follower，2：双向关系， -1：要推下去。"],lastModify:["4","int","lastModify","//由使用法自定义的筛选标记"]}},FollowPageModel:{def:{models:["1",["Array","FollowModel"],"models","//最后更新的时间戳"],nextCursor:["2","int","nextCursor","//返回的openid结果列表"],previousCursor:["3","int","previousCursor","// 下一页的起始cursor"]}},BlacklistModel:{def:{openId:["1","int","openId","// 4: long totalCount;           //这期暂不加入"],status:["2","int","status","// 对应的openid信息"],lastModify:["3","int","lastModify","// 对应的状态信息,0:openid在我的黑名单中，1：我在openid的黑名单中，2：双方互加为黑名单关系， -1：黑名单关系删除。"]}},BlacklistPageModel:{def:{models:["1",["Array","BlacklistModel"],"models","//最后更新的时间戳"],nextCursor:["2","int","nextCursor","// 返回的openid结果列表"],previousCursor:["3","int","previousCursor","// 下一页的起始cursor"]}}}),c.model.typing=d({TypingModel:{def:{conversationId:["1","string","conversationId"],type:["2","int","type","// 消息类型，0-文字，1-语音，2-图片"],command:["3","int","command","// typing状态，0-正在typing，1-取消typing"]}},DeliveryTypingModel:{def:{typingModels:["1",["Array","TypingModel"],"typingModels"]},COMMENT:"// 下行Typing model, 对应push topic: /s/typing"}}),c.model.push=d({NoticeModel:{def:{type:["1","int","type","// * 业务定义的事件类型"],content:["2","byte[]","content","// * 事件内容"]},COMMENT:"// 业务推送的事件对象"},NoticeListModel:{def:{noticeModels:["1",["Array","NoticeModel"],"noticeModels","// * 列表"]},COMMENT:"// 业务推送的事件列表对象"},PayloadModel:{def:{type:["1","int","type","// * 消息自定义类型"],content:["2","byte[]","content","// * 消息内容"],pushMessageId:["3","string","pushMessageId","// * 消息ID"]},COMMENT:"// 下行推送消息model"}}),c}},{"./dist/AliasI":65,"./dist/BlacklistI":66,"./dist/ColdBootI":67,"./dist/DAuthI":68,"./dist/FollowI":69,"./dist/IDLConversation":70,"./dist/IDLMessage":71,"./dist/IDLMessageStatus":72,"./dist/IDLSend":73,"./dist/Notification":74,"./dist/OAuthI":75,"./dist/Sync":76,"./dist/Typing":77,"./dist/UserI":78,"./keyPaddingGen":80}],80:[function(a,b,c){"use strict";var d=function(a){this.keys=this._processDef(a),this.paddings={};var b=this;Object.keys(a).forEach(function(a){b.paddings[a]=function(c){return b._padding(a,c)}})};d.prototype._padding=function(a,b){var c={},d=this;if(b&&this.keys[a]){var e=this.keys[a].keys;Object.keys(b).forEach(function(a){var f=parseInt(a);if(e[f]){var g=e[f].name,h=e[f].type;if("string"==typeof h&&d.keys[h])var i=d._padding(h,b[a]);else if(Array.isArray(h))if("Array"===h[0]&&d.keys[h[1]])var i=b[a].map(function(a){return d._padding(h[1],a)});else var i=b[a];else var i=b[a];c[g]=i}})}return c},d.prototype._processDef=function(a){var b={};return Object.keys(a).forEach(function(c){var d={};Object.keys(a[c].def).forEach(function(b){var e=a[c].def[b];d[parseInt(e[0])]={type:e[1],name:b}}),b[c]={keys:d}}),b};var e=function(a){return new d(a)};b.exports=e},{}],81:[function(a,b,c){b.exports=function(){var b=a("events"),c={};return c.createDomain=c.create=function(){function a(a){c.emit("error",a)}var c=new b.EventEmitter;return c.add=function(b){b.on("error",a)},c.remove=function(b){b.removeListener("error",a)},c.bind=function(b){return function(){var c=Array.prototype.slice.call(arguments);try{b.apply(null,c)}catch(d){a(d)}}},c.intercept=function(b){return function(c){if(c)a(c);else{var d=Array.prototype.slice.call(arguments,1);try{b.apply(null,d)}catch(c){a(c)}}}},c.run=function(b){try{b()}catch(c){a(c)}return this},c.dispose=function(){return this.removeAllListeners(),this},c.enter=c.exit=function(){return this},c},c}.call(this)},{events:82}],82:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function e(a){return"function"==typeof a}function f(a){return"number"==typeof a}function g(a){return"object"==typeof a&&null!==a}function h(a){return void 0===a}b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||g(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;throw TypeError('Uncaught, unspecified "error" event.')}if(c=this._events[a],h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];c.apply(this,f)}else if(g(c)){for(d=arguments.length,f=new Array(d-1),i=1;d>i;i++)f[i-1]=arguments[i];for(j=c.slice(),d=j.length,i=0;d>i;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned){var c;c=h(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),"function"==typeof console.trace&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-- >0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e(a._events[b])?1:a._events[b].length:0}},{}],83:[function(a,b,c){(function(a){function b(a,b){for(var c=0,d=a.length-1;d>=0;d--){var e=a[d];"."===e?a.splice(d,1):".."===e?(a.splice(d,1),c++):c&&(a.splice(d,1),c--)}if(b)for(;c--;c)a.unshift("..");return a}function d(a,b){if(a.filter)return a.filter(b);for(var c=[],d=0;d<a.length;d++)b(a[d],d,a)&&c.push(a[d]);return c}var e=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,f=function(a){return e.exec(a).slice(1)};c.resolve=function(){for(var c="",e=!1,f=arguments.length-1;f>=-1&&!e;f--){var g=f>=0?arguments[f]:a.cwd();if("string"!=typeof g)throw new TypeError("Arguments to path.resolve must be strings");g&&(c=g+"/"+c,e="/"===g.charAt(0))}return c=b(d(c.split("/"),function(a){return!!a}),!e).join("/"),(e?"/":"")+c||"."},c.normalize=function(a){var e=c.isAbsolute(a),f="/"===g(a,-1);return a=b(d(a.split("/"),function(a){return!!a}),!e).join("/"),a||e||(a="."),a&&f&&(a+="/"),(e?"/":"")+a},c.isAbsolute=function(a){return"/"===a.charAt(0)},c.join=function(){var a=Array.prototype.slice.call(arguments,0);return c.normalize(d(a,function(a,b){if("string"!=typeof a)throw new TypeError("Arguments to path.join must be strings");return a}).join("/"))},c.relative=function(a,b){function d(a){for(var b=0;b<a.length&&""===a[b];b++);for(var c=a.length-1;c>=0&&""===a[c];c--);return b>c?[]:a.slice(b,c-b+1)}a=c.resolve(a).substr(1),b=c.resolve(b).substr(1);for(var e=d(a.split("/")),f=d(b.split("/")),g=Math.min(e.length,f.length),h=g,i=0;g>i;i++)if(e[i]!==f[i]){h=i;break}for(var j=[],i=h;i<e.length;i++)j.push("..");return j=j.concat(f.slice(h)),j.join("/")},c.sep="/",c.delimiter=":",c.dirname=function(a){var b=f(a),c=b[0],d=b[1];return c||d?(d&&(d=d.substr(0,d.length-1)),c+d):"."},c.basename=function(a,b){var c=f(a)[2];return b&&c.substr(-1*b.length)===b&&(c=c.substr(0,c.length-b.length)),c},c.extname=function(a){return f(a)[3]};var g="b"==="ab".substr(-1)?function(a,b,c){return a.substr(b,c)}:function(a,b,c){return 0>b&&(b=a.length+b),a.substr(b,c)}}).call(this,a("_process"))},{_process:84}],84:[function(a,b,c){function d(){k=!1,h.length?j=h.concat(j):l=-1,j.length&&e()}function e(){if(!k){var a=setTimeout(d);k=!0;for(var b=j.length;b;){for(h=j,j=[];++l<b;)h[l].run();l=-1,b=j.length}h=null,k=!1,clearTimeout(a)}}function f(a,b){this.fun=a,this.array=b}function g(){}var h,i=b.exports={},j=[],k=!1,l=-1;i.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];j.push(new f(a,b)),1!==j.length||k||setTimeout(e,0)},f.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.binding=function(a){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(a){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},{}],85:[function(b,c,d){!function(b){function d(a){return a&&(a=a.toString().replace(h.pluses,"%20"),a=decodeURIComponent(a)),a}function e(a){var b=h.uri_parser,c=["source","protocol","authority","userInfo","user","password","host","port","isColonUri","relative","path","directory","file","query","anchor"],d=b.exec(a||""),e={};return c.forEach(function(a,b){e[a]=d[b]||""}),e}function f(a){var b,c,e,f,g,i,j,k=[];if("undefined"==typeof a||null===a||""===a)return k;for(0===a.indexOf("?")&&(a=a.substring(1)),c=a.toString().split(h.query_separator),b=0,j=c.length;j>b;b++)e=c[b],f=e.indexOf("="),0!==f&&(g=d(e.substring(0,f)),i=d(e.substring(f+1)),k.push(-1===f?[e,null]:[g,i]));return k}function g(a){this.uriParts=e(a),this.queryPairs=f(this.uriParts.query),this.hasAuthorityPrefixUserPref=null}var h={starts_with_slashes:/^\/+/,ends_with_slashes:/\/+$/,pluses:/\+/g,query_separator:/[&;]/,uri_parser:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@\/]*)(?::([^:@]*))?)?@)?(\[[0-9a-fA-F:.]+\]|[^:\/?#]*)(?::(\d+|(?=:)))?(:)?)((((?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/};Array.prototype.forEach||(Array.prototype.forEach=function(a,b){var c,d;if(null==this)throw new TypeError(" this is null or not defined");var e=Object(this),f=e.length>>>0;if("function"!=typeof a)throw new TypeError(a+" is not a function");for(arguments.length>1&&(c=b),d=0;f>d;){var g;d in e&&(g=e[d],a.call(c,g,d,e)),d++}}),["protocol","userInfo","host","port","path","anchor"].forEach(function(a){g.prototype[a]=function(b){return"undefined"!=typeof b&&(this.uriParts[a]=b),this.uriParts[a]}}),g.prototype.hasAuthorityPrefix=function(a){return"undefined"!=typeof a&&(this.hasAuthorityPrefixUserPref=a),null===this.hasAuthorityPrefixUserPref?-1!==this.uriParts.source.indexOf("//"):this.hasAuthorityPrefixUserPref},g.prototype.isColonUri=function(a){return"undefined"==typeof a?!!this.uriParts.isColonUri:void(this.uriParts.isColonUri=!!a)},g.prototype.query=function(a){var b,c,d,e="";for("undefined"!=typeof a&&(this.queryPairs=f(a)),b=0,d=this.queryPairs.length;d>b;b++)c=this.queryPairs[b],e.length>0&&(e+="&"),null===c[1]?e+=c[0]:(e+=c[0],e+="=","undefined"!=typeof c[1]&&(e+=encodeURIComponent(c[1])));return e.length>0?"?"+e:e},g.prototype.getQueryParamValue=function(a){var b,c,d;for(c=0,d=this.queryPairs.length;d>c;c++)if(b=this.queryPairs[c],a===b[0])return b[1]},g.prototype.getQueryParamValues=function(a){var b,c,d,e=[];for(b=0,d=this.queryPairs.length;d>b;b++)c=this.queryPairs[b],a===c[0]&&e.push(c[1]);return e},g.prototype.deleteQueryParam=function(a,b){var c,e,f,g,h,i=[];for(c=0,h=this.queryPairs.length;h>c;c++)e=this.queryPairs[c],f=d(e[0])===d(a),g=e[1]===b,(1!==arguments.length||f)&&(2!==arguments.length||f&&g)||i.push(e);return this.queryPairs=i,this},g.prototype.addQueryParam=function(a,b,c){return 3===arguments.length&&-1!==c?(c=Math.min(c,this.queryPairs.length),this.queryPairs.splice(c,0,[a,b])):arguments.length>0&&this.queryPairs.push([a,b]),this},g.prototype.hasQueryParam=function(a){var b,c=this.queryPairs.length;for(b=0;c>b;b++)if(this.queryPairs[b][0]==a)return!0;return!1},g.prototype.replaceQueryParam=function(a,b,c){var e,f,g=-1,h=this.queryPairs.length;if(3===arguments.length){for(e=0;h>e;e++)if(f=this.queryPairs[e],d(f[0])===d(a)&&decodeURIComponent(f[1])===d(c)){g=e;break}g>=0&&this.deleteQueryParam(a,d(c)).addQueryParam(a,b,g)}else{for(e=0;h>e;e++)if(f=this.queryPairs[e],d(f[0])===d(a)){g=e;break}this.deleteQueryParam(a),this.addQueryParam(a,b,g)}return this},["protocol","hasAuthorityPrefix","isColonUri","userInfo","host","port","path","query","anchor"].forEach(function(a){var b="set"+a.charAt(0).toUpperCase()+a.slice(1);g.prototype[b]=function(b){return this[a](b),this}}),g.prototype.scheme=function(){var a="";return this.protocol()?(a+=this.protocol(),this.protocol().indexOf(":")!==this.protocol().length-1&&(a+=":"),a+="//"):this.hasAuthorityPrefix()&&this.host()&&(a+="//"),a},g.prototype.origin=function(){var a=this.scheme();return this.userInfo()&&this.host()&&(a+=this.userInfo(),this.userInfo().indexOf("@")!==this.userInfo().length-1&&(a+="@")),this.host()&&(a+=this.host(),(this.port()||this.path()&&this.path().substr(0,1).match(/[0-9]/))&&(a+=":"+this.port())),a},g.prototype.addTrailingSlash=function(){var a=this.path()||"";return"/"!==a.substr(-1)&&this.path(a+"/"),this},g.prototype.toString=function(){var a,b=this.origin();return this.isColonUri()?this.path()&&(b+=":"+this.path()):this.path()?(a=this.path(),h.ends_with_slashes.test(b)||h.starts_with_slashes.test(a)?(b&&b.replace(h.ends_with_slashes,"/"),a=a.replace(h.starts_with_slashes,"/")):b+="/",b+=a):this.host()&&(this.query().toString()||this.anchor())&&(b+="/"),this.query().toString()&&(b+=this.query().toString()),this.anchor()&&(0!==this.anchor().indexOf("#")&&(b+="#"),b+=this.anchor()),b},g.prototype.clone=function(){return new g(this.toString())},"function"==typeof a&&a.amd?a(function(){return g}):"undefined"!=typeof c&&"undefined"!=typeof c.exports?c.exports=g:b.Uri=g}(this)},{}],86:[function(a,b,c){function d(a){var b=a?a.length:0;return b?a[b-1]:void 0}b.exports=d},{}],87:[function(a,b,c){function d(a,b,c,d){var i=a?a.length:0;return i?(null!=b&&"boolean"!=typeof b&&(d=c,c=g(a,b,d)?null:b,b=!1),c=null==c?c:e(c,d,3),b?h(a,c):f(a,c)):[]}var e=a("../internal/baseCallback"),f=a("../internal/baseUniq"),g=a("../internal/isIterateeCall"),h=a("../internal/sortedUniq");b.exports=d},{"../internal/baseCallback":93,"../internal/baseUniq":106,"../internal/isIterateeCall":121,"../internal/sortedUniq":127}],88:[function(a,b,c){function d(a,b){if("function"!=typeof a)throw new TypeError(e);return b=f(void 0===b?a.length-1:+b||0,0),function(){for(var c=arguments,d=-1,e=f(c.length-b,0),g=Array(e);++d<e;)g[d]=c[b+d];switch(b){case 0:return a.call(this,g);case 1:return a.call(this,c[0],g);case 2:return a.call(this,c[0],c[1],g)}var h=Array(b+1);for(d=-1;++d<b;)h[d]=c[d];return h[b]=g,a.apply(this,h)}}var e="Expected a function",f=Math.max;b.exports=d},{}],89:[function(a,b,c){(function(c){function d(a){var b=a?a.length:0;for(this.data={hash:h(null),set:new g};b--;)this.push(a[b])}var e=a("./cachePush"),f=a("./getNative"),g=f(c,"Set"),h=f(Object,"create");d.prototype.push=e,b.exports=d}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cachePush":109,"./getNative":117}],90:[function(a,b,c){function d(a,b){for(var c=-1,d=a.length;++c<d;)if(b(a[c],c,a))return!0;return!1}b.exports=d},{}],91:[function(a,b,c){function d(a,b,c){for(var d=-1,f=e(b),g=f.length;++d<g;){var h=f[d],i=a[h],j=c(i,b[h],h,a,b);(j===j?j===i:i!==i)&&(void 0!==i||h in a)||(a[h]=j)}return a}var e=a("../object/keys");b.exports=d},{"../object/keys":137}],92:[function(a,b,c){function d(a,b){return null==b?a:e(b,f(b),a)}var e=a("./baseCopy"),f=a("../object/keys");b.exports=d},{"../object/keys":137,"./baseCopy":94}],93:[function(a,b,c){function d(a,b,c){var d=typeof a;return"function"==d?void 0===b?a:g(a,b,c):null==a?h:"object"==d?e(a):void 0===b?i(a):f(a,b)}var e=a("./baseMatches"),f=a("./baseMatchesProperty"),g=a("./bindCallback"),h=a("../utility/identity"),i=a("../utility/property");b.exports=d},{"../utility/identity":142,"../utility/property":143,"./baseMatches":100,"./baseMatchesProperty":101,"./bindCallback":107}],94:[function(a,b,c){function d(a,b,c){c||(c={});for(var d=-1,e=b.length;++d<e;){var f=b[d];c[f]=a[f]}return c}b.exports=d},{}],95:[function(a,b,c){function d(a,b,c){if(null!=a){void 0!==c&&c in e(a)&&(b=[c]);for(var d=0,f=b.length;null!=a&&f>d;)a=a[b[d++]];return d&&d==f?a:void 0}}var e=a("./toObject");b.exports=d},{"./toObject":128}],96:[function(a,b,c){function d(a,b,c){if(b!==b)return e(a,c);for(var d=c-1,f=a.length;++d<f;)if(a[d]===b)return d;return-1}var e=a("./indexOfNaN");b.exports=d},{"./indexOfNaN":118}],97:[function(a,b,c){function d(a,b,c,h,i,j){return a===b?!0:null==a||null==b||!f(a)&&!g(b)?a!==a&&b!==b:e(a,b,d,c,h,i,j)}var e=a("./baseIsEqualDeep"),f=a("../lang/isObject"),g=a("./isObjectLike");b.exports=d},{"../lang/isObject":133,"./baseIsEqualDeep":98,"./isObjectLike":124}],98:[function(a,b,c){function d(a,b,c,d,m,p,q){var r=h(a),s=h(b),t=k,u=k;r||(t=o.call(a),t==j?t=l:t!=l&&(r=i(a))),s||(u=o.call(b),u==j?u=l:u!=l&&(s=i(b)));var v=t==l,w=u==l,x=t==u;if(x&&!r&&!v)return f(a,b,t);if(!m){var y=v&&n.call(a,"__wrapped__"),z=w&&n.call(b,"__wrapped__");if(y||z)return c(y?a.value():a,z?b.value():b,d,m,p,q)}if(!x)return!1;p||(p=[]),q||(q=[]);for(var A=p.length;A--;)if(p[A]==a)return q[A]==b;p.push(a),q.push(b);var B=(r?e:g)(a,b,c,d,m,p,q);return p.pop(),q.pop(),B}var e=a("./equalArrays"),f=a("./equalByTag"),g=a("./equalObjects"),h=a("../lang/isArray"),i=a("../lang/isTypedArray"),j="[object Arguments]",k="[object Array]",l="[object Object]",m=Object.prototype,n=m.hasOwnProperty,o=m.toString;b.exports=d},{"../lang/isArray":131,"../lang/isTypedArray":134,"./equalArrays":112,"./equalByTag":113,"./equalObjects":114}],99:[function(a,b,c){function d(a,b,c){var d=b.length,g=d,h=!c;if(null==a)return!g;for(a=f(a);d--;){var i=b[d];if(h&&i[2]?i[1]!==a[i[0]]:!(i[0]in a))return!1}for(;++d<g;){i=b[d];var j=i[0],k=a[j],l=i[1];if(h&&i[2]){if(void 0===k&&!(j in a))return!1}else{var m=c?c(k,l,j):void 0;if(!(void 0===m?e(l,k,c,!0):m))return!1}}return!0}var e=a("./baseIsEqual"),f=a("./toObject");b.exports=d},{"./baseIsEqual":97,"./toObject":128}],100:[function(a,b,c){function d(a){var b=f(a);if(1==b.length&&b[0][2]){var c=b[0][0],d=b[0][1];return function(a){return null==a?!1:a[c]===d&&(void 0!==d||c in g(a))}}return function(a){return e(a,b)}}var e=a("./baseIsMatch"),f=a("./getMatchData"),g=a("./toObject");b.exports=d},{"./baseIsMatch":99,"./getMatchData":116,"./toObject":128}],101:[function(a,b,c){function d(a,b){var c=h(a),d=i(a)&&j(b),n=a+"";return a=m(a),function(h){if(null==h)return!1;var i=n;if(h=l(h),(c||!d)&&!(i in h)){if(h=1==a.length?h:e(h,g(a,0,-1)),null==h)return!1;i=k(a),h=l(h)}return h[i]===b?void 0!==b||i in h:f(b,h[i],void 0,!0)}}var e=a("./baseGet"),f=a("./baseIsEqual"),g=a("./baseSlice"),h=a("../lang/isArray"),i=a("./isKey"),j=a("./isStrictComparable"),k=a("../array/last"),l=a("./toObject"),m=a("./toPath");b.exports=d},{"../array/last":86,"../lang/isArray":131,"./baseGet":95,"./baseIsEqual":97,"./baseSlice":104,"./isKey":122,"./isStrictComparable":125,"./toObject":128,"./toPath":129}],102:[function(a,b,c){function d(a){return function(b){return null==b?void 0:b[a]}}b.exports=d},{}],103:[function(a,b,c){function d(a){var b=a+"";return a=f(a),function(c){return e(c,a,b)}}var e=a("./baseGet"),f=a("./toPath");b.exports=d},{"./baseGet":95,"./toPath":129}],104:[function(a,b,c){function d(a,b,c){var d=-1,e=a.length;b=null==b?0:+b||0,0>b&&(b=-b>e?0:e+b),c=void 0===c||c>e?e:+c||0,0>c&&(c+=e),e=b>c?0:c-b>>>0,b>>>=0;for(var f=Array(e);++d<e;)f[d]=a[d+b];return f}b.exports=d},{}],105:[function(a,b,c){function d(a){return"string"==typeof a?a:null==a?"":a+""}b.exports=d},{}],106:[function(a,b,c){function d(a,b){var c=-1,d=e,h=a.length,i=!0,j=i&&h>=200,k=j?g():null,l=[];k?(d=f,i=!1):(j=!1,k=b?[]:l);a:for(;++c<h;){var m=a[c],n=b?b(m,c,a):m;if(i&&m===m){for(var o=k.length;o--;)if(k[o]===n)continue a;b&&k.push(n),l.push(m)}else d(k,n,0)<0&&((b||j)&&k.push(n),l.push(m))}return l}var e=a("./baseIndexOf"),f=a("./cacheIndexOf"),g=a("./createCache");b.exports=d},{"./baseIndexOf":96,"./cacheIndexOf":108,"./createCache":111}],107:[function(a,b,c){function d(a,b,c){if("function"!=typeof a)return e;if(void 0===b)return a;switch(c){case 1:return function(c){return a.call(b,c)};case 3:return function(c,d,e){return a.call(b,c,d,e)};case 4:return function(c,d,e,f){return a.call(b,c,d,e,f)};case 5:return function(c,d,e,f,g){return a.call(b,c,d,e,f,g)}}return function(){return a.apply(b,arguments)}}var e=a("../utility/identity");b.exports=d},{"../utility/identity":142}],108:[function(a,b,c){function d(a,b){var c=a.data,d="string"==typeof b||e(b)?c.set.has(b):c.hash[b];return d?0:-1}var e=a("../lang/isObject");b.exports=d},{"../lang/isObject":133}],109:[function(a,b,c){function d(a){var b=this.data;"string"==typeof a||e(a)?b.set.add(a):b.hash[a]=!0}var e=a("../lang/isObject");b.exports=d},{"../lang/isObject":133}],110:[function(a,b,c){function d(a){return g(function(b,c){var d=-1,g=null==b?0:c.length,h=g>2?c[g-2]:void 0,i=g>2?c[2]:void 0,j=g>1?c[g-1]:void 0;for("function"==typeof h?(h=e(h,j,5),g-=2):(h="function"==typeof j?j:void 0,g-=h?1:0),i&&f(c[0],c[1],i)&&(h=3>g?void 0:h,g=1);++d<g;){var k=c[d];k&&a(b,k,h)}return b})}var e=a("./bindCallback"),f=a("./isIterateeCall"),g=a("../function/restParam");b.exports=d},{"../function/restParam":88,"./bindCallback":107,"./isIterateeCall":121}],111:[function(a,b,c){(function(c){var d=a("./SetCache"),e=a("../utility/constant"),f=a("./getNative"),g=f(c,"Set"),h=f(Object,"create"),i=h&&g?function(a){return new d(a)}:e(null);b.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../utility/constant":141,"./SetCache":89,"./getNative":117}],112:[function(a,b,c){function d(a,b,c,d,f,g,h){var i=-1,j=a.length,k=b.length;if(j!=k&&!(f&&k>j))return!1;for(;++i<j;){var l=a[i],m=b[i],n=d?d(f?m:l,f?l:m,i):void 0;if(void 0!==n){if(n)continue;return!1}if(f){if(!e(b,function(a){return l===a||c(l,a,d,f,g,h)}))return!1}else if(l!==m&&!c(l,m,d,f,g,h))return!1}return!0}var e=a("./arraySome");b.exports=d},{"./arraySome":90}],113:[function(a,b,c){function d(a,b,c){switch(c){case e:case f:return+a==+b;case g:return a.name==b.name&&a.message==b.message;case h:return a!=+a?b!=+b:a==+b;case i:case j:return a==b+""}return!1}var e="[object Boolean]",f="[object Date]",g="[object Error]",h="[object Number]",i="[object RegExp]",j="[object String]";b.exports=d},{}],114:[function(a,b,c){function d(a,b,c,d,f,h,i){var j=e(a),k=j.length,l=e(b),m=l.length;if(k!=m&&!f)return!1;for(var n=k;n--;){var o=j[n];if(!(f?o in b:g.call(b,o)))return!1}for(var p=f;++n<k;){o=j[n];var q=a[o],r=b[o],s=d?d(f?r:q,f?q:r,o):void 0;if(!(void 0===s?c(q,r,d,f,h,i):s))return!1;p||(p="constructor"==o)}if(!p){var t=a.constructor,u=b.constructor;if(t!=u&&"constructor"in a&&"constructor"in b&&!("function"==typeof t&&t instanceof t&&"function"==typeof u&&u instanceof u))return!1}return!0}var e=a("../object/keys"),f=Object.prototype,g=f.hasOwnProperty;b.exports=d},{"../object/keys":137}],115:[function(a,b,c){var d=a("./baseProperty"),e=d("length");b.exports=e},{"./baseProperty":102}],116:[function(a,b,c){function d(a){for(var b=f(a),c=b.length;c--;)b[c][2]=e(b[c][1]);return b}var e=a("./isStrictComparable"),f=a("../object/pairs");b.exports=d},{"../object/pairs":139,"./isStrictComparable":125}],117:[function(a,b,c){function d(a,b){var c=null==a?void 0:a[b];return e(c)?c:void 0}var e=a("../lang/isNative");b.exports=d},{"../lang/isNative":132}],118:[function(a,b,c){function d(a,b,c){for(var d=a.length,e=b+(c?0:-1);c?e--:++e<d;){
var f=a[e];if(f!==f)return e}return-1}b.exports=d},{}],119:[function(a,b,c){function d(a){return null!=a&&f(e(a))}var e=a("./getLength"),f=a("./isLength");b.exports=d},{"./getLength":115,"./isLength":123}],120:[function(a,b,c){function d(a,b){return a="number"==typeof a||e.test(a)?+a:-1,b=null==b?f:b,a>-1&&a%1==0&&b>a}var e=/^\d+$/,f=9007199254740991;b.exports=d},{}],121:[function(a,b,c){function d(a,b,c){if(!g(c))return!1;var d=typeof b;if("number"==d?e(c)&&f(b,c.length):"string"==d&&b in c){var h=c[b];return a===a?a===h:h!==h}return!1}var e=a("./isArrayLike"),f=a("./isIndex"),g=a("../lang/isObject");b.exports=d},{"../lang/isObject":133,"./isArrayLike":119,"./isIndex":120}],122:[function(a,b,c){function d(a,b){var c=typeof a;if("string"==c&&h.test(a)||"number"==c)return!0;if(e(a))return!1;var d=!g.test(a);return d||null!=b&&a in f(b)}var e=a("../lang/isArray"),f=a("./toObject"),g=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,h=/^\w*$/;b.exports=d},{"../lang/isArray":131,"./toObject":128}],123:[function(a,b,c){function d(a){return"number"==typeof a&&a>-1&&a%1==0&&e>=a}var e=9007199254740991;b.exports=d},{}],124:[function(a,b,c){function d(a){return!!a&&"object"==typeof a}b.exports=d},{}],125:[function(a,b,c){function d(a){return a===a&&!e(a)}var e=a("../lang/isObject");b.exports=d},{"../lang/isObject":133}],126:[function(a,b,c){function d(a){for(var b=i(a),c=b.length,d=c&&a.length,j=!!d&&h(d)&&(f(a)||e(a)),l=-1,m=[];++l<c;){var n=b[l];(j&&g(n,d)||k.call(a,n))&&m.push(n)}return m}var e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("./isIndex"),h=a("./isLength"),i=a("../object/keysIn"),j=Object.prototype,k=j.hasOwnProperty;b.exports=d},{"../lang/isArguments":130,"../lang/isArray":131,"../object/keysIn":138,"./isIndex":120,"./isLength":123}],127:[function(a,b,c){function d(a,b){for(var c,d=-1,e=a.length,f=-1,g=[];++d<e;){var h=a[d],i=b?b(h,d,a):h;d&&c===i||(c=i,g[++f]=h)}return g}b.exports=d},{}],128:[function(a,b,c){function d(a){return e(a)?a:Object(a)}var e=a("../lang/isObject");b.exports=d},{"../lang/isObject":133}],129:[function(a,b,c){function d(a){if(f(a))return a;var b=[];return e(a).replace(g,function(a,c,d,e){b.push(d?e.replace(h,"$1"):c||a)}),b}var e=a("./baseToString"),f=a("../lang/isArray"),g=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,h=/\\(\\)?/g;b.exports=d},{"../lang/isArray":131,"./baseToString":105}],130:[function(a,b,c){function d(a){return f(a)&&e(a)&&i.call(a)==g}var e=a("../internal/isArrayLike"),f=a("../internal/isObjectLike"),g="[object Arguments]",h=Object.prototype,i=h.toString;b.exports=d},{"../internal/isArrayLike":119,"../internal/isObjectLike":124}],131:[function(a,b,c){var d=a("../internal/getNative"),e=a("../internal/isLength"),f=a("../internal/isObjectLike"),g="[object Array]",h=Object.prototype,i=h.toString,j=d(Array,"isArray"),k=j||function(a){return f(a)&&e(a.length)&&i.call(a)==g};b.exports=k},{"../internal/getNative":117,"../internal/isLength":123,"../internal/isObjectLike":124}],132:[function(a,b,c){function d(a){return null==a?!1:l.call(a)==g?m.test(j.call(a)):f(a)&&h.test(a)}var e=a("../string/escapeRegExp"),f=a("../internal/isObjectLike"),g="[object Function]",h=/^\[object .+?Constructor\]$/,i=Object.prototype,j=Function.prototype.toString,k=i.hasOwnProperty,l=i.toString,m=RegExp("^"+e(j.call(k)).replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");b.exports=d},{"../internal/isObjectLike":124,"../string/escapeRegExp":140}],133:[function(a,b,c){function d(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}b.exports=d},{}],134:[function(a,b,c){function d(a){return f(a)&&e(a.length)&&!!D[F.call(a)]}var e=a("../internal/isLength"),f=a("../internal/isObjectLike"),g="[object Arguments]",h="[object Array]",i="[object Boolean]",j="[object Date]",k="[object Error]",l="[object Function]",m="[object Map]",n="[object Number]",o="[object Object]",p="[object RegExp]",q="[object Set]",r="[object String]",s="[object WeakMap]",t="[object ArrayBuffer]",u="[object Float32Array]",v="[object Float64Array]",w="[object Int8Array]",x="[object Int16Array]",y="[object Int32Array]",z="[object Uint8Array]",A="[object Uint8ClampedArray]",B="[object Uint16Array]",C="[object Uint32Array]",D={};D[u]=D[v]=D[w]=D[x]=D[y]=D[z]=D[A]=D[B]=D[C]=!0,D[g]=D[h]=D[t]=D[i]=D[j]=D[k]=D[l]=D[m]=D[n]=D[o]=D[p]=D[q]=D[r]=D[s]=!1;var E=Object.prototype,F=E.toString;b.exports=d},{"../internal/isLength":123,"../internal/isObjectLike":124}],135:[function(a,b,c){var d=a("../internal/assignWith"),e=a("../internal/baseAssign"),f=a("../internal/createAssigner"),g=f(function(a,b,c){return c?d(a,b,c):e(a,b)});b.exports=g},{"../internal/assignWith":91,"../internal/baseAssign":92,"../internal/createAssigner":110}],136:[function(a,b,c){function d(a,b,c){var d=null==a?void 0:e(a,f(b),b+"");return void 0===d?c:d}var e=a("../internal/baseGet"),f=a("../internal/toPath");b.exports=d},{"../internal/baseGet":95,"../internal/toPath":129}],137:[function(a,b,c){var d=a("../internal/getNative"),e=a("../internal/isArrayLike"),f=a("../lang/isObject"),g=a("../internal/shimKeys"),h=d(Object,"keys"),i=h?function(a){var b=null==a?null:a.constructor;return"function"==typeof b&&b.prototype===a||"function"!=typeof a&&e(a)?g(a):f(a)?h(a):[]}:g;b.exports=i},{"../internal/getNative":117,"../internal/isArrayLike":119,"../internal/shimKeys":126,"../lang/isObject":133}],138:[function(a,b,c){function d(a){if(null==a)return[];i(a)||(a=Object(a));var b=a.length;b=b&&h(b)&&(f(a)||e(a))&&b||0;for(var c=a.constructor,d=-1,j="function"==typeof c&&c.prototype===a,l=Array(b),m=b>0;++d<b;)l[d]=d+"";for(var n in a)m&&g(n,b)||"constructor"==n&&(j||!k.call(a,n))||l.push(n);return l}var e=a("../lang/isArguments"),f=a("../lang/isArray"),g=a("../internal/isIndex"),h=a("../internal/isLength"),i=a("../lang/isObject"),j=Object.prototype,k=j.hasOwnProperty;b.exports=d},{"../internal/isIndex":120,"../internal/isLength":123,"../lang/isArguments":130,"../lang/isArray":131,"../lang/isObject":133}],139:[function(a,b,c){function d(a){a=f(a);for(var b=-1,c=e(a),d=c.length,g=Array(d);++b<d;){var h=c[b];g[b]=[h,a[h]]}return g}var e=a("./keys"),f=a("../internal/toObject");b.exports=d},{"../internal/toObject":128,"./keys":137}],140:[function(a,b,c){function d(a){return a=e(a),a&&g.test(a)?a.replace(f,"\\$&"):a}var e=a("../internal/baseToString"),f=/[.*+?^${}()|[\]\/\\]/g,g=RegExp(f.source);b.exports=d},{"../internal/baseToString":105}],141:[function(a,b,c){function d(a){return function(){return a}}b.exports=d},{}],142:[function(a,b,c){function d(a){return a}b.exports=d},{}],143:[function(a,b,c){function d(a){return g(a)?e(a):f(a)}var e=a("../internal/baseProperty"),f=a("../internal/basePropertyDeep"),g=a("../internal/isKey");b.exports=d},{"../internal/baseProperty":102,"../internal/basePropertyDeep":103,"../internal/isKey":122}],144:[function(a,b,c){"use strict";b.exports=a("./lib")},{"./lib":149}],145:[function(a,b,c){"use strict";function d(){}function e(a){try{return a.then}catch(b){return console.error(b),q=b,r}}function f(a,b){try{return a(b)}catch(c){return console.error(c),q=c,r}}function g(a,b,c){try{a(b,c)}catch(d){return console.error(d),q=d,r}}function h(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._37=0,this._12=null,this._59=[],a!==d&&o(a,this)}function i(a,b,c){return new a.constructor(function(e,f){var g=new h(d);g.then(e,f),j(a,new n(b,c,g))})}function j(a,b){for(;3===a._37;)a=a._12;return 0===a._37?void a._59.push(b):void p(function(){var c=1===a._37?b.onFulfilled:b.onRejected;if(null===c)return void(1===a._37?k(b.promise,a._12):l(b.promise,a._12));var d=f(c,a._12);d===r?l(b.promise,q):k(b.promise,d)})}function k(a,b){if(b===a)return l(a,new TypeError("A promise cannot be resolved with itself."));if(b&&("object"==typeof b||"function"==typeof b)){var c=e(b);if(c===r)return l(a,q);if(c===a.then&&b instanceof h)return a._37=3,a._12=b,void m(a);if("function"==typeof c)return void o(c.bind(b),a)}a._37=1,a._12=b,m(a)}function l(a,b){a._37=2,a._12=b,m(a)}function m(a){for(var b=0;b<a._59.length;b++)j(a,a._59[b]);a._59=null}function n(a,b,c){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.promise=c}function o(a,b){var c=!1,d=g(a,function(a){c||(c=!0,k(b,a))},function(a){c||(c=!0,l(b,a))});c||d!==r||(c=!0,l(b,q))}var p=a("asap/raw"),q=null,r={};b.exports=h,h._99=d,h.prototype.then=function(a,b){if(this.constructor!==h)return i(this,a,b);var c=new h(d);return j(this,new n(a,b,c)),c}},{"asap/raw":153}],146:[function(a,b,c){"use strict";var d=a("./core.js");b.exports=d,d.prototype.done=function(a,b){var c=arguments.length?this.then.apply(this,arguments):this;c.then(null,function(a){setTimeout(function(){throw a},0)})}},{"./core.js":145}],147:[function(a,b,c){"use strict";function d(a){var b=new e(e._99);return b._37=1,b._12=a,b}var e=a("./core.js");b.exports=e;var f=d(!0),g=d(!1),h=d(null),i=d(void 0),j=d(0),k=d("");e.resolve=function(a){if(a instanceof e)return a;if(null===a)return h;if(void 0===a)return i;if(a===!0)return f;if(a===!1)return g;if(0===a)return j;if(""===a)return k;if("object"==typeof a||"function"==typeof a)try{var b=a.then;if("function"==typeof b)return new e(b.bind(a))}catch(c){return new e(function(a,b){b(c)})}return d(a)},e.all=function(a){var b=Array.prototype.slice.call(a);return new e(function(a,c){function d(g,h){if(h&&("object"==typeof h||"function"==typeof h)){if(h instanceof e&&h.then===e.prototype.then){for(;3===h._37;)h=h._12;return 1===h._37?d(g,h._12):(2===h._37&&c(h._12),void h.then(function(a){d(g,a)},c))}var i=h.then;if("function"==typeof i){var j=new e(i.bind(h));return void j.then(function(a){d(g,a)},c)}}b[g]=h,0===--f&&a(b)}if(0===b.length)return a([]);for(var f=b.length,g=0;g<b.length;g++)d(g,b[g])})},e.reject=function(a){return new e(function(b,c){c(a)})},e.race=function(a){return new e(function(b,c){a.forEach(function(a){e.resolve(a).then(b,c)})})},e.prototype["catch"]=function(a){return this.then(null,a)}},{"./core.js":145}],148:[function(a,b,c){"use strict";var d=a("./core.js");b.exports=d,d.prototype["finally"]=function(a){return this.then(function(b){return d.resolve(a()).then(function(){return b})},function(b){return d.resolve(a()).then(function(){throw b})})}},{"./core.js":145}],149:[function(a,b,c){"use strict";b.exports=a("./core.js"),a("./done.js"),a("./finally.js"),a("./es6-extensions.js"),a("./node-extensions.js")},{"./core.js":145,"./done.js":146,"./es6-extensions.js":147,"./finally.js":148,"./node-extensions.js":150}],150:[function(a,b,c){"use strict";var d=a("./core.js"),e=a("asap");b.exports=d,d.denodeify=function(a,b){return b=b||1/0,function(){var c=this,e=Array.prototype.slice.call(arguments,0,b>0?b:0);return new d(function(b,d){e.push(function(a,c){a?d(a):b(c)});var f=a.apply(c,e);!f||"object"!=typeof f&&"function"!=typeof f||"function"!=typeof f.then||b(f)})}},d.nodeify=function(a){return function(){var b=Array.prototype.slice.call(arguments),c="function"==typeof b[b.length-1]?b.pop():null,f=this;try{return a.apply(this,arguments).nodeify(c,f)}catch(g){if(null===c||"undefined"==typeof c)return new d(function(a,b){b(g)});e(function(){c.call(f,g)})}}},d.prototype.nodeify=function(a,b){return"function"!=typeof a?this:void this.then(function(c){e(function(){a.call(b,null,c)})},function(c){e(function(){a.call(b,c)})})}},{"./core.js":145,asap:151}],151:[function(a,b,c){"use strict";function d(){if(i.length)throw i.shift()}function e(a){var b;b=h.length?h.pop():new f,b.task=a,g(b)}function f(){this.task=null}var g=a("./raw"),h=[],i=[],j=g.makeRequestCallFromTimer(d);b.exports=e,f.prototype.call=function(){try{this.task.call()}catch(a){e.onerror?e.onerror(a):(i.push(a),j())}finally{this.task=null,h[h.length]=this}}},{"./raw":152}],152:[function(a,b,c){(function(a){"use strict";function c(a){h.length||(g(),i=!0),h[h.length]=a}function d(){for(;j<h.length;){var a=j;if(j+=1,h[a].call(),j>k){for(var b=0,c=h.length-j;c>b;b++)h[b]=h[b+j];h.length-=j,j=0}}h.length=0,j=0,i=!1}function e(a){var b=1,c=new l(a),d=document.createTextNode("");return c.observe(d,{characterData:!0}),function(){b=-b,d.data=b}}function f(a){return function(){function b(){clearTimeout(c),clearInterval(d),a()}var c=setTimeout(b,0),d=setInterval(b,50)}}b.exports=c;var g,h=[],i=!1,j=0,k=1024,l=a.MutationObserver||a.WebKitMutationObserver;g="function"==typeof l?e(d):f(d),c.requestFlush=g,c.makeRequestCallFromTimer=f}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],153:[function(a,b,c){(function(c){"use strict";function d(a){i.length||(f(),j=!0),i[i.length]=a}function e(){for(;k<i.length;){var a=k;if(k+=1,i[a].call(),k>l){for(var b=0,c=i.length-k;c>b;b++)i[b]=i[b+k];i.length-=k,k=0}}i.length=0,k=0,j=!1}function f(){var b=c.domain;b&&(g||(g=a("domain")),g.active=c.domain=null),j&&h?setImmediate(e):c.nextTick(e),b&&(g.active=c.domain=b)}var g,h="function"==typeof setImmediate;b.exports=d;var i=[],j=!1,k=0,l=1024;d.requestFlush=f}).call(this,a("_process"))},{_process:84,domain:81}],154:[function(a,b,c){(function(a){var c;if(a.crypto&&crypto.getRandomValues){var d=new Uint8Array(16);c=function(){return crypto.getRandomValues(d),d}}if(!c){var e=new Array(16);c=function(){for(var a,b=0;16>b;b++)0===(3&b)&&(a=4294967296*Math.random()),e[b]=a>>>((3&b)<<3)&255;return e}}b.exports=c}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],155:[function(a,b,c){function d(a,b,c){var d=b&&c||0,e=0;for(b=b||[],a.toLowerCase().replace(/[0-9a-f]{2}/g,function(a){16>e&&(b[d+e++]=j[a])});16>e;)b[d+e++]=0;return b}function e(a,b){var c=b||0,d=i;return d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+"-"+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]+d[a[c++]]}function f(a,b,c){var d=b&&c||0,f=b||[];a=a||{};var g=void 0!==a.clockseq?a.clockseq:n,h=void 0!==a.msecs?a.msecs:(new Date).getTime(),i=void 0!==a.nsecs?a.nsecs:p+1,j=h-o+(i-p)/1e4;if(0>j&&void 0===a.clockseq&&(g=g+1&16383),(0>j||h>o)&&void 0===a.nsecs&&(i=0),i>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=h,p=i,n=g,h+=122192928e5;var k=(1e4*(268435455&h)+i)%4294967296;f[d++]=k>>>24&255,f[d++]=k>>>16&255,f[d++]=k>>>8&255,f[d++]=255&k;var l=h/4294967296*1e4&268435455;f[d++]=l>>>8&255,f[d++]=255&l,f[d++]=l>>>24&15|16,f[d++]=l>>>16&255,f[d++]=g>>>8|128,f[d++]=255&g;for(var q=a.node||m,r=0;6>r;r++)f[d+r]=q[r];return b?b:e(f)}function g(a,b,c){var d=b&&c||0;"string"==typeof a&&(b="binary"==a?new Array(16):null,a=null),a=a||{};var f=a.random||(a.rng||h)();if(f[6]=15&f[6]|64,f[8]=63&f[8]|128,b)for(var g=0;16>g;g++)b[d+g]=f[g];return b||e(f)}for(var h=a("./rng"),i=[],j={},k=0;256>k;k++)i[k]=(k+256).toString(16).substr(1),j[i[k]]=k;var l=h(),m=[1|l[0],l[1],l[2],l[3],l[4],l[5]],n=16383&(l[6]<<8|l[7]),o=0,p=0,q=g;q.v1=f,q.v4=g,q.parse=d,q.unparse=e,b.exports=q},{"./rng":154}],156:[function(b,c,d){(function(){"use strict";function b(){}function d(a,b){for(var c=a.length;c--;)if(a[c].listener===b)return c;return-1}function e(a){return function(){return this[a].apply(this,arguments)}}var f=b.prototype,g=this,h=g.EventEmitter;f.getListeners=function(a){var b,c,d=this._getEvents();if(a instanceof RegExp){b={};for(c in d)d.hasOwnProperty(c)&&a.test(c)&&(b[c]=d[c])}else b=d[a]||(d[a]=[]);return b},f.flattenListeners=function(a){var b,c=[];for(b=0;b<a.length;b+=1)c.push(a[b].listener);return c},f.getListenersAsObject=function(a){var b,c=this.getListeners(a);return c instanceof Array&&(b={},b[a]=c),b||c},f.addListener=function(a,b){var c,e=this.getListenersAsObject(a),f="object"==typeof b;for(c in e)e.hasOwnProperty(c)&&-1===d(e[c],b)&&e[c].push(f?b:{listener:b,once:!1});return this},f.on=e("addListener"),f.addOnceListener=function(a,b){return this.addListener(a,{listener:b,once:!0})},f.once=e("addOnceListener"),f.defineEvent=function(a){return this.getListeners(a),this},f.defineEvents=function(a){for(var b=0;b<a.length;b+=1)this.defineEvent(a[b]);return this},f.removeListener=function(a,b){var c,e,f=this.getListenersAsObject(a);for(e in f)f.hasOwnProperty(e)&&(c=d(f[e],b),-1!==c&&f[e].splice(c,1));return this},f.off=e("removeListener"),f.addListeners=function(a,b){return this.manipulateListeners(!1,a,b)},f.removeListeners=function(a,b){return this.manipulateListeners(!0,a,b)},f.manipulateListeners=function(a,b,c){var d,e,f=a?this.removeListener:this.addListener,g=a?this.removeListeners:this.addListeners;if("object"!=typeof b||b instanceof RegExp)for(d=c.length;d--;)f.call(this,b,c[d]);else for(d in b)b.hasOwnProperty(d)&&(e=b[d])&&("function"==typeof e?f.call(this,d,e):g.call(this,d,e));return this},f.removeEvent=function(a){var b,c=typeof a,d=this._getEvents();if("string"===c)delete d[a];else if(a instanceof RegExp)for(b in d)d.hasOwnProperty(b)&&a.test(b)&&delete d[b];else delete this._events;return this},f.removeAllListeners=e("removeEvent"),f.emitEvent=function(a,b){var c,d,e,f,g=this.getListenersAsObject(a);for(e in g)if(g.hasOwnProperty(e))for(d=g[e].length;d--;)c=g[e][d],c.once===!0&&this.removeListener(a,c.listener),f=c.listener.apply(this,b||[]),f===this._getOnceReturnValue()&&this.removeListener(a,c.listener);return this},f.trigger=e("emitEvent"),f.emit=function(a){var b=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,b)},f.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},f._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},f._getEvents=function(){return this._events||(this._events={})},b.noConflict=function(){return g.EventEmitter=h,b},"function"==typeof a&&a.amd?a(function(){return b}):"object"==typeof c&&c.exports?c.exports=b:g.EventEmitter=b}).call(this)},{}]},{},[1])(1)}),!__app)var __app={};WKim||$.alert("WKim are not load"),Handlebars||$.alert("Handlebars are not load"),__app.faceObj={domain:"http://www.renhe.cn/images/faces/",name:{"[呵呵]":"smilea.gif","[可爱]":"tza.gif","[可怜]":"kl.gif","[挖鼻屎]":"kbsa.gif","[吃惊]":"cj.gif","[挤眼]":"zy.gif","[闭嘴]":"bz.gif","[爱你]":"lovea.gif","[泪]":"sada.gif","[偷笑]":"heia.gif","[亲亲]":"qq.gif","[生病]":"sb.gif","[太开心]":"mb.gif","[懒得理你]":"ldln.gif","[右哼哼]":"yhh.gif","[左哼哼]":"zhh.gif","[嘘]":"x.gif","[衰]":"cry.gif","[委屈]":"wq.gif","[吐]":"t.gif","[打哈气]":"k.gif","[抱抱]":"bba.gif","[怒]":"angrya.gif","[疑问]":"yw.gif","[馋嘴]":"cza.gif","[拜拜]":"88.gif","[思考]":"sk.gif","[汗]":"sweata.gif","[困]":"sleepya.gif","[睡觉]":"sleepa.gif","[钱]":"money.gif","[失望]":"sw.gif","[酷]":"cool.gif","[花心]":"hsa.gif","[哼]":"hatea.gif","[悲伤]":"bs.gif","[抓狂]":"crazya.gif","[黑线]":"h.gif","[阴险]":"yx.gif","[怒骂]":"nm.gif","[心]":"hearta.gif","[伤心]":"unheart.gif","[微笑]":"hl_smile_open_mouth.png","[哈哈]":"hl_haha.png","[嘻嘻]":"hl_xixi.png","[眉开眼笑]":"hl_smiling_eyes.png","[光环]":"hl_smiling_halo.png","[安静]":"hl_hushed_face.png","[疑惑]":"hl_confused_face.png","[脸红]":"hl_blush.png","[高兴]":"hl_joy.png","[甜蜜微笑]":"hl_sweat_smile.png","[恶魔]":"hl_horns.png","[期待]":"hl_neutral_face.png","[生气]":"hl_angry_face.png","[笑呵呵]":"hl_smiley.png","[哈哈大笑]":"hl_laughing.png","[眨眼睛]":"hl_wink.png","[面无表情]":"hl_expressionles.png","[扮鬼脸]":"hl_grimacing.png","[愤怒]":"hl_rage.png","[好奇]":"hl_curiousness.png","[失望的]":"hl_disappointed.png","[恐惧]":"hl_fearful.png","[担心]":"hl_worried.png","[害羞]":"hl_flushed.png","[哭泣]":"hl_cry.png","[不屈不挠]":"hl_persevere.png","[皱眉]":"hl_frowning.png","[惊叫]":"hl_scream.png","[晕]":"hl_dizzy.png","[睡着]":"hl_sleeping.png","[胜利]":"hl_triumph.png","[苦恼]":"hl_anguished.png","[冷汗]":"hl_cold.png","[惊讶]":"hl_astonished.png","[抿嘴]":"hl_no_mouth.png","[口罩]":"hl_mask.png","[喜欢]":"hl_heart_eyes.png","[鬼脸]":"hl_closed_eyes.png","[亲一个]":"hl_kissing_smiling_eyes.png","[墨镜]":"hl_sunglasses.png","[困惑]":"hl_confounded.png","[沮丧]":"hl_disappointed.png","[吐舌头]":"hl_stuck_out_tongue.png","[美味]":"hl_yum.png","[飞吻]":"hl_kissing_heart.png","[大哭]":"hl_sob.png","[沉思]":"hl_pensive.png","[不悦]":"hl_unamused.png","[眨眼]":"hl_winking_eye.png","[亲一口]":"hl_kissing.png","[亲吻]":"hl_kissing_closed_eyes.png","[放心了]":"hl_relieved.png","[困了]":"hl_sleepy.png","[奸笑]":"hl_smirk.png","[举手]":"hl_raising_hand.png","[不行]":"hl_no_good.png","[撅嘴]":"hl_pouting_face.png","[奸笑猫]":"hl_smirk_cat.png","[喜欢猫]":"hl_heart_eyes_cat.png","[流汗]":"hl_sweat.png","[庆祝]":"hl_raised_hands.png","[可以]":"hl_ok_woman.png","[祈祷]":"hl_pray.png","[笑脸猫]":"hl_smile_cat.png","[亲亲猫]":"hl_kissing_cat.png","[疲倦]":"hl_tired_face.png","[皱眉头]":"hl_frowning.png","[鞠躬]":"hl_bow.png","[微笑猫]":"hl_smiley_cat.png","[欢乐猫]":"hl_joy_cat.png","[哭泣猫]":"hl_crying_cat.png","[宝贝]":"hl_baby.png","[男孩]":"hl_boy.png","[夫妇]":"hl_couple.png","[恩爱]":"hl_couple_with_heart.png","[接吻]":"hl_couplekiss.png","[家庭]":"hl_family.png","[女孩]":"hl_girl.png","[屎]":"hl_hankey.png","[不听]":"hl_hear_no_evil.png","[男人]":"hl_man.png","[老爷爷]":"hl_older_man.png","[老奶奶]":"hl_older_woman.png","[撅嘴猫]":"hl_pouting_cat.png","[尖叫]":"hl_scream_cat.png","[不看]":"hl_see_no_evil.png","[不说]":"hl_speak_no_evil.png","[男人拉手]":"hl_two_men_holding_hands.png","[妇女]":"hl_woman.png","[天使]":"hl_angel.png","[新娘]":"hl_bride_with_veil.png","[轮廓]":"hl_bust_in_silhouette.png","[双人轮廓]":"hl_busts_in_silhouette.png","[建筑工人]":"hl_construction_worker.png","[警察]":"hl_cop.png","[舞者]":"hl_dancer.png","[伴舞]":"hl_dancers.png","[卫兵]":"hl_guardsman.png","[理发]":"hl_haircut.png","[前台]":"hl_information_desk_person.png","[帽子男子]":"hl_man_with_gua_pi_mao.png","[穆斯林男人]":"hl_man_with_turban.png","[按摩]":"hl_massage.png","[金发女郎]":"hl_person_with_blond_hair.png","[公主]":"hl_princess.png","[圣诞老人]":"hl_santa.png","[女人手牵手]":"hl_two_women_holding_hands.png","[拳头]":"hl_punch.png","[挥手]":"hl_wave.png","[上面]":"hl_point_up.png","[下面]":"hl_point_down.png","[左面]":"hl_point_left.png","[右面]":"hl_point_right.png","[手势]":"hl_point_up2.png","[手掌]":"hl_open_hands.png","[鼓掌]":"hl_clap.png","[指甲油]":"hl_nail_polish.png","[食人魔]":"hl_japanese_ogre.png","[妖精]":"hl_japanese_goblin.png","[小鬼]":"hl_imp.png","[鬼]":"hl_ghost.png","[外星怪物]":"hl_alien_monster.png","[外星人]":"hl_extraterrestrial_alien.png","[颅骨]":"hl_skull.png","[眼睛]":"hl_eyes.png","[耳朵]":"hl_ear.png","[鼻子]":"hl_nose.png","[嘴巴]":"hl_mouth.png","[舌头]":"hl_tongue.png","[爱心]":"hl_heart.png","[脚印]":"hl_footprints.png","[吻]":"hl_kiss.png","[蓝心]":"hl_blue_heart.png","[肌肉]":"hl_muscle.png","[绿心]":"hl_green_heart.png","[黄心]":"hl_yellow_heart.png","[闪心]":"hl_sparkling_heart.png","[心跳]":"hl_heartbeat.png","[礼物的心]":"hl_gift_heart.png","[成长的心]":"hl_heartpulse.png","[心碎]":"hl_broken_heart.png","[一见钟情]":"hl_cupid.png","[紫心]":"hl_purple_heart.png","[旋转的心]":"hl_revolving_hearts.png","[装饰的心]":"hl_heart_decoration.png","[两颗心]":"hl_two_hearts.png","[赞]":"hl_good.png","[OK]":"hl_ok_hand.png","[加油]":"hl_fist.png","[手]":"hl_hand.png","[耶]":"hl_victory.png","[鄙视]":"hl_step.png"},name_new:{"[微笑]":"hl_smile_open_mouth.png","[哈哈]":"hl_haha.png","[嘻嘻]":"hl_xixi.png","[眉开眼笑]":"hl_smiling_eyes.png","[光环]":"hl_smiling_halo.png","[安静]":"hl_hushed_face.png","[疑惑]":"hl_confused_face.png","[脸红]":"hl_blush.png","[高兴]":"hl_joy.png","[甜蜜微笑]":"hl_sweat_smile.png","[恶魔]":"hl_horns.png","[期待]":"hl_neutral_face.png","[生气]":"hl_angry_face.png","[笑呵呵]":"hl_smiley.png","[哈哈大笑]":"hl_laughing.png","[眨眼睛]":"hl_wink.png","[面无表情]":"hl_expressionles.png","[扮鬼脸]":"hl_grimacing.png","[愤怒]":"hl_rage.png","[好奇]":"hl_curiousness.png","[失望的]":"hl_disappointed.png","[恐惧]":"hl_fearful.png","[担心]":"hl_worried.png","[害羞]":"hl_flushed.png","[哭泣]":"hl_cry.png","[不屈不挠]":"hl_persevere.png","[皱眉]":"hl_frowning.png","[惊叫]":"hl_scream.png","[晕]":"hl_dizzy.png","[睡着]":"hl_sleeping.png","[胜利]":"hl_triumph.png","[苦恼]":"hl_anguished.png","[冷汗]":"hl_cold.png","[惊讶]":"hl_astonished.png","[抿嘴]":"hl_no_mouth.png","[口罩]":"hl_mask.png","[喜欢]":"hl_heart_eyes.png","[鬼脸]":"hl_closed_eyes.png","[亲一个]":"hl_kissing_smiling_eyes.png","[墨镜]":"hl_sunglasses.png","[困惑]":"hl_confounded.png","[沮丧]":"hl_disappointed.png","[吐舌头]":"hl_stuck_out_tongue.png","[美味]":"hl_yum.png","[飞吻]":"hl_kissing_heart.png","[大哭]":"hl_sob.png","[沉思]":"hl_pensive.png","[不悦]":"hl_unamused.png","[眨眼]":"hl_winking_eye.png","[亲一口]":"hl_kissing.png","[亲吻]":"hl_kissing_closed_eyes.png","[放心了]":"hl_relieved.png","[困了]":"hl_sleepy.png","[奸笑]":"hl_smirk.png","[举手]":"hl_raising_hand.png","[不行]":"hl_no_good.png","[撅嘴]":"hl_pouting_face.png","[奸笑猫]":"hl_smirk_cat.png","[喜欢猫]":"hl_heart_eyes_cat.png","[流汗]":"hl_sweat.png","[庆祝]":"hl_raised_hands.png","[可以]":"hl_ok_woman.png","[祈祷]":"hl_pray.png","[笑脸猫]":"hl_smile_cat.png","[亲亲猫]":"hl_kissing_cat.png","[疲倦]":"hl_tired_face.png","[皱眉头]":"hl_frowning.png","[鞠躬]":"hl_bow.png","[微笑猫]":"hl_smiley_cat.png","[欢乐猫]":"hl_joy_cat.png","[哭泣猫]":"hl_crying_cat.png","[宝贝]":"hl_baby.png","[男孩]":"hl_boy.png","[夫妇]":"hl_couple.png","[恩爱]":"hl_couple_with_heart.png","[接吻]":"hl_couplekiss.png","[家庭]":"hl_family.png","[女孩]":"hl_girl.png","[屎]":"hl_hankey.png","[不听]":"hl_hear_no_evil.png","[男人]":"hl_man.png","[老爷爷]":"hl_older_man.png","[老奶奶]":"hl_older_woman.png","[撅嘴猫]":"hl_pouting_cat.png","[尖叫]":"hl_scream_cat.png","[不看]":"hl_see_no_evil.png","[不说]":"hl_speak_no_evil.png","[男人拉手]":"hl_two_men_holding_hands.png","[妇女]":"hl_woman.png","[天使]":"hl_angel.png","[新娘]":"hl_bride_with_veil.png","[轮廓]":"hl_bust_in_silhouette.png","[双人轮廓]":"hl_busts_in_silhouette.png","[建筑工人]":"hl_construction_worker.png","[警察]":"hl_cop.png","[舞者]":"hl_dancer.png","[伴舞]":"hl_dancers.png","[卫兵]":"hl_guardsman.png","[理发]":"hl_haircut.png","[前台]":"hl_information_desk_person.png","[帽子男子]":"hl_man_with_gua_pi_mao.png","[穆斯林男人]":"hl_man_with_turban.png","[按摩]":"hl_massage.png","[金发女郎]":"hl_person_with_blond_hair.png","[公主]":"hl_princess.png","[圣诞老人]":"hl_santa.png","[女人手牵手]":"hl_two_women_holding_hands.png","[拳头]":"hl_punch.png","[挥手]":"hl_wave.png","[上面]":"hl_point_up.png","[下面]":"hl_point_down.png","[左面]":"hl_point_left.png","[右面]":"hl_point_right.png","[手势]":"hl_point_up2.png","[手掌]":"hl_open_hands.png","[鼓掌]":"hl_clap.png","[指甲油]":"hl_nail_polish.png","[食人魔]":"hl_japanese_ogre.png","[妖精]":"hl_japanese_goblin.png","[小鬼]":"hl_imp.png","[鬼]":"hl_ghost.png","[外星怪物]":"hl_alien_monster.png","[外星人]":"hl_extraterrestrial_alien.png","[颅骨]":"hl_skull.png","[眼睛]":"hl_eyes.png","[耳朵]":"hl_ear.png","[鼻子]":"hl_nose.png","[嘴巴]":"hl_mouth.png","[舌头]":"hl_tongue.png","[爱心]":"hl_heart.png","[脚印]":"hl_footprints.png","[吻]":"hl_kiss.png","[蓝心]":"hl_blue_heart.png","[肌肉]":"hl_muscle.png","[绿心]":"hl_green_heart.png","[黄心]":"hl_yellow_heart.png","[闪心]":"hl_sparkling_heart.png","[心跳]":"hl_heartbeat.png","[礼物的心]":"hl_gift_heart.png","[成长的心]":"hl_heartpulse.png","[心碎]":"hl_broken_heart.png","[一见钟情]":"hl_cupid.png","[紫心]":"hl_purple_heart.png","[旋转的心]":"hl_revolving_hearts.png","[装饰的心]":"hl_heart_decoration.png","[两颗心]":"hl_two_hearts.png","[赞]":"hl_good.png","[OK]":"hl_ok_hand.png","[加油]":"hl_fist.png","[手]":"hl_hand.png","[耶]":"hl_victory.png","[鄙视]":"hl_step.png"},getFaceBytext:function(a){var b=/\[[\u2E80-\u9FFF]+\]/g,c=a.match(b);if(!c)return a;for(var d=0;d<c.length;d++)if(__app.faceObj.name[c[d]]){var e='<img src="'+__app.faceObj.domain+__app.faceObj.name[c[d]]+'" style="width:1rem;"/>';a=a.replace(c[d],e)}return a},getFaceByName:function(a){return'<img src="'+__app.faceObj.domain+__app.faceObj.name[a]+'" style="width:1rem;"/>'}};var isDev=!1;__app.chatHref=isDev?"/demo/messageschat/index.html":"/im/conv",__app.bindinfinite=!1,__app.staticDomain="",__app.myWkimDefaultConfig={url:{getImSignModel:isDev?"/ajax/im.json":"/im/getImLoginInfo"},plugin:{listConversation:!0},dom:{convList:".messages-list ul",unreadPointTotal:!1,chat:".messages-content .messages",chatSendMsg:"#chatSendMsg"},template:{listConversation:'{{#each data}}{{#is hidden "not" 1}}<li data-cid="{{cid}}"><a class="item-content" href="'+__app.chatHref+'?cid={{cid}}"><div class="item-media">{{#is isSingleChat "===" false}}<div class="userimg" style="box-sizing: border-box; line-height: 0; width: 1.8rem; height: 1.8rem; background-image: url({{baseConversation.icon}}); background-size: contain; background-position: 50% 50%; background-repeat: no-repeat;"></div>{{else}}<div class="userimg" data-avatar="{{openId}}" style="box-sizing: border-box; line-height: 0; width: 1.8rem; height: 1.8rem; background-image: url(http://s1.renhe.cn/images/headnone_50.jpg); background-size: contain; background-position: 50% 50%; background-repeat: no-repeat;"></div>{{/is}}{{#is baseConversation.unreadPoint "not" 0}}<span class="badge">{{baseConversation.unreadPoint}}</span>{{/is}}</div><div class="item-inner">{{#each lastMessages}}<div class="item-title-row">{{#is ../isSingleChat "===" false}}<div class="item-title" title="{{../baseConversation.title}}">{{../baseConversation.title}}</div>{{else}}<div class="item-title" data-nick="{{../openId}}">{{../openId}}</div>{{/is}}<div class="item-after">{{calendar baseMessage.createdAt}}</div></div><div class="item-subtitle">{{#is isSingleChat "===" false}}{{#is baseMessage.creatorType "not" 2}}<span data-nick="{{baseMessage.openIdEx.openId}}"></span>:{{/is}}{{/is}}{{#is baseMessage.content.contentType "===" 1}}{{baseMessage.content.textContent.text}}{{/is}}{{#is baseMessage.content.contentType "===" 2}}【图片】{{/is}}{{#is baseMessage.content.contentType "===" 3}}【语音】{{/is}}{{#is baseMessage.content.contentType "===" 4}}【文件】{{/is}}{{#is baseMessage.content.contentType "===" 102}}{{#each baseMessage.content.attachments}}{{#chatIsCard url}}【名片】{{../extension.text}}{{else}}【链接】{{../extension.text}}{{/chatIsCard}}{{/each}}{{/is}}</div>{{/each}}</div></a></li>{{/is}}{{/each}}',listChat:'{{#each data}}{{#is baseMessage.creatorType "not" 2}}{{#is hideTime "not" true}}<div class="messages-date"><span>{{dateFormat baseMessage.createdAt "YYYY-MM-DD HH:mm:ss"}}</span></div>{{/is}}<div class="message{{#is baseMessage.content.contentType "===" 2}} message-pic{{/is}}{{#is ../myOpenId "not" baseMessage.openIdEx.openId}} message-received{{else}} message-sent{{/is}} message-with-tail message-with-avatar">{{#is baseMessage.content.contentType "===" 1}}<div class="message-text">{{imMsgTxt baseMessage.content.textContent.text}}</div>{{/is}}{{#is baseMessage.content.contentType "===" 2}}<div class="message-text"><img class="js-imphotobrower" imread style="{{setImImgSize baseMessage.content.photoContent.width baseMessage.content.photoContent.height}}" src="{{baseMessage.content.photoContent.imageUrl}}"></div>{{/is}}{{#is baseMessage.content.contentType "===" 3}}<div class="message-text im-audio-content"><i class="im-audio" data-msg-id="{{baseMessage.messageId}}" style="width:{{operation baseMessage.content.audioContent.duration "hh"}}" data-media-time="{{baseMessage.content.audioContent.duration}}" data-media-id="{{baseMessage.content.audioContent.mediaId}}"></i><span class="im-audio-info">{{operation baseMessage.content.audioContent.duration "mm"}} \'\'</span>{{#is receiverMessageStatus.readStatus "not" 2}}<i class="im-audio-status"></i>{{/is}}</div>{{/is}}<div data-avatar="{{baseMessage.openIdEx.openId}}" style="background-image:url(http://s1.renhe.cn/images/headnone_50.jpg)" class="message-avatar"></div></div>{{/is}}{{/each}}'}},Handlebars.registerHelper("calendar",function(a){return moment(a).calendar()}),Handlebars.registerHelper("chatIsCard",function(a,b){var c=/user:\/\/([a-z0-9]+)/,d=a.match(c);return d?b.fn(d):b.inverse(a)}),Handlebars.registerHelper("dateFormat",function(a,b){return moment(a).format(b)}),Handlebars.registerHelper("imMsgTxt",function(a,b){var c=a,d=a.match(/((http[s]{0,1}|ftp):\/\/|www)[a-zA-Z0-9\.\-]+\.([a-zA-Z]{2,4})(:\d+)?(\/[a-zA-Z0-9\.\-~!@#$%^&*+?:_\/=<>]*)?/g);if(d)for(var e=0;e<d.length;e++){var f=/http[s]{0,1}|ftp:\/\//.test(d[e])?d[e]:"http://"+d[e];c=c.replace(d[e],'<a class="external"  href="'+f+'" target="_blank">'+d[e]+"</a>")}return new Handlebars.SafeString(__app.faceObj.getFaceBytext(c).replace(/(\r\n|\n|\r)/g,"<br>"))}),Handlebars.registerHelper("iconFileType",function(a,b){var c=[],d="unknown",e={TXT:"txt",excel:"excel",ppt:"ppt",xls:"excel",docx:"word",doc:"word",xlsx:"excel"
},f=__app.staticDomain||"";e[a]&&(d=e[a]);for(var g in b.hash)c.push(g+'="'+b.hash[g]+'"');return new Handlebars.SafeString('<img src="'+f+"/assets/img/iconfiletype/icon_filetype_"+d+'@3x.png" '+c.join(" ")+">")}),Handlebars.registerHelper("operation",function(a,b){var c={mm:function(a){return Math.round(a/1e3)},hh:function(a){var b=a/1e3;return Math.floor(20+b/(30+b)*140)/20+"rem"},size_k:function(a){return Math.round(100*a/1024)/100}};return c[b]?c[b](a):a}),Handlebars.registerHelper("map",function(a,b){var c=a;if(c){for(var d=1;d<arguments.length-1;d++)c[arguments[d]]&&(c=c[arguments[d]]);return c}}),Handlebars.registerHelper("setImImgSize",function(a,b){var c=233*$(window).width()/375,d=a,e=b;return a>c&&(d=c,e=d*b/a),"width:"+d+"px;height:"+e+"px;"});var conversation=WKim.conversation,message=WKim.message,user=WKim.user,convListener=WKim.conversationListener,msgListener=WKim.messageListener,follow=WKim.follow,upload=WKim.upload;__app.imConversation={},__app.imChat={},__app.photos=[],$(document).on("click",".js-imphotobrower",function(){$.photoBrowser({photos:__app.photos}).open($.inArray($(this).attr("src"),__app.photos))}),__app.myWkim=function(a){this.config=$.extend(__app.myWkimDefaultConfig,a),this.myOpenId=WKim.auth.getOpenId(),this.convlistDom=$(this.config.dom.convList),this.users={},this.curMsgs={},this.photos=[],this.init()},__app.myWkim.prototype={template:function(a){return Handlebars.compile(a)},init:function(){var a=this,b=sessionStorage.token;b?(b=JSON.parse(sessionStorage.token),this.authLogin(b)):this.getLoginInfo(function(b){a.authLogin(isDev?b.imSignModel:b.ref)})},getUrlParam:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=window.location.search.substr(1).match(b);return null!=c?unescape(c[2]):null},getOpenIdByCid:function(a){var b=this,c="";return-1!=a.indexOf(":")?a.split(":").forEach(function(a){a!=b.myOpenId&&(c=a)}):c=a,c},getLoginInfo:function(a){$.ajax({url:this.config.url.getImSignModel,dataType:"json",success:function(b){a(b)}})},authLogin:function(a,b){var c=this;WKim.auth.login(a).then(function(a){c.myImConversationInit(),a&&(sessionStorage.token=JSON.stringify(a))},function(){console.log("login fail"),delete sessionStorage.token})},getProfiles:function(a,b){var c=this;WKim.user.getProfiles(a).then(function(a){a.forEach(function(a){c.users[a.openId]=a}),b(a)})},setGenProfile:function(a){var b=this;a.find("[data-nick]").each(function(){var a=$(this).attr("data-nick"),c=$(this);b.getProfiles([a],function(a){a&&a[0]&&a[0].nick&&(c.text(a[0].nick),c.removeAttr("data-nick"))})}),a.find("[data-avatar]").each(function(){var a=$(this).attr("data-avatar"),c=$(this);b.getProfiles([a],function(a){a&&a[0]&&a[0].avatar&&(c.css({"background-image":"url("+a[0].avatar+")"}),c.removeAttr("data-avatar"))})})},myImConversationInit:function(){this.listConversation()},myImChatInit:function(){var a=this,b=this.getUrlParam("cid"),c=this.getUrlParam("create");return c?a.createConversation(b,function(b){b.clearUnreadPoint(),a.getProfiles([b.peerId()],function(){a.chat(b)})}):(conversation.get(b).then(function(b){__app.imConv=b,__app.imConv.clearUnreadPoint(),a.chat(__app.imConv)}),void $("#chatSendMsg").click(function(b){return a.enterINPUT=$($(b.target).data("target")),a.enterValue=$.trim(a.enterINPUT.val()),""==a.enterValue?$.alert("发送内容不能为空！"):void a.sendTxtMsg(a.enterValue)}))},updateConversationItem:function(a,b){var c=this,d={data:this.doData([a])},e=c.convlistDom.find('[data-cid="'+a.cid+'"]'),f=$(c.template(c.config.template.listConversation)(d));a.isSingleChat&&this.setGenProfile(f),e.length>0?(e.prependTo(c.convlistDom),e.replaceWith(f)):this.convlistDom.prepend(f),b&&b(e)},doData:function(a){var b=this;return $.map(a,function(a){return a.isSingleChat&&(a.openId=b.getOpenIdByCid(a.cid)),0==a.lastMessages.length&&(a.hidden=1),a}),a},createConversation:function(a,b){conversation.create({openIds:[a]}).then(function(a){__app.imConv=a,b&&b(a)})},listConversation:function(){var a=this;conversation.list(0,1e3).then(function(b){a.convlistDom.html(a.template(a.config.template.listConversation)({data:a.doData(b)})),a.setGenProfile(a.convlistDom),$("#pageMessagesChat").length>0&&a.myImChatInit()}),convListener.on("convAdd",function(a){console.log("convAdd")}),convListener.on("convToFirst",function(a){a==chat.cid}),convListener.on("convSetTop",function(a){console.log("convSetTop")}),convListener.on("convUnreadPointChange",function(b,c){var d=a.convlistDom.find('[href="#conversation_'+b.cid+'"]'),e=d.find(".badge");0==e.length&&(e=$('<span class="badge"></span>'),d.find(".item-media").append(e)),0==c?e.remove():e.text(c),conversation.getTotalUnreadCount().then(function(b){a.config.dom.unreadPointTotal&&$(a.config.dom.unreadPointTotal).text(b)})}),convListener.on("convLastMessageChange",function(b,c){a.updateConversationItem(b,function(b){a.setGenProfile(b)})}),convListener.on("convRemove",function(a){console.log("convRemove")})},sendTxtMsg:function(a){var b=this,c={content:{contentType:1,textContent:{text:String(a)}}};__app.imConv.sendMsg(c).then(function(a){b.enterINPUT.val("")})},mediaAudioInit:function(a){var b=null;$(".im-audio[data-media-id]").each(function(){var a=$(this),b=$(this).attr("data-media-id");b.replace("@","").replace(".mp3",""),$(this).attr("data-msg-id");upload.trans(b).then(function(b){var c=$('<audio controls="controls" style="display:none;"><source src="'+b+'" /></audio>').appendTo(a)[0];$(c).on("play",function(){$(this).parent(".im-audio").addClass("do");var a=$(this).siblings(".im-audio-status");a.length>0&&a.remove()}),$(c).on("pause",function(){$(this).parent(".im-audio").removeClass("do")}),a.removeAttr("data-media-id")})}),$(document).on("click",".im-audio-content",function(a){var c=$(this),d=c.find("audio")[0];b&&!b.paused&&b.pause(),d.play()})},initPhotoBrow:function(){var a=[];$(".js-imphotobrower[imread]").each(function(b){a.push($(this).attr("src")),$(this).removeAttr("imread")}),this.photos=a.concat(this.photos),__app.photos=this.photos},chat:function(a){var b=this,c=$(this.config.dom.chat),d=a.getTitle();if(a.isSingleChat)this.getProfiles([d],function(a){if(a&&a[0]&&a[0].nick){$("title").html(a[0].nick);var b=$("header.bar-nav .title");b.length>0&&b.html(a[0].nick)}});else{$("title").html(d);var e=$("header.bar-nav .title");e.length>0&&e.html(d)}var f=20,g=!1,h=null,i={};__app.imConv=a,__app.imChat.nextMsg=null,__app.imChat.prevMsg=null,__app.imChat.cid=a.cid,msgListener.removeEvent(),msgListener.on("msgReceive",function(a){if(a.getConvId()===__app.imChat.cid&&!i[a.getId()]){i[a.getId()]=!0,a.isMe()||__app.imConv.clearUnreadPoint(),h&&a.baseMessage.createdAt-h.baseMessage.createdAt<9e5&&(a.hideTime=!0),h=a;var d={data:[a],myOpenId:b.myOpenId};c.append(b.template(b.config.template.listChat)(d)),$(".infinite-scroll-top").scrollTop(9999),b.setGenProfile(c)}}),msgListener.on("sendSuccess",function(a){if(!i[a.getId()]){i[a.getId()]=!0,__app.imChat.prevMsg&&a.baseMessage.createdAt-h.baseMessage.createdAt<9e5&&(a.hideTime=!0),h=a;var d={data:[a],myOpenId:b.myOpenId};c.append(b.template(b.config.template.listChat)(d)),$(".infinite-scroll-top").scrollTop(9999),b.setGenProfile(c)}}),msgListener.on("msgStatusChange",function(a){}),msgListener.on("sendFail",function(a){console.log(a)}),__app.imChat.next=function(b,c,d){a.listNextMessages(b,c||5).then(function(b){if(0==b.length)return d&&d(b);b.length<f&&$(".infinite-scroll-preloader").hide(),__app.imChat.nextMsg=a.getMsgById(a.msgIds[0]),__app.imChat.prevMsg=b[b.length-1];var c=(new Date).getTime(),e=$.map(b,function(a){return-1==$.inArray(a.baseMessage.content.contentType,[1,2,3])?null:(a.baseMessage.createdAt-c<9e5&&(a.hideTime=!0),c=a.baseMessage.createdAt,a)});d&&d(e)})},!__app.bindinfinite&&$(document).on("infinite",".infinite-scroll-top",function(){var a=$(".infinite-scroll-top"),d=a[0].scrollHeight;g&&clearTimeout(g),g=setTimeout(function(){__app.imChat.next(__app.imChat.nextMsg,f,function(e){0==e.length&&($.detachInfiniteScroll($(".infinite-scroll")),$(".infinite-scroll-preloader").remove());var f={data:e,myOpenId:b.myOpenId};c.prepend(b.template(b.config.template.listChat)(f)),a.scrollTop(a[0].scrollHeight-d),b.setGenProfile(c),b.mediaAudioInit(c),b.initPhotoBrow(c)}),$.refreshScroller()},1e3)}),__app.bindinfinite=!0,__app.imChat.next(null,f,function(a){var d={data:a,myOpenId:b.myOpenId};h=a[a.length-1],c.html(b.template(b.config.template.listChat)(d)),$(".infinite-scroll-top").scrollTop(9999),b.setGenProfile(c),b.mediaAudioInit(c),b.initPhotoBrow(c)})},faceInit:function(a){var b="#faceMainPopup";if(0==$(b).length){var c='<div class="popup faceMainPopup" id="faceMainPopup"><div class="popop-facehd"><h1 class="title">添加表情</h1><a href="#" class="close-popup">关闭</a></div><div class="content-block"><div class="face-content">';$.each(__app.faceObj.name,function(a,b){c+='<span class="face-item" data-face="'+a+'">'+__app.faceObj.getFaceByName(a)+"</span>"}),c+="</div></div></div>",$(c).appendTo("body")}var d=$("#imMsgTxtarea");$(document).on("click",a,function(a){b=$(this).data("popup"),$.popup(b)}),$(document).on("click",".face-item",function(a){var c=$(this).data("face");d.val(d.val()+c),$.closeModal(b)})}};