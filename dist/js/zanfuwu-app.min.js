/*!
 * =====================================================
 * zanfuwu by yangbinbin - http://m.zanfuwu.com/
 *
 * =====================================================
 */
$(function(){"use strict";function a(){var a={};$(document).on("click",".js-send-code",function(){a.mobile=$('[name="mobile"]').val(),a.code=$("#codeImgInput").val(),a.id=$(".js-getimgcode").data("id"),__app.sendCode(this,a)}),$(document).on("click",".js-getimgcode",function(){var a=$(this);$.ajax({url:a.data("url"),type:"post",dataType:"json",success:function(b){a.css({"background-image":"url("+b.ref.img+")"}),a.data("id",b.ref.id)}})}),$(document).on("click","#phoneLogin",function(){var a=($(this),$(this).closest("form"));$.ajax({url:a.attr("action"),type:a.attr("method"),dataType:"json",success:function(b){0==b.errorCode?($.toast("登录成功"),$.router.load(a.data("dir"))):$.alert(b.errorInfo)}})})}__app||(__app={}),window.localStorage||console.log("This browser does NOT support localStorage"),__app.varConfig={},__app.includeStyleElement=function(a,b){if(!document.getElementById(b)){var c=document.createElement("style");c.id=b,(document.getElementsByTagName("head")[0]||document.body).appendChild(c),c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a))}},__app.xxFileUploader={fileInput:null,url:null,singe:!0,fileFilter:[],filter:function(a){return a},onSelect:function(){},onProgress:function(){},onSuccess:function(){},onFailure:function(){},onComplete:function(){},funGetFiles:function(a){var b=a.target.files||a.dataTransfer.files;return this.fileFilter=this.fileFilter.concat(this.filter(b)),this.funDealFiles(),this},funDealFiles:function(){for(var a,b=0;a=this.fileFilter[b];b++)a.index=b;return this.onSelect(this.fileFilter),this},funUploadFile:function(){var a=this;if(!(location.host.indexOf("sitepointstatic")>=0))for(var b,c=0;b=this.fileFilter[c];c++)!function(b){var c=new XMLHttpRequest;c.upload&&(c.upload.addEventListener("progress",function(c){a.onProgress(b,c.loaded,c.total)},!1),c.onreadystatechange=function(d){4==c.readyState&&(200==c.status?(a.onSuccess(b,c.responseText),a.fileFilter.length||a.onComplete()):a.onFailure(b,c.responseText))},c.open("POST",a.url,!0),c.setRequestHeader("X_FILENAME",b.name),c.send(b))}(b)},init:function(){var a=this;this.fileInput&&$(document).on("change",this.fileInput,function(b){a.funGetFiles(b),a.funUploadFile()})}},__app.hasLoalStorage=function(a){__app[a]||(localStorage[a]&&""!=localStorage[a]||(localStorage[a]="[]"),__app[a]=JSON.parse(localStorage[a]))},__app.setStorage=function(a,b){__app.hasLoalStorage(b);for(var c=__app[b].length-1;c>=0;c--){if(a.indexOf(__app[b][c])>=0){__app[b].splice(c,1);break}if(0==c&&__app[b].length>=6){__app[b].pop();break}}__app[b].unshift(a),localStorage[b]=JSON.stringify(__app[b])},__app.setStorageToHtml=function(a,b,c){__app.hasLoalStorage(c);var d=Handlebars.compile($(b).html());return 0==__app.zfwSearchHistory.length?void $(a).hide():($(a).show(),void $(a).html(d(__app[c])))},__app.loadMoreLink=function(a){var b=this;this.options=a,this.$infinite=$(".infinite-scroll"),this._loadEl=$(".infinite-scroll-preloader"),this.loading=!1,this.loaded=!1,this.container=$(this.options.container)||$(".infinite-scroll-bottom .list-container"),this.page=this.options.page||1,this.data=this.options.data,this.url=this.options.url,this.addItems=function(a,c){$.ajax({url:this.url,type:"get",data:this.data.replace("{index}",b.page),success:function(d){""==$.trim(d)?($.detachInfiniteScroll(b.$infinite),b._loadEl.hide()):(c&&c(d),b.container[a](d),$(".content").height()<b.container.height()&&b._loadEl.show()),b.page++}})},this.init=function(a){$.detachInfiniteScroll(b.$infinite),$.attachInfiniteScroll(b.$infinite),b.callback=a,b.addItems("html",a)},this._remove=function(){$.detachInfiniteScroll(b.$infinite),b._loadEl.hide()},this.set=function(a){$.each(a,function(a,c){b[a]=c})},this.reset=function(a){b.set(a),$.detachInfiniteScroll(b.$infinite),$.attachInfiniteScroll(b.$infinite)},$(document).on("infinite",".infinite-scroll-bottom",function(){b.loading||(b.loading=!0,setTimeout(function(){b.loading=!1,b.addItems("append",b.callback),$.refreshScroller()},1e3))})},__app.tabLoadMore=function(a){var b=$(".mytab-link.active"),a=$.extend({container:"#pageClassifyItemList",url:b.data("url"),data:b.data("params")},a),c=new __app.loadMoreLink(a);c.init(function(){"N"==b.attr("data-more-pages")&&$(".infinite-scroll-preloader").hide()}),$(".mytab-link").on("click",function(){return b.removeClass("active"),b=$(this).addClass("active"),c.set({page:1,data:$(this).data("params"),url:$(this).data("url"),loading:!1,loaded:!1}),c.init(function(){"N"==b.attr("data-more-pages")&&$(".infinite-scroll-preloader").hide()}),$("html,body,.content").scrollTop(0),!1})},__app.loadMore=function(a){var b=$(a),c=$.extend({container:b.data("target"),url:b.data("url"),data:b.data("params"),page:2},c),d=new __app.loadMoreLink(c);return d},__app.industryData=[],__app.industryPick=function(a,b){var c=[],d=[],e=a.element||"#industry-picker",f=function(){$.each(__app.industryData,function(a,b){c.push(b.id),d.push(b.name)}),$(e).picker({toolbarTemplate:a.toolbarTmp.replace("{{text}}",$(e).data("title")),formatValue:function(a,c,d){return b&&b(a,c,d),d[0]},cssClass:"industry-pick-modal",onClose:a.onClose,value:[$(e).data("id")],cols:[{textAlign:"center",values:c,displayValues:d,cssClass:"picker-items-col-normal"}]})};0==__app.industryData.length&&$(e).data("url")?$.ajax({url:$(e).data("url"),dataType:"json",type:"get",success:function(a){__app.industryData=a,f()}}):f()},__app.cityPicker=function(a,b){var c=a.element,d=(a.displayCols||["provinces","cities","districts"],function(){var d,e=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];if("id"==b){if(""==e.id)continue;c.push(e.id)}else{if("请选择"==e.name)continue;c.push(e.name)}}return c.length?c:[""]},f=function(a,b){var c=b||"name";return a.sub?e(a.sub,c):[""]},g=function(a,b){for(var c=b||"name",d=0;d<h.length;d++)if(h[d][c]==a)return f(h[d],c);return[""]},h=$.smConfig.rawCitiesData,i=h.map(function(a){return a.name}),j=h.map(function(a){return a.id}),k=f(h[0]),l=f(h[0],"id"),m=i[0],n=k[0],o=j[0],p=l[0],q={cssClass:"city-picker",rotateEffect:!1,onChange:function(a,b,c){var e,f,h=a.cols[0].value,i=a.cols[0].displayValue;return h!==o?(clearTimeout(d),void(d=setTimeout(function(){var b=g(i);e=b[0];var c=g(h,"id");f=c[0],a.cols[1].replaceValues(c,b),m=i,n=e,o=h,p=f,a.updateValue()},200))):(f=a.cols[1].value,e=a.cols[1].displayValue,void(e!==n&&(n=e,p=f,a.updateValue())))},cols:[{textAlign:"center",values:j,displayValues:i,cssClass:"col-province"},{textAlign:"center",values:l,displayValues:k,cssClass:"col-city"}]};$.fn.cityPicker=function(a){return this.each(function(){if(this){var b=$.extend(q,a);if(b.displayValue)$(this).val(b.displayValue.join(" "));else{var c=$(this).val();c&&(b.displayValue=c.split(" "))}if(b.displayValue&&(b.displayValue[0]&&(m=b.displayValue[0],b.cols[1].displayValues=g(b.displayValue[0])),b.displayValue[1]&&(n=b.displayValue[1])),b.value)$(this).data("id",b.value.join(" "));else{var d=$(this).data("id");d&&(b.value=d.split(" "))}b.value&&(b.value[0]&&(o=b.value[0],b.cols[1].values=g(b.value[0],"id")),b.value[1]&&(p=b.value[1])),$(this).picker(b)}})},$(c).cityPicker({toolbarTemplate:a.toolbarTmp.replace("{{text}}",$(c).data("title")),formatValue:function(a,c,d){return b&&b(a,c,d),d.join(" ")},onClose:function(b){a.onClose&&a.onClose(b)}})}),e=function(){$.ajax({url:$(c).data("url"),type:"get",dataType:"json",success:function(a){$.smConfig.rawCitiesData=a,d()}})};e()},__app.search=function(a){var b=$(a.element),c=b.data("key"),d=!1,e=b.data("target"),f=b.data("url"),g=b.data("params"),h=$(a.searchHotHistry),i=b.data("_loadMoreLink"),j=!1,k=!0;i||(i=new __app.loadMoreLink({container:e,url:f,data:b.data("params"),page:2}),b.data("_loadMoreLink",i));var l=function(a,b){i.set({page:1,data:g+"&"+c+"="+a,url:f,loading:!1,loaded:!1}),i.init(function(){__app.setStorage(a,"zfwSearchHistory"),k&&$(".infinite-scroll-preloader").hide()})},m=function(){h.show(),$(e).hide(),i._remove(),__app.setStorageToHtml("#searchHistory ul","#searchHistoryTemplate","zfwSearchHistory"),$('input[type="search"]').val("").trigger("blur"),k=!0,$(".infinite-scroll-preloader").hide()};j||(b.on("input propertychange",'input[type="search"]',function(a){var b=$(a.target);k=!1,d&&clearTimeout(d),d=setTimeout(function(){var a=$.trim(b.val());""!=a?(l(a),h.hide(),$(e).show(),$("html,body,.content").scrollTop(0)):m()},500)}),b.on("click",".searchbar-cancel",function(){m()}),$(document).on("click",".js-search-tag",function(a){var c=$.trim($(this).data("key"));return b.find("input").val(c),l(c),h.hide(),$(e).show(),$("html,body,.content").scrollTop(0),$('input[type="search"]').trigger("focus"),k=!1,!1}),j=!0)},__app.myTime=function(a,b,c){var d=this;return this.num=a,this.tm=setInterval(function(){return d.num<=0?(c&&c(),void clearInterval(d.tm)):(b&&b(d.num),void d.num--)},1e3),this};var b=!1;__app.sendCode=function(a,c){var d=$(a),e=d.data("url");return b?void 0:(d.addClass("disabled").attr("disabled",!0),$.ajax({url:e,dataType:"json",type:"post",data:c,success:function(a){b=!0,0!=a.errorCode?($.closeModal(),$.alert(a.errorInfo)):new __app.myTime(d.data("num"),function(a){d.text(a+"秒")},function(){d.text("发送验证码"),b=!1,d.removeClass("disabled").removeAttr("disabled")})}}),$(a))},$(document).on("pageAnimationStart",function(a,b,c){var d=$("#"+b).data("title");d&&$("title").text(d),$.closeModal()}),$(document).on("click","[data-link]:not(a)",function(a){$(a.target).closest("a").length>0||"A"!=a.target.tagName&&(window.location.href=$(this).data("link"))}),$(document).on("click",".js-confirm-dirlink",function(){var a=$(this).data("title"),b=$(this).data("text"),c=$(this).attr("data-dir-link");$.confirm(a,b,function(){window.location.href=c})}),$(document).on("click",".closeRefuseReason",function(a){var b=$(this).data("role");if("submit"==b){var c=$(this).data("dirurl");$.ajax({url:$(this).data("url"),type:"post",dataType:"json",data:{refuseReason:$("#pageRefuseReason").find("textarea").val()},success:function(a){0==a.errorCode?window.location.href=c:$.alert(a.errorInfo)}})}$.closeModal("#pageRefuseReason")}),$(document).on("click",".js-refuse-reason",function(a){$.pickerModal("#pageRefuseReason")}),a(),$(document).on("click",".zfw-clear-searchhistory",function(){__app.zfwSearchHistory=[],localStorage.zfwSearchHistory="[]",$("#searchHistory ul").html("")});$(document).on("click",".closeUpdatePrice",function(a){var b=$(this).data("role");if("submit"==b){var c=[],d=$(this).data("url"),e=$(this).data("dirurl");$("#pageUpdatePrice").find(".newPrice").each(function(){c.push($(this).val())}),$.ajax({url:d,dataType:"json",data:{newPrice:c.join(",")},type:"post",success:function(a){0==a.errorCode?$.alert("修改价格成功",function(){$.router.load(e)}):$.alert(a.errorInfo)}})}$.closeModal("#pageUpdatePrice")}),$(document).on("click",".js-update-price",function(){$.pickerModal("#pageUpdatePrice")}),$(document).on("pageAnimationStart",function(a,b,c){var d=$("#"+b).data("title");d&&$("title").text(d)}),$(document).on("pageLoadComplete",function(){$.closeModal()}),$(document).on("pageInit",function(a,c,d){b=!1,$(".js-loadding-more").length>0&&__app.loadMore(".js-loadding-more"),$(".js-tab-loadding-more").length>0&&($(".buttons-tab").fixedTab({offset:$(".bar-nav").height()}),__app.tabLoadMore({container:$(".js-tab-loadding-more").data("target")||"#pageClassifyItemList"}))}),$.device.ios&&$(document).on("change","#cameraInput",function(a){var b=($(this),$(this).data("url")||"/member/save/updateAvatar");$.showPreloader("图片上传中..."),lrz(this.files[0]).then(function(a){$.ajax({url:b,type:"POST",data:{avatar:a.base64},dataType:"json",success:function(a){$.hidePreloader(),a.success?$(".userimg").css("background-image","url("+a.picUrl+")"):$.alert("更改头像失败！")}})})["catch"](function(a){$.alert("更改头像失败！")}).always(function(){$.hidePreloader()})}),$(document).on("click",".js-savePageForm",function(a){var b=$($(this).data("target")),c=$(this).data("dirurl");$.ajax({url:b.attr("action"),type:b.attr("method")||"post",data:b.serializeArray(),dataType:"json",success:function(a){0!=a.errorCode?$.alert(a.errorInfo):$.router.load(c)}})}),__app.updataServerTotal=function(){var a=0;$("#updateServer .js-inputPrice").each(function(b,c){var d=$.trim($(c).val());a+=Number(d)}),$("#updateServer .js-totalPrice").text(a),$("#updateServer [name=totalPrice]").val(a)},$(document).on("click","#updateServer .js-del-server",function(){$(this).closest(".card").remove(),$($(this).data("target")).remove(),__app.updataServerTotal(),__app.varConfig.updateServer.index--}),$(document).on("click","#updateServer .js-add-server-option",function(){var a=$(this).data("temp").split(","),b=$(this).data("target").split(",");__app.varConfig.updateServer.index++;for(var c=0;c<a.length;c++)$(b[c]).append($(a[c]).html().replace(/\{index\}/g,__app.varConfig.updateServer.index));$("html,body,.content").scrollTop(99999)}),$(document).on("click",".more-link",function(a){var b=this;$.ajax({url:$(b).data("url"),type:"get",success:function(a){$(b).replaceWith(a)}})}),$(document).on("input propertychange","#updateServer .js-inputPrice",function(a){__app.updataServerTotal()}),$(document).on("pageInit","#pageStoreDetail,#pageServiceDetail",function(a,b,c){var d=[{url:"//img.alicdn.com/tps/i4/TB1AdxNHVXXXXasXpXX0HY8HXXX-1024-1024.jpeg"}];$(document).on("click",".js-pb-standalone",function(){var a=$(this).attr("data-pb-filed"),b=$(this).data("myPhotoBrowser");b||(b=$.photoBrowser({photos:__app[a]||d,theme:"dark",type:"standalone"}),$(this).data("myPhotoBrowser",b)),b.open()});var e=$("#storeDetailswiper")[0].swiper,f=$(".mytab-link.active");$(".mytab-link").on("click",function(){return e.slideTo(1*$(this).attr("href").substr(4)-1),!1}),e.on("slideChangeStart",function(a,b){f.removeClass("active"),f=$('.mytab-link[href="#tab'+(a.activeIndex+1)+'"]').addClass("active")})}),$(document).on("pageInit","#pagePayResult_1",function(a,b,c){$.modal({title:"支付结果",text:'<div class="content-block"><p><a href="#" class="button button-big button-danger">支付成功</a></p><p><a href="#" class="button button-big button-danger">支付遇到问题</a></p></div>'})}),$(document).on("pageInit","#pagePayResult_3",function(a,b,c){$.pickerModal("#pagePayResult_picker")}),$(document).on("pageInit","#pageClassifyItem",function(a,b,c){$(".buttons-tab").fixedTab({offset:$("#pageClassifyItem .bar-nav").length>0?$("#pageClassifyItem .bar-nav").height():0}),__app.tabLoadMore()}),$(document).on("pageInit","#pageIndex",function(a,b,c){}),$(document).on("pageInit","#pageOrder",function(a,b,c){$(".buttons-tab").fixedTab({offset:$("#pageOrder .bar-nav").length>0?$("#pageOrder .bar-nav").height():0})}),$(document).on("pageInit","#pageAccountInfo",function(a,b,c){$.device.ios&&$("#cameraInput").show();var d='<header class="bar bar-nav"></button><button class="button button-link pull-right close-picker">完成</button><h1 class="title">{{text}}</h1></header>';__app.cityPicker({element:"#city-picker",toolbarTmp:d,onClose:function(a){$.ajax({url:"/member/save/profileSingle",type:"post",data:{fieldType:"address",prov:a.value[0],city:a.value[1]},dataType:"json",success:function(a){}})}},function(a,b,c){a.input.data("id",b.join(" "))}),__app.industryPick({element:"#industry-picker",toolbarTmp:d,onClose:function(a){$.ajax({url:"/member/save/profileSingle",type:"post",data:{fieldType:"industry",fieldValue:a.value[0]},dataType:"json",success:function(a){}})}},function(a,b,c){a.input.data("id",b.join(" "))})}),$(document).on("pageInit","#pageSearch",function(a,b,c){__app.search({element:"#searchBars",searchHotHistry:"#searchHotHistry"}),__app.setStorageToHtml("#searchHistory ul","#searchHistoryTemplate","zfwSearchHistory")}),$(document).on("pageInit","#updateServer",function(a,b,c){__app.varConfig[b]={},__app.varConfig[b].index=$("#updateServer .serverListInfo .card").length,__app.updataServerTotal()});var c=null;$(document).on("pageInit","#pageMessages",function(a,b,d){c=new __app.myWkim}),$(document).on("pageInit","#pageMessagesChat",function(a,b,d){var e=!1;c||(c=new __app.myWkim),c.myImChatInit(),e||(c.faceInit("#chatSendface"),e=!0)}),$.init()});