/*!
 * =====================================================
 * zanfuwu by yangbinbin - http://m.zanfuwu.com/
 *
 * =====================================================
 */
$(function(){"use strict";function isIdCardNo(a){var b,c=new Array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2,1),d=new Array("1","0","X","9","8","7","6","5","4","3","2"),e=new Array,f=0,g=a.length,h=a;if(15!=g&&18!=g)return!1;for(var i=0;g>i;i++){if(e[i]=h.charAt(i),(e[i]<"0"||e[i]>"9")&&17!=i)return!1;17>i&&(e[i]=e[i]*c[i])}if(18==g){var j=h.substring(6,14);if(0==isDate8(j))return!1;for(var i=0;17>i;i++)f+=e[i];if(b=d[f%11],e[17]!=b)return!1}else{var k=h.substring(6,12);if(0==isDate6(k))return!1}return!0}function isDate6(a){if(!/^[0-9]{6}$/.test(a))return!1;var b,c;return b=a.substring(0,4),c=a.substring(4,6),1700>b||b>2500?!1:!(1>c||c>12)}function isDate8(a){if(!/^[0-9]{8}$/.test(a))return!1;var b,c,d;b=a.substring(0,4),c=a.substring(4,6),d=a.substring(6,8);var e=[31,28,31,30,31,30,31,31,30,31,30,31];return 1700>b||b>2500?!1:((b%4==0&&b%100!=0||b%400==0)&&(e[1]=29),1>c||c>12?!1:!(1>d||d>e[c-1]))}function iphoneValid(){var a={};$(document).on("click",".js-send-code",function(){a.mobile=$('[name="mobile"]').val(),a.code=$("#codeImgInput").val(),a.id=$(".js-getimgcode").data("id"),__app.sendCode(this,a)}),$(document).on("click",".js-getimgcode",function(){var a=$(this);$.ajax({url:a.data("url"),type:"post",dataType:"json",success:function(b){a.css({"background-image":"url("+b.ref.img+")"}),a.data("id",b.ref.id)}})}),$(document).on("click","#phoneLogin",function(){var a=($(this),$(this).closest("form"));$.ajax({url:a.attr("action"),type:a.attr("method"),dataType:"json",data:a.serializeArray(),success:function(b){0==b.errorCode?($.toast("登录成功"),$.router.load(a.data("dir"))):$.alert(b.errorInfo)}})})}__app||(__app={}),window.localStorage||console.log("This browser does NOT support localStorage"),__app.varConfig={},__app.varConfig.scrollTop={},__app.includeStyleElement=function(a,b){if(!document.getElementById(b)){var c=document.createElement("style");c.id=b,(document.getElementsByTagName("head")[0]||document.body).appendChild(c),c.styleSheet?c.styleSheet.cssText=a:c.appendChild(document.createTextNode(a))}},__app.validRules={isIdCardNo:[isIdCardNo,"请输入正确身份证号码！"]},__app.myValidate=function(_form,errorback,success){var error=!1,errorText=!1,valDom=_form.find("[validate]");valDom.length>0&&valDom.each(function(index,item){var json=eval("("+$(this).attr("validate")+")");return $.each(json.rules,function(a,b){var c=__app.validRules[a];return error=!c[0]($(item).val()),error?(errorText=c[1],!1):void 0}),error?!1:void 0}),error?errorback&&errorback(_form,errorText):success&&success(_form)},__app.xxFileUploader=function(a,b){var c=$.extend({trigger:a,accept:"image/*",multiple:!0,error:function(a){413==a.status?$.alert("上传的图片过大"):$.alert("上传图片失败")},change:function(a){0!=a.length&&($.showPreloader('正在上传:<span id="uploadPercent">0%</span>'),this.submit())},success:function(a,b){},progress:function(a,b,c,d,e){$("#uploadPercent").text(d+"%")}},b);new H5Upload(c)},__app.hasLoalStorage=function(a){__app[a]||(localStorage[a]&&""!=localStorage[a]||(localStorage[a]="[]"),__app[a]=JSON.parse(localStorage[a]))},__app.setStorage=function(a,b){__app.hasLoalStorage(b);for(var c=__app[b].length-1;c>=0;c--){if(a.indexOf(__app[b][c])>=0){__app[b].splice(c,1);break}if(0==c&&__app[b].length>=6){__app[b].pop();break}}__app[b].unshift(a),localStorage[b]=JSON.stringify(__app[b])},__app.setStorageToHtml=function(a,b,c){__app.hasLoalStorage(c);var d=Handlebars.compile($(b).html());return 0==__app.zfwSearchHistory.length?void $(a).hide():($(a).show(),void $(a).find("ul").html(d(__app[c])))},__app.loadMoreLink=function(a){var b=this;this.options=a,this.$infinite=$(".infinite-scroll"),this._loadEl=$(".infinite-scroll-preloader"),this.loading=!1,this.loaded=!1,this.container=$(this.options.container)||$(".infinite-scroll-bottom .list-container"),this.page=this.container.attr("page")||this.options.page||1,this.data=this.options.data,this.url=this.options.url,this.addItems=function(a,c){$.ajax({url:this.url,type:"get",data:this.data.replace("{index}",b.page),success:function(d){""==$.trim(d)?($.detachInfiniteScroll(b.$infinite),b._loadEl.hide()):(c&&c(d),b.container[a](d),$(".content").height()<b.container.height()&&b._loadEl.show()),b.page++,b.container.attr("page",b.page)}})},this.init=function(a){$.detachInfiniteScroll(b.$infinite),$.attachInfiniteScroll(b.$infinite),b.callback=a,b.addItems("html",a)},this._remove=function(){$.detachInfiniteScroll(b.$infinite),b._loadEl.hide()},this.set=function(a){$.each(a,function(a,c){b[a]=c})},this.reset=function(a){b.set(a),$.detachInfiniteScroll(b.$infinite),$.attachInfiniteScroll(b.$infinite)},$(document).off("infinite",".infinite-scroll-bottom").on("infinite",".infinite-scroll-bottom",function(){b.loading||(b.loading=!0,setTimeout(function(){b.loading=!1,b.addItems("append",b.callback),$.refreshScroller()},1e3))})},__app.tabLoadMore=function(a){var b=$(".mytab-link.active"),c=$($(".js-tab-loadding-more").data("target")||"#pageClassifyItemList"),d=c.data("_loadMoreLink"),a=$.extend({container:"#pageClassifyItemList",url:b.data("url"),data:b.data("params")},a);d||(d=new __app.loadMoreLink(a)),!c.attr("page")&&d.init(function(){"N"==b.attr("data-more-pages")&&$(".infinite-scroll-preloader").hide()}),$(".mytab-link").off("click").on("click",function(){return b.removeClass("active"),b=$(this).addClass("active"),d.set({page:1,data:$(this).data("params"),url:$(this).data("url"),loading:!1,loaded:!1}),d.init(function(){"N"==b.attr("data-more-pages")&&$(".infinite-scroll-preloader").hide()}),$("html,body,.content").scrollTop(0),!1})},__app.loadMore=function(a){var b=$(a),c=b.data("_loadMoreLink");if(!c){var d=$.extend({element:b,container:b.data("target"),url:b.data("url"),data:b.data("params"),page:2},d);"N"==b.attr("data-more-pages")&&$(".infinite-scroll-preloader").hide(),c=new __app.loadMoreLink(d)}return c},__app.industryData=[],__app.industryPick=function(a,b){var c=[],d=[],e=a.element||"#industry-picker",f=function(){$.each(__app.industryData,function(a,b){c.push(b.id),d.push(b.name)}),$(e).picker({toolbarTemplate:a.toolbarTmp.replace("{{text}}",$(e).data("title")),formatValue:function(a,c,d){return b&&b(a,c,d),d[0]},cssClass:"industry-pick-modal",onClose:a.onClose,value:[$(e).data("id")],cols:[{textAlign:"center",values:c,displayValues:d,cssClass:"picker-items-col-normal"}]})};0==__app.industryData.length&&$(e).data("url")?$.ajax({url:$(e).data("url"),dataType:"json",type:"get",success:function(a){__app.industryData=a,f()}}):f()},__app.cityPicker=function(a,b){var c=a.element,d=(a.displayCols||["provinces","cities","districts"],function(){var d,e=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];if("id"==b){if(""==e.id)continue;c.push(e.id)}else{if("请选择"==e.name)continue;c.push(e.name)}}return c.length?c:[""]},f=function(a,b){var c=b||"name";return a.sub?e(a.sub,c):[""]},g=function(a,b){for(var c=b||"name",d=0;d<h.length;d++)if(h[d][c]==a)return f(h[d],c);return[""]},h=$.smConfig.rawCitiesData,i=h.map(function(a){return a.name}),j=h.map(function(a){return a.id}),k=f(h[0]),l=f(h[0],"id"),m=i[0],n=k[0],o=j[0],p=l[0],q={cssClass:"city-picker",rotateEffect:!1,onChange:function(a,b,c){var e,f,h=a.cols[0].value,i=a.cols[0].displayValue;return h!==o?(clearTimeout(d),void(d=setTimeout(function(){var b=g(i);e=b[0];var c=g(h,"id");f=c[0],a.cols[1].replaceValues(c,b),m=i,n=e,o=h,p=f,a.updateValue()},200))):(f=a.cols[1].value,e=a.cols[1].displayValue,void(e!==n&&(n=e,p=f,a.updateValue())))},cols:[{textAlign:"center",values:j,displayValues:i,cssClass:"col-province"},{textAlign:"center",values:l,displayValues:k,cssClass:"col-city"}]};$.fn.cityPicker=function(a){return this.each(function(){if(this){var b=$.extend(q,a);if(b.displayValue)$(this).val(b.displayValue.join(" "));else{var c=$(this).val();c&&(b.displayValue=c.split(" "))}if(b.displayValue&&(b.displayValue[0]&&(m=b.displayValue[0],b.cols[1].displayValues=g(b.displayValue[0])),b.displayValue[1]&&(n=b.displayValue[1])),b.value)$(this).data("id",b.value.join(" "));else{var d=$(this).data("id");d&&(b.value=d.split(" "))}b.value&&(b.value[0]&&(o=b.value[0],b.cols[1].values=g(b.value[0],"id")),b.value[1]&&(p=b.value[1])),$(this).picker(b)}})},$(c).cityPicker({toolbarTemplate:a.toolbarTmp.replace("{{text}}",$(c).data("title")),formatValue:function(a,c,d){return b&&b(a,c,d),d.join(" ")},onClose:function(b){a.onClose&&a.onClose(b)}})}),e=function(){$.ajax({url:$(c).data("url"),type:"get",dataType:"json",success:function(a){$.smConfig.rawCitiesData=a,d()}})};e()},__app.search=function(a){var b=$(a.element),c=b.data("key"),d=!1,e=b.data("target"),f=b.data("url"),g=b.data("params"),h=$(a.searchHotHistry),i=b.data("_loadMoreLink"),j=!1,k=!0;i||(i=new __app.loadMoreLink({container:e,url:f,data:b.data("params"),page:2}),b.data("_loadMoreLink",i));var l=function(a,b){i.set({page:1,data:g+"&"+c+"="+a,url:f,loading:!1,loaded:!1}),i.init(function(){__app.setStorage(a,"zfwSearchHistory"),k&&$(".infinite-scroll-preloader").hide()})},m=function(){h.show(),$(e).hide(),i._remove(),__app.setStorageToHtml("#searchHistory","#searchHistoryTemplate","zfwSearchHistory"),$('input[type="search"]').val("").trigger("blur"),k=!0,$(".infinite-scroll-preloader").hide()};j||(b.on("input propertychange",'input[type="search"]',function(a){var b=$(a.target);k=!1,d&&clearTimeout(d),d=setTimeout(function(){var a=$.trim(b.val());""!=a?(l(a),h.hide(),$(e).show(),$("html,body,.content").scrollTop(0)):m()},500)}),b.on("click",".searchbar-cancel",function(){m()}),$(document).on("click",".js-search-tag",function(a){var c=$.trim($(this).data("key"));return b.find("input").val(c),l(c),h.hide(),$(e).show(),$("html,body,.content").scrollTop(0),$('input[type="search"]').trigger("focus"),k=!1,!1}),j=!0)},__app.myTime=function(a,b,c){var d=this;return this.num=a,this.tm=setInterval(function(){return d.num<=0?(c&&c(),void clearInterval(d.tm)):(b&&b(d.num),void d.num--)},1e3),this};var __send=!1;__app.sendCode=function(a,b){var c=$(a),d=c.data("url");return __send?void 0:(c.addClass("disabled").attr("disabled",!0),$.ajax({url:d,dataType:"json",type:"post",data:b,success:function(a){__send=!0,0!=a.errorCode?($.closeModal(),$.alert(a.errorInfo),__send=!1,c.removeClass("disabled").removeAttr("disabled")):new __app.myTime(c.data("num"),function(a){c.text(a+"秒")},function(){c.text("发送验证码"),__send=!1,c.removeClass("disabled").removeAttr("disabled")})}}),$(a))},$(document).on("click","[data-link]:not(a)",function(a){$(a.target).closest("a").length>0||"A"!=a.target.tagName&&($(a.target).hasClass("external")?window.location.href=$(this).data("link"):$.router.load($(this).data("link")))}),$(document).on("click",".js-confirm-dirlink",function(){var a=$(this).data("title"),b=$(this).data("text"),c=$(this).attr("data-dir-link");$.confirm(a,b,function(){window.location.href=c})}),$(document).on("click",".closeRefuseReason",function(a){var b=$(this).data("role");if("submit"==b){var c=$(this).data("dirurl");$.ajax({url:$(this).data("url"),type:"post",dataType:"json",data:{refuseReason:$("#pageRefuseReason").find("textarea").val()},success:function(a){0==a.errorCode?window.location.href=c:$.alert(a.errorInfo)}})}$.closeModal("#pageRefuseReason")}),$(document).on("click",".js-refuse-reason",function(a){$.pickerModal("#pageRefuseReason")}),iphoneValid(),$(document).on("click",".zfw-clear-searchhistory",function(){__app.zfwSearchHistory=[],localStorage.zfwSearchHistory="[]",$("#searchHistory ul").html(""),$("#searchHistory").hide()});var pageUpdatePrice=null;$(document).on("click",".closeUpdatePrice",function(a){var b=$(this).data("role");if("submit"==b){var c=[],d=$(this).data("url"),e=$(this).data("dirurl");$("#pageUpdatePrice").find(".newPrice").each(function(){c.push($(this).val())}),$.ajax({url:d,dataType:"json",data:{newPrice:c.join(",")},type:"post",success:function(a){0==a.errorCode?$.alert("修改价格成功",function(){$.router.load(e)}):$.alert(a.errorInfo)}})}$.closeModal("#pageUpdatePrice")}),$(document).on("click",".js-update-price",function(){$.pickerModal("#pageUpdatePrice")}),$(document).on("pageAnimationStart",function(a,b,c){var d=$("#"+b),e=d.data("title");e&&$("title").text(e)}),$(document).on("beforePageSwitch",function(a,b,c){$.closeModal(),__app.varConfig.scrollTop[location.href]=$(".content").scrollTop()}),$(document).on("pageInit",function(a,b,c){__send=!1,$(".js-loadding-more").length>0&&__app.loadMore(".js-loadding-more"),$(".js-tab-loadding-more").length>0&&($(".buttons-tab").fixedTab({offset:$(".bar-nav").height()}),__app.tabLoadMore({container:$(".js-tab-loadding-more").data("target")||"#pageClassifyItemList"}))}),__app.uploadByBase64=function(a,b){var c=$(a);if(0!=c[0].files.length){var d=c.data("url")||"/member/save/updateAvatar",e=c.data("preview")||".userimg",f=c.data("done"),g=c.data("name")||"avatar",h={};$.showPreloader("图片上传中..."),lrz(c[0].files[0],{width:800}).then(function(a){h[g]=a.base64,$.ajax({url:d,type:"POST",data:h,dataType:"json",success:function(a){$.hidePreloader(),a.success?$(e).css("background-image","url("+a.picUrl+")"):$.alert("上传图片失败！"),f&&new Function("res",f).call(self,a),b&&b(a)}})})["catch"](function(a){$.alert("上传图片失败！")}).always(function(){$.hidePreloader()})}},__app.newUploadByBase64=function(a,b){var c=$(a);if(0!=c[0].files.length){var d=c.data("url"),e=c.data("preview"),f=c.data("done"),g=c.data("name"),h={};$.showPreloader("图片上传中..."),lrz(c[0].files[0],{width:800}).then(function(a){h[g]=a.base64,$.ajax({url:d,type:"POST",data:h,dataType:"json",success:function(a){$.hidePreloader(),a.success?1==c.hasClass("new-js-upload")?$(e).attr("src",a.picUrl):$(e).attr("src","url("+a.picUrl+")"):$.alert("上传图片失败！"),f&&new Function("res",f).call(self,a),b&&b(a)}})})["catch"](function(a){$.alert("上传图片失败！")}).always(function(){$.hidePreloader()})}},$(document).on("change","#cameraInput,.js-upload",function(a){__app.uploadByBase64(this)}),$(document).on("change",".new-js-upload",function(a){__app.newUploadByBase64(this)}),$(document).on("click",".js-savePageForm",function(a){var b=$(this),c=$($(this).data("target")),d=$(this).data("dirurl");__app.myValidate(c,function(a,b){$.alert(b)},function(){b.prop("disabled")||(b.prop("disabled",!0),b.addClass("disabled"),$.ajax({url:c.attr("action"),type:c.attr("method")||"post",data:c.serializeArray(),dataType:"json",success:function(a){b.prop("disabled",!1),b.removeClass("disabled"),0!=a.errorCode?$.alert(a.errorInfo):$.router.load(d)}}))})}),__app.updataServerTotal=function(){var a=0;$("#updateServer .js-inputPrice").each(function(b,c){var d=$.trim($(c).val());a+=Number(d)}),$("#updateServer .js-totalPrice").text(a),$("#updateServer [name=totalPrice]").val(a)};var ImageData=[{url:"//img.alicdn.com/tps/i4/TB1AdxNHVXXXXasXpXX0HY8HXXX-1024-1024.jpeg"}];__app.ImageData=function(a){var b=[];return a.find(".imagedata").each(function(){var a=$(this).data("url")||$(this).attr("src"),c=$(this).data("caption")||$(this).attr("alt"),d=$(this).data("html"),e={};d?e.html=d:e.url=a,c&&(e.caption=c),b.push(e)}),b},__app.pbStandalone=function(a,b,c){var d=a.attr("data-pb-filed"),e=a.data("myPhotoBrowser"),f=c||1;if(!e){var g=$.extend({photos:__app[d]||ImageData,theme:"dark",type:"standalone",ofText:"/",toolbarTemplate:"<div></div>"},b);e=$.photoBrowser(g),a.data("myPhotoBrowser",e)}e.open(parseInt(f-1,10))},$(document).on("click",".js-pb-standalone",function(){var a=$($(this).data("target")),b=$(this).data("idx");__app.pbStandalone(a,{photos:__app.ImageData(a),captionTemplate:'<div class="photo-browser-caption photo-caption-text" data-caption-index="{{captionIndex}}"><div>{{caption}}</div></div>'},b)}),$(document).on("click","#updateServer .js-del-server",function(){$.Swiper(".swiper-container",{scrollbar:".swiper-scrollbar",scrollbarHide:!0,slidesPerView:"auto",centeredSlides:!0,spaceBetween:30,grabCursor:!0});$(this).closest(".card").remove(),$($(this).data("target")).remove(),__app.updataServerTotal(),__app.varConfig.updateServer.index--}),$(document).on("click","#updateServer .js-add-server-option",function(){var a=$(this).data("temp").split(","),b=$(this).data("target").split(",");__app.varConfig.updateServer.index++;for(var c=0;c<a.length;c++)$(b[c]).append($(a[c]).html().replace(/\{index\}/g,__app.varConfig.updateServer.index));$("html,body,.content").scrollTop(99999)}),$(document).on("click",".more-link",function(a){var b=this;$.ajax({url:$(b).data("url"),type:"get",success:function(a){$(b).replaceWith(a)}})}),$(document).on("input propertychange","#updateServer .js-inputPrice",function(a){__app.updataServerTotal()}),$(document).on("pageInit","#pageStoreDetail,#pageServiceDetail",function(a,b,c){$(".tab-link").on("active",function(){var a=1*$(this).attr("href").substr(4)-1;1==a&&$.initSwiper("#"+b)})}),$(document).on("pageInit","#pagePayResult_1",function(a,b,c){$.modal({title:"支付结果",text:'<div class="content-block"><p><a href="#" class="button button-big button-danger">支付成功</a></p><p><a href="#" class="button button-big button-danger">支付遇到问题</a></p></div>'})}),$(document).on("pageInit","#pagePayResult_3",function(a,b,c){$.pickerModal("#pagePayResult_picker")}),$(document).on("pageInit","#pageClassifyItem",function(a,b,c){$(".buttons-tab").fixedTab({offset:$("#pageClassifyItem .bar-nav").length>0?$("#pageClassifyItem .bar-nav").height():0}),__app.tabLoadMore()}),$(document).on("pageInit","#pageIndex",function(a,b,c){}),$(document).on("pageInit","#pageOrder",function(a,b,c){$(".buttons-tab").fixedTab({offset:$("#pageOrder .bar-nav").length>0?$("#pageOrder .bar-nav").height():0})}),$(document).on("pageInit","#pageAccountInfo",function(a,b,c){var d=window.staticDomain?window.staticDomain:"";$.getScript(d+"/js/lrz.bundle.js",function(){}),$.device.ios&&$("#cameraInput").show();var e='<header class="bar bar-nav"></button><button class="button button-link pull-right close-picker">完成</button><h1 class="title">{{text}}</h1></header>';__app.cityPicker({element:"#city-picker",toolbarTmp:e,onClose:function(a){$.ajax({url:"/member/save/profileSingle",type:"post",data:{fieldType:"address",prov:a.value[0],city:a.value[1]},dataType:"json",success:function(a){}})}},function(a,b,c){a.input.data("id",b.join(" "))}),__app.industryPick({element:"#industry-picker",toolbarTmp:e,onClose:function(a){$.ajax({url:"/member/save/profileSingle",type:"post",data:{fieldType:"industry",fieldValue:a.value[0]},dataType:"json",success:function(a){}})}},function(a,b,c){a.input.data("id",b.join(" "))})}),$(document).on("pageLoadStart",function(a,b,c){if("pageClassify"==b){var d=$(".classify-left-nav").scrollTop(),e=$(".classify-right-nav").scrollTop();console.log(d,e)}}),$(document).on("pageInit","#pageSearch",function(a,b,c){__app.search({element:"#searchBars",searchHotHistry:"#searchHotHistry"}),__app.setStorageToHtml("#searchHistory","#searchHistoryTemplate","zfwSearchHistory")}),$(document).on("pageInit","#updateServer",function(a,b,c){__app.varConfig[b]={},__app.varConfig[b].index=$("#updateServer .serverListInfo .card").length,__app.updataServerTotal()});var myAPWkim=null,islistConversation=!1;$(document).on("pageInit","#pageMessages",function(a,b,c){myAPWkim||(myAPWkim=new __app.myWkim),islistConversation=!0}),$(document).on("pageInit","#pageMessagesChat",function(a,b,c){var d=!1;myAPWkim?islistConversation=!0:myAPWkim=new __app.myWkim,islistConversation&&myAPWkim.myImChatInit(),d||(myAPWkim.faceInit("#chatSendface"),d=!0)}),$(document).on("pageInit","#openShop-uploadintro",function(){var a=window.staticDomain?window.staticDomain:"";$.getScript(a+"/js/lrz.bundle.js",function(){})}),$.init()});