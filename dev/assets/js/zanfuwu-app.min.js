/*!
 * =====================================================
 * zanfuwu by yangbinbin - http://m.zanfuwu.com/
 *
 * =====================================================
 */
$(function(){"use strict";__app||(__app={}),__app.loadMoreLink=function(a){var b=this;this.options=a,this.$infinite=$(".infinite-scroll"),this._loadEl=$(".infinite-scroll-preloader"),this.loading=!1,this.loaded=!1,this.container=$(this.options.container)||$(".infinite-scroll-bottom .list-container"),this.page=this.options.page||1,this.data=this.options.data,this.url=this.options.url,this.addItems=function(a){$.ajax({url:this.url,type:"get",data:this.data.replace("{index}",b.page),success:function(c){""==$.trim(c)?($.detachInfiniteScroll(b.$infinite),b._loadEl.hide()):b._loadEl.show(),b.container[a](c),b.page++}})},this.init=function(){$.detachInfiniteScroll(b.$infinite),$.attachInfiniteScroll(b.$infinite),b.addItems("html")},this._remove=function(){$.detachInfiniteScroll(b.$infinite),b._loadEl.hide()},this.set=function(a){$.each(a,function(a,c){b[a]=c})},this.reset=function(a){b.set(a),$.detachInfiniteScroll(b.$infinite),$.attachInfiniteScroll(b.$infinite)},$(document).on("infinite",".infinite-scroll-bottom",function(){b.loading||(b.loading=!0,setTimeout(function(){b.loading=!1,b.addItems("append"),$.refreshScroller()},1e3))})},__app.tabLoadMore=function(a){var b=$(".mytab-link.active"),a=$.extend({container:"#pageClassifyItemList",url:b.data("url"),data:b.data("params")},a),c=new __app.loadMoreLink(a);c.init(),$(".mytab-link").on("click",function(){return b.removeClass("active"),c.set({page:1,data:$(this).data("params"),url:$(this).data("url"),loading:!1,loaded:!1}),c.init(),b=$(this).addClass("active"),$("html,body,.content").scrollTop(0),"N"==b.attr("data-more-pages")&&c._remove(),!1})},__app.loadMore=function(a){var b=$(a),c=$.extend({container:b.data("target"),url:b.data("url"),data:b.data("params"),page:2},c),d=new __app.loadMoreLink(c);return d},__app.industryPick=function(a,b){var c=[],d=[],e=a.element||"#industry-picker",f=[{id:1,name:"互联网"}],g=function(){$.each(f,function(a,b){c.push(b.id),d.push(b.name)}),$(e).picker({toolbarTemplate:a.toolbarTmp.replace("{{text}}",$(e).data("title")),formatValue:function(a,c,d){return b&&b(a,c,d),d[0]},cssClass:"industry-pick-modal",cols:[{textAlign:"center",values:c,displayValues:d,cssClass:"picker-items-col-normal"}]})};$(e).data("url")?$.ajax({url:$(e).data("url"),dataType:"json",type:"get",success:function(a){f=a,g()}}):g()},__app.cityPicker=function(a,b){var c=a.element,d=(a.displayCols||["provinces","cities","districts"],function(){var d,e=function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];if("id"==b){if(""==e.id)continue;c.push(e.id)}else{if("请选择"==e.name)continue;c.push(e.name)}}return c.length?c:[""]},f=function(a,b){var c=b||"name";return a.sub?e(a.sub,c):[""]},g=function(a,b){for(var c=b||"name",d=0;d<h.length;d++)if(h[d][c]==a)return f(h[d],c);return[""]},h=$.smConfig.rawCitiesData,i=h.map(function(a){return a.name}),j=h.map(function(a){return a.id}),k=f(h[0]),l=f(h[0],"id"),m=i[0],n=k[0],o=j[0],p=l[0],q={cssClass:"city-picker",rotateEffect:!1,onChange:function(a,b,c){var e,f,h=a.cols[0].value,i=a.cols[0].displayValue;return h!==o?(clearTimeout(d),void(d=setTimeout(function(){var b=g(i);e=b[0];var c=g(h,"id");f=c[0],a.cols[1].replaceValues(c,b),m=i,n=e,o=h,p=f,a.updateValue()},200))):(f=a.cols[1].value,e=a.cols[1].displayValue,void(e!==n&&(n=e,p=f,a.updateValue())))},cols:[{textAlign:"center",values:j,displayValues:i,cssClass:"col-province"},{textAlign:"center",values:l,displayValues:k,cssClass:"col-city"}]};$.fn.cityPicker=function(a){return this.each(function(){if(this){var b=$.extend(q,a);if(b.displayValue)$(this).val(b.displayValue.join(" "));else{var c=$(this).val();c&&(b.displayValue=c.split(" "))}if(b.displayValue&&(b.displayValue[0]&&(m=b.displayValue[0],b.cols[1].displayValues=g(b.displayValue[0])),b.displayValue[1]&&(n=b.displayValue[1])),b.value)$(this).data("id",b.value.join(" "));else{var d=$(this).data("id");d&&(b.value=d.split(" "))}b.value&&(b.value[0]&&(o=b.value[0],b.cols[1].values=g(b.value[0],"id")),b.value[1]&&(p=b.value[1])),$(this).picker(b)}})},$(c).cityPicker({toolbarTemplate:a.toolbarTmp.replace("{{text}}",$(c).data("title")),formatValue:function(a,c,d){return b&&b(a,c,d),d},onClose:function(b){a.onClose&&a.onClose(b)}})}),e=function(){$.ajax({url:$(c).data("url"),type:"get",dataType:"json",success:function(a){$.smConfig.rawCitiesData=a,d()}})};e()},__app.search=function(a){var b=$(a.element),c=b.data("key"),d=!1,e=b.data("target"),f=b.data("url"),g=b.data("params"),h=$(a.searchHotHistry),i=b.data("_loadMoreLink"),j=!1;i||(i=new __app.loadMoreLink({container:e,url:f,data:b.data("params"),page:2}),b.data("_loadMoreLink",i));var k=function(a,b){i.set({page:1,data:g+"&"+c+"="+a,url:f,loading:!1,loaded:!1}),i.init()},l=function(){h.show(),$(e).hide(),i._remove()};j||(b.on("input propertychange",'input[type="search"]',function(a){var b=$(a.target);d&&clearTimeout(d),d=setTimeout(function(){var a=$.trim(b.val());""!=a?(k(a),h.hide(),$(e).show(),$("html,body,.content").scrollTop(0)):l()},500)}),b.on("click",".searchbar-cancel",function(){l()}),j=!0)},$(document).on("click","[data-link]:not(a)",function(a){$(a.target).closest("a").length>0||"A"!=a.target.tagName&&(window.location.href=$(this).data("link"))}),$(document).on("click",".js-confirm-dirlink",function(){var a=$(this).data("title"),b=$(this).data("text"),c=$(this).attr("data-dir-link");$.confirm(a,b,function(){window.location.href=c})});$(document).on("click",".closeUpdatePrice",function(a){var b=$(this).data("role");if("submit"==b){var c=[],d=$(this).data("url"),e=$(this).data("dirurl");$("#pageUpdatePrice").find(".newPrice").each(function(){c.push($(this).val())}),$.ajax({url:d,dataType:"json",data:{newPrice:c.join(",")},type:"post",success:function(a){0==a.errorCode?$.alert("修改价格成功",function(){$.router.load(e)}):$.alert(a.errorInfo)}})}$.closeModal("#pageUpdatePrice")}),$(document).on("click",".js-update-price",function(){$.pickerModal("#pageUpdatePrice")}),$(document).on("pageInit",function(a,b,c){var d=c.data("title");$(".js-loadding-more").length>0&&__app.loadMore(".js-loadding-more"),$(".js-tab-loadding-more").length>0&&($(".buttons-tab").fixedTab({offset:$(".bar-nav").height()}),__app.tabLoadMore({container:$(".js-tab-loadding-more").data("target")||"#pageClassifyItemList"})),d&&$("title").html(d)}),$(document).on("pageInit","#pageStoreDetail,#pageServiceDetail",function(a,b,c){var d=[{url:"//img.alicdn.com/tps/i4/TB1AdxNHVXXXXasXpXX0HY8HXXX-1024-1024.jpeg"}];$(document).on("click",".js-pb-standalone",function(){var a=$(this).attr("data-pb-filed"),b=$(this).data("myPhotoBrowser");b||(b=$.photoBrowser({photos:__app[a]||d,theme:"dark",type:"standalone"}),$(this).data("myPhotoBrowser",b)),b.open()});var e=$("#storeDetailswiper")[0].swiper,f=$(".mytab-link.active");$(".mytab-link").on("click",function(){return e.slideTo(1*$(this).attr("href").substr(4)-1),!1}),e.on("slideChangeStart",function(a,b){f.removeClass("active"),f=$('.mytab-link[href="#tab'+(a.activeIndex+1)+'"]').addClass("active")})}),$(document).on("pageInit","#pagePayResult_1",function(a,b,c){$.modal({title:"支付结果",text:'<div class="content-block"><p><a href="#" class="button button-big button-danger">支付成功</a></p><p><a href="#" class="button button-big button-danger">支付遇到问题</a></p></div>'})}),$(document).on("pageInit","#pagePayResult_3",function(a,b,c){$.pickerModal("#pagePayResult_picker")}),$(document).on("pageInit","#pageClassifyItem",function(a,b,c){$(".buttons-tab").fixedTab({offset:$(".bar-nav").height()}),__app.tabLoadMore()}),$(document).on("pageInit","#pageIndex",function(a,b,c){}),$(document).on("pageInit","#pageOrder",function(a,b,c){$(".buttons-tab").fixedTab({offset:$(".bar-nav").height()})}),$(document).on("pageInit","#pageAccountInfo",function(a,b,c){var d='<header class="bar bar-nav"></button><button class="button button-link pull-right close-picker">完成</button><h1 class="title">{{text}}</h1></header>',e=[];$(document).on("click",".userimg",function(){var a=[{text:"拍个照",bold:!0,color:"danger",onClick:function(){$.alert("拍个照")}},{text:"去相册选",color:"danger",onClick:function(){$.alert("去相册选")}}],b=[{text:"取消",color:"danger"}],c=[a,b];$.actions(c)}),__app.cityPicker({element:"#city-picker",toolbarTmp:d,onClose:function(a){$.ajax({url:"/member/save/profileSingle",type:"post",data:{fieldType:"address",prov:a.value[0],city:a.value[1]},dataType:"json",success:function(a){}})}},function(a,b,c){e=b,console.log(b)}),__app.industryPick({element:"#industry-picker",toolbarTmp:d,onClose:function(a){$.ajax({url:"/member/save/profileSingle",type:"post",data:{fieldType:"industry",fieldValue:a.value[0]},dataType:"json",success:function(a){}})}},function(a,b,c){$('[name="industry"]').val(b.join(" "))})}),$(document).on("pageInit","#pageSearch",function(a,b,c){__app.search({element:"#searchBars",searchHotHistry:"#searchHotHistry"})}),$.init()});